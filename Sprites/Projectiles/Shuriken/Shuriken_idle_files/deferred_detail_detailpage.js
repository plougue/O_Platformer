var swfobject=function(){function C(){if(b)return;try{var e=a.getElementsByTagName("body")[0].appendChild(U("span"));e.parentNode.removeChild(e)}catch(t){return}b=!0;var n=c.length;for(var r=0;r<n;r++)c[r]()}function k(e){b?e():c[c.length]=e}function L(t){if(typeof u.addEventListener!=e)u.addEventListener("load",t,!1);else if(typeof a.addEventListener!=e)a.addEventListener("load",t,!1);else if(typeof u.attachEvent!=e)z(u,"onload",t);else if(typeof u.onload=="function"){var n=u.onload;u.onload=function(){n();t()}}else u.onload=t}function A(){l?O():M()}function O(){var n=a.getElementsByTagName("body")[0],r=U(t);r.setAttribute("type",i);var s=n.appendChild(r);if(s){var o=0;(function(){if(typeof s.GetVariable!=e){var t=s.GetVariable("$version");if(t){t=t.split(" ")[1].split(",");T.pv=[parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10)]}}else if(o<10){o++;setTimeout(arguments.callee,10);return}n.removeChild(r);s=null;M()})()}else M()}function M(){var t=h.length;if(t>0)for(var n=0;n<t;n++){var r=h[n].id,i=h[n].callbackFn,s={success:!1,id:r};if(T.pv[0]>0){var o=R(r);if(o)if(W(h[n].swfVersion)&&!(T.wk&&T.wk<312)){V(r,!0);if(i){s.success=!0;s.ref=_(r);i(s)}}else if(h[n].expressInstall&&D()){var u={};u.data=h[n].expressInstall;u.width=o.getAttribute("width")||"0";u.height=o.getAttribute("height")||"0";o.getAttribute("class")&&(u.styleclass=o.getAttribute("class"));o.getAttribute("align")&&(u.align=o.getAttribute("align"));var a={},f=o.getElementsByTagName("param"),l=f.length;for(var c=0;c<l;c++)f[c].getAttribute("name").toLowerCase()!="movie"&&(a[f[c].getAttribute("name")]=f[c].getAttribute("value"));P(u,a,r,i)}else{H(o);i&&i(s)}}else{V(r,!0);if(i){var p=_(r);if(p&&typeof p.SetVariable!=e){s.success=!0;s.ref=p}i(s)}}}}function _(n){var r=null,i=R(n);if(i&&i.nodeName=="OBJECT")if(typeof i.SetVariable!=e)r=i;else{var s=i.getElementsByTagName(t)[0];s&&(r=s)}return r}function D(){return!w&&W("6.0.65")&&(T.win||T.mac)&&!(T.wk&&T.wk<312)}function P(t,n,r,i){w=!0;g=i||null;y={success:!1,id:r};var o=R(r);if(o){if(o.nodeName=="OBJECT"){v=B(o);m=null}else{v=o;m=r}t.id=s;if(typeof t.width==e||!/%$/.test(t.width)&&parseInt(t.width,10)<310)t.width="310";if(typeof t.height==e||!/%$/.test(t.height)&&parseInt(t.height,10)<137)t.height="137";a.title=a.title.slice(0,47)+" - Flash Player Installation";var f=T.ie&&T.win?"ActiveX":"PlugIn",l="MMredirectURL="+u.location.toString().replace(/&/g,"%26")+"&MMplayerType="+f+"&MMdoctitle="+a.title;typeof n.flashvars!=e?n.flashvars+="&"+l:n.flashvars=l;if(T.ie&&T.win&&o.readyState!=4){var c=U("div");r+="SWFObjectNew";c.setAttribute("id",r);o.parentNode.insertBefore(c,o);o.style.display="none";(function(){o.readyState==4?o.parentNode.removeChild(o):setTimeout(arguments.callee,10)})()}j(t,n,r)}}function H(e){if(T.ie&&T.win&&e.readyState!=4){var t=U("div");e.parentNode.insertBefore(t,e);t.parentNode.replaceChild(B(e),t);e.style.display="none";(function(){e.readyState==4?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)})()}else e.parentNode.replaceChild(B(e),e)}function B(e){var n=U("div");if(T.win&&T.ie)n.innerHTML=e.innerHTML;else{var r=e.getElementsByTagName(t)[0];if(r){var i=r.childNodes;if(i){var s=i.length;for(var o=0;o<s;o++)(i[o].nodeType!=1||i[o].nodeName!="PARAM")&&i[o].nodeType!=8&&n.appendChild(i[o].cloneNode(!0))}}}return n}function j(n,r,s){var o,u=R(s);if(T.wk&&T.wk<312)return o;if(u){typeof n.id==e&&(n.id=s);if(T.ie&&T.win){var a="";for(var f in n)n[f]!=Object.prototype[f]&&(f.toLowerCase()=="data"?r.movie=n[f]:f.toLowerCase()=="styleclass"?a+=' class="'+n[f]+'"':f.toLowerCase()!="classid"&&(a+=" "+f+'="'+n[f]+'"'));var l="";for(var c in r)r[c]!=Object.prototype[c]&&(l+='<param name="'+c+'" value="'+r[c]+'" />');u.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+a+">"+l+"</object>";p[p.length]=n.id;o=R(n.id)}else{var h=U(t);h.setAttribute("type",i);for(var d in n)n[d]!=Object.prototype[d]&&(d.toLowerCase()=="styleclass"?h.setAttribute("class",n[d]):d.toLowerCase()!="classid"&&h.setAttribute(d,n[d]));for(var v in r)r[v]!=Object.prototype[v]&&v.toLowerCase()!="movie"&&F(h,v,r[v]);u.parentNode.replaceChild(h,u);o=h}}return o}function F(e,t,n){var r=U("param");r.setAttribute("name",t);r.setAttribute("value",n);e.appendChild(r)}function I(e){var t=R(e);if(t&&t.nodeName=="OBJECT")if(T.ie&&T.win){t.style.display="none";(function(){t.readyState==4?q(e):setTimeout(arguments.callee,10)})()}else t.parentNode.removeChild(t)}function q(e){var t=R(e);if(t){for(var n in t)typeof t[n]=="function"&&(t[n]=null);t.parentNode.removeChild(t)}}function R(e){var t=null;try{t=a.getElementById(e)}catch(n){}return t}function U(e){return a.createElement(e)}function z(e,t,n){e.attachEvent(t,n);d[d.length]=[e,t,n]}function W(e){var t=T.pv,n=e.split(".");n[0]=parseInt(n[0],10);n[1]=parseInt(n[1],10)||0;n[2]=parseInt(n[2],10)||0;return t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]?!0:!1}function X(n,r,i,s){if(T.ie&&T.mac)return;var o=a.getElementsByTagName("head")[0];if(!o)return;var u=i&&typeof i=="string"?i:"screen";if(s){E=null;S=null}if(!E||S!=u){var f=U("style");f.setAttribute("type","text/css");f.setAttribute("media",u);E=o.appendChild(f);T.ie&&T.win&&typeof a.styleSheets!=e&&a.styleSheets.length>0&&(E=a.styleSheets[a.styleSheets.length-1]);S=u}T.ie&&T.win?E&&typeof E.addRule==t&&E.addRule(n,r):E&&typeof a.createTextNode!=e&&E.appendChild(a.createTextNode(n+" {"+r+"}"))}function V(e,t){if(!x)return;var n=t?"visible":"hidden";b&&R(e)?R(e).style.visibility=n:X("#"+e,"visibility:"+n)}function $(t){var n=/[\\\"<>\.;]/,r=n.exec(t)!=null;return r&&typeof encodeURIComponent!=e?encodeURIComponent(t):t}var e="undefined",t="object",n="Shockwave Flash",r="ShockwaveFlash.ShockwaveFlash",i="application/x-shockwave-flash",s="SWFObjectExprInst",o="onreadystatechange",u=window,a=document,f=navigator,l=!1,c=[A],h=[],p=[],d=[],v,m,g,y,b=!1,w=!1,E,S,x=!0,T=function(){var s=typeof a.getElementById!=e&&typeof a.getElementsByTagName!=e&&typeof a.createElement!=e,o=f.userAgent.toLowerCase(),c=f.platform.toLowerCase(),h=c?/win/.test(c):/win/.test(o),p=c?/mac/.test(c):/mac/.test(o),d=/webkit/.test(o)?parseFloat(o.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,v=!1,m=[0,0,0],g=null;if(typeof f.plugins!=e&&typeof f.plugins[n]==t){g=f.plugins[n].description;if(g&&(typeof f.mimeTypes==e||!f.mimeTypes[i]||!!f.mimeTypes[i].enabledPlugin)){l=!0;v=!1;g=g.replace(/^.*\s+(\S+\s+\S+$)/,"$1");m[0]=parseInt(g.replace(/^(.*)\..*$/,"$1"),10);m[1]=parseInt(g.replace(/^.*\.(.*)\s.*$/,"$1"),10);m[2]=/[a-zA-Z]/.test(g)?parseInt(g.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else if(typeof u.ActiveXObject!=e)try{var y=new ActiveXObject(r);if(y){g=y.GetVariable("$version");if(g){v=!0;g=g.split(" ")[1].split(",");m=[parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],10)]}}}catch(b){}return{w3:s,pv:m,wk:d,ie:v,win:h,mac:p}}(),N=function(){if(!T.w3)return;(typeof a.readyState!=e&&a.readyState=="complete"||typeof a.readyState==e&&(a.getElementsByTagName("body")[0]||a.body))&&C();if(!b){typeof a.addEventListener!=e&&a.addEventListener("DOMContentLoaded",C,!1);if(T.ie&&T.win){a.attachEvent(o,function(){if(a.readyState=="complete"){a.detachEvent(o,arguments.callee);C()}});u==top&&function(){if(b)return;try{a.documentElement.doScroll("left")}catch(e){setTimeout(arguments.callee,0);return}C()}()}T.wk&&function(){if(b)return;if(!/loaded|complete/.test(a.readyState)){setTimeout(arguments.callee,0);return}C()}();L(C)}}(),J=function(){T.ie&&T.win&&window.attachEvent("onunload",function(){var e=d.length;for(var t=0;t<e;t++)d[t][0].detachEvent(d[t][1],d[t][2]);var n=p.length;for(var r=0;r<n;r++)I(p[r]);for(var i in T)T[i]=null;T=null;for(var s in swfobject)swfobject[s]=null;swfobject=null})}();return{registerObject:function(e,t,n,r){if(T.w3&&e&&t){var i={};i.id=e;i.swfVersion=t;i.expressInstall=n;i.callbackFn=r;h[h.length]=i;V(e,!1)}else r&&r({success:!1,id:e})},getObjectById:function(e){if(T.w3)return _(e)},embedSWF:function(n,r,i,s,o,u,a,f,l,c){var h={success:!1,id:r};if(T.w3&&!(T.wk&&T.wk<312)&&n&&r&&i&&s&&o){V(r,!1);k(function(){i+="";s+="";var p={};if(l&&typeof l===t)for(var d in l)p[d]=l[d];p.data=n;p.width=i;p.height=s;var v={};if(f&&typeof f===t)for(var m in f)v[m]=f[m];if(a&&typeof a===t)for(var g in a)typeof v.flashvars!=e?v.flashvars+="&"+g+"="+a[g]:v.flashvars=g+"="+a[g];if(W(o)){var y=j(p,v,r);p.id==r&&V(r,!0);h.success=!0;h.ref=y}else{if(u&&D()){p.data=u;P(p,v,r,c);return}V(r,!0)}c&&c(h)})}else c&&c(h)},switchOffAutoHideShow:function(){x=!1},ua:T,getFlashPlayerVersion:function(){return{major:T.pv[0],minor:T.pv[1],release:T.pv[2]}},hasFlashPlayerVersion:W,createSWF:function(e,t,n){return T.w3?j(e,t,n):undefined},showExpressInstall:function(e,t,n,r){T.w3&&D()&&P(e,t,n,r)},removeSWF:function(e){T.w3&&I(e)},createCSS:function(e,t,n,r){T.w3&&X(e,t,n,r)},addDomLoadEvent:k,addLoadEvent:L,getQueryParamValue:function(e){var t=a.location.search||a.location.hash;if(t){/\?/.test(t)&&(t=t.split("?")[1]);if(e==null)return $(t);var n=t.split("&");for(var r=0;r<n.length;r++)if(n[r].substring(0,n[r].indexOf("="))==e)return $(n[r].substring(n[r].indexOf("=")+1))}return""},expressInstallCallback:function(){if(w){var e=R(s);if(e&&v){e.parentNode.replaceChild(v,e);if(m){V(m,!0);T.ie&&T.win&&(v.style.display="block")}g&&g(y)}w=!1}}}}();$.getObject("Pb.Component.Element",!0).Filmstrip=function(){function e(){this.init.apply(this,arguments)}var t={properties:{},init:function(e){$.extend(this.properties,e);this.initEvents()},initEvents:function(){$.views.tags("thumbnailAction",{template:this.properties.itemActionTemplate});$.views.tags("filmstripAction",{template:this.properties.filmstripActionTemplate});$.views.helpers({getCountFromKey:function(e){return Pb.Data.Shared.get(e)?Pb.Data.Shared.get(e).length:0}});$(document).one(this.properties.initEvent,$.proxy(function(e){this.initFilmstrip(e)},this));$(document).one(this.properties.hideEvent,$.proxy(function(e){this.hideFilmstrip(e)},this))},initFilmstrip:function(e){if(Pb.Data.get(this.properties.pbdKey)){this.filmstrip=$("#"+this.properties.id);this.filmstripWrapper=$("#"+this.properties.id+"Wrapper");this.itemWidth=this.filmstrip.find(".filmstrip-item:first").outerWidth(!0);this.totalItems=Pb.Data.get(this.properties.pbdKey).length;this.filmstripWidth=this.totalItems*this.itemWidth;if(this.properties.showPagination){this.filmstrip.find(".filmstrip-wrapper").width(this.filmstripWidth);setTimeout($.proxy(function(){this.viewportWidth=this.filmstrip.outerWidth(!0);this.totalItems>Math.floor(this.viewportWidth/this.itemWidth)&&this.filmstrip.find(".filmstrip-next").show()},this),500)}this.filmstripWrapper.on("click."+this.properties.id+" touchstart."+this.properties.id,".filmstrip-next",$.proxy(this.next,this)).on("click."+this.properties.id+" touchstart."+this.properties.id,".filmstrip-prev",$.proxy(this.prev,this));$(document).on("click."+this.properties.id+" touchstart."+this.properties.id,"#"+this.properties.id+"Wrapper .action",$.proxy(this.triggerAction,this));Modernizr.touch&&this.initializeTouch();this.properties.context==="organizer"&&$(document).on("OrganizerThumbnails::selectedChanged."+this.properties.id,$.throttle(250,$.proxy(function(e){this.filmstripWrapper.find(".filmstrip-actions #selectedCount").html(e.selected)},this)))}},hideFilmstrip:function(e){$(document).off("."+this.properties.id);this.filmstripWrapper&&this.filmstripWrapper.off("."+this.properties.id);this.filmstrip&&this.filmstrip.find(".filmstrip-viewport").off("."+this.properties.id)},prev:function(){var e=this.getPrev();this.filmstrip.find(".filmstrip-wrapper").animate({left:e+"px"},"slow","linear",$.proxy(this.setArrows(e),this))},next:function(){var e=this.getNext();this.filmstrip.find(".filmstrip-wrapper").animate({left:e+"px"},"slow","linear",$.proxy(this.setArrows(e),this))},getPrev:function(){var e=parseInt(this.filmstrip.find(".filmstrip-wrapper").css("left"),10);isNaN(e)&&(e=0);e+=this.properties.scrollingItems*this.itemWidth;e*-1<=0&&(e=0);return e},getNext:function(){var e=parseInt(this.filmstrip.find(".filmstrip-wrapper").css("left"),10);isNaN(e)&&(e=0);e-=this.properties.scrollingItems*this.itemWidth;(e-this.viewportWidth)*-1>=this.filmstripWidth&&(e=(this.filmstripWidth-this.viewportWidth)*-1);return e},setArrows:function(e){e<0?this.filmstrip.find(".filmstrip-prev").show():this.filmstrip.find(".filmstrip-prev").hide();(e-this.viewportWidth)*-1>=this.filmstripWidth?this.filmstrip.find(".filmstrip-next").hide():this.filmstrip.find(".filmstrip-next").show()},onRemove:function(){if(this.properties.showPagination){this.filmstripWidth=this.itemWidth*this.filmstrip.find(".filmstrip-item").length;this.filmstrip.find(".filmstrip-wrapper").width(this.filmstripWidth);this.viewportWidth=this.filmstrip.outerWidth(!0);var e=parseInt(this.filmstrip.find(".filmstrip-wrapper").css("left"),10);this.setArrows(e)}},triggerAction:function(e){var t=$(e.currentTarget).data("type");switch(t){case"remove":var n=$(e.currentTarget).closest(".filmstrip-item");n.fadeOut(500,$.proxy(function(){n.remove();this.onRemove()},this));break;default:}this.filmstripWrapper.trigger($.Event("Pb.Component.Element.Filmstrip::"+t),{filmstripItem:e.currentTarget});$(document).trigger($.Event("Pb.Component.Element.Filmstrip::"+t),{filmstripItem:e.currentTarget})},initializeTouch:function(){mm={};mm.swipeTreshold=100;mm.allowedTime=300;this.filmstrip.find(".filmstrip-viewport").on("touchstart."+this.properties.id,$.proxy(function(e){if(e.originalEvent.touches==undefined)var t=e;else var t=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];mm.ox=t.pageX;mm.oy=t.pageY;mm.startTime=(new Date).getTime()},this)).on("touchend."+this.properties.id,$.proxy(function(e){if(e.originalEvent.touches==undefined)var t=e;else var t=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];mm.dx=t.pageX-mm.ox;mm.dy=t.pageY-mm.oy;mm.endTime=(new Date).getTime()-mm.startTime;mm.dx<-mm.swipeTreshold&&mm.endTime<mm.allowedTime?this.next():mm.dx>mm.swipeTreshold&&mm.endTime<mm.allowedTime&&this.prev()},this))}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.Common.Login",!0).Register=function(){function e(e){}$.extend(e.prototype,Pb.InputValidator.prototype,{isValid:!1,fetchingSuggestions:!1,registering:!1,isValidBirthday:!0,init:function(e){this.submitBtn=$("#registerButton");this.form=$("#registerForm");this.password2=$(".modal").find("#password2");this.component=e.component;this.fields={username:$(".modal").find("#username"),password:$(".modal").find("#password"),email:$("input#email",this.form),gender:$("input#genderM, input#genderF",this.form),birthDate:$("#birthdate").find("select"),birthDay:$("#birthDay",this.form),birthMonth:$("#birthMonth",this.form),birthYear:$("#birthYear",this.form),country:$("#country",this.form)};$(".control-group").each(function(e,t){!$(t).parent(".controls").length});Pb.Utilities.cookie("pb_under_age")&&(window.location="/register");this.initEvents()},initEvents:function(){$(this.form).submit($.proxy(this.onSubmit,this));$("input",this.form).keypress($.proxy(function(e){e.which===13&&this.onSubmit(e)},this));this.submitBtn.on("click",$.proxy(this.onSubmit,this));this.fields.email.on("blur",$.proxy(this.checkEmail,this));this.fields.birthMonth.change($.proxy(this.checkBirthValue,this));this.fields.birthDate.change($.proxy(this.checkBirthValue,this));this.fields.birthYear.change($.proxy(this.preCheckBirthdate,this));this.fields.birthYear.blur($.proxy(this.preCheckBirthdate,this));this.fields.username.blur($.proxy(this.suggest,this)).keyup($.proxy(function(e){var t=$(e.currentTarget).val();t.length>50&&$(e.currentTarget).val(t.substr(0,50))}));this.password2.on("blur",$.proxy(this.handlePasswordBlur,this)).on("click",$.proxy(function(){if(this.password2.val()===this.fields.password.attr("placeholder")||this.password2.val()===""){this.fields.password.show();this.password2.hide();this.fields.password.val(this.password2.val());this.fields.password.focus()}},this)).on("keyup",$.proxy(function(e){this.displayHideLink(e)},this));this.fields.password.on("blur",$.proxy(this.handlePasswordBlur,this)).on("keyup",$.proxy(function(e){this.displayShowLink(e)},this));$(".modal").find("#password").tooltip({trigger:"hover",placement:"right",html:!0});this.fields.password.on("keypress",$.proxy(function(e){var t=String.fromCharCode(e.which);if(t.toUpperCase()===t&&t.toLowerCase()!==t&&!e.shiftKey){this.fields.password.parents(".controls").find(".help-inline").html("Caps lock is on. Passwords are case sensitive.");this.fields.password.parents(".controls").find(".help-inline").css("display","block");this.fields.password.parents(".controls").find(".help-inline").css("margin-top","20px")}else this.fields.password.parents(".controls").find(".help-inline").text()==="Caps lock is on. Passwords are case sensitive."&&this.fields.password.parents(".controls").find(".help-inline").html("")},this));$(".modal").find("#password").after($(".modal").find("#password2"));$("#genderM, #genderF").on("blur change",$.proxy(function(e){$("#genderM").is(":checked")===!1&&$("#genderF").is(":checked")===!1?$("#gender").parents(".control-group").addClass("error"):$("#gender").parents(".control-group").removeClass("error")}));$(".help-inline, .help-mobile").on("click","a",$.proxy(function(e){e.preventDefault();var t=$(e.currentTarget).text();t=t.replace(/ /g,"");$(".modal").find("#username").val(t);$("#greenCheckName").css("display","inline");$("#redXName").css("display","none");$(".modal").find("#username").focus();$(".modal").find("#username").parents(".control-group").removeClass("warning").removeClass("error");$(".modal").find("#username").parents(".controls").find(".help-inline").html("");$(".modal").find("#username").parents(".control-group").find(".help-inline").html("")}));$(".hideLink").click($.proxy(function(e){e.preventDefault();this.fields.password.val(this.password2.val());$(".modal").find("#password").show();$(".modal").find("#password2").hide();this.displayShowLink()},this));$(".showLink").click($.proxy(function(e){e.preventDefault();$(".modal").find("#password2").val($(".modal").find("#password").val());$(".modal").find("#password").hide();$(".modal").find("#password2").show();this.displayHideLink()},this));$("#postalCode").blur($.proxy(this.checkPostal,this));$(".showLink").on("click",$.proxy(this.trackClick,this));$(".hideLink").on("click",$.proxy(this.trackClick,this));$("#registerButton").on("click",$.proxy(this.trackClick,this));$('#registrationForm .arrow, #registrationForm input[type="radio"]').on("mousedown",$.proxy(this.trackClick,this));$('#registrationForm input:not([type="radio"]), #registrationForm select').on("focus",$.proxy(this.trackClick,this));this.attachCaptcha()},attachCaptcha:function(){var e=new Pb.Component.Element.Captcha.Checkbox;e.renderCaptcha(".captchaContainer");$(e.id).on("Pb.Component.Element.Captcha.Checkbox::challenge_solved",$.proxy(this.handleCaptchaCompleted,this))},handleCaptchaCompleted:function(){$("#registerButton").removeAttr("disabled");$("fieldset.captchaContainer").removeClass("error")},handlePasswordBlur:function(e){var t;this.fields.password.is(":visible")?t=this.fields.password.val():t=this.password2.val();this.password2.val(t);this.fields.password.val(t);($(e.target).is("#password")||$(e.target).is("#password2")&&$(e.target).is(":visible"))&&this.validatePassword()},validatePassword:function(){var e=$(".modal").find("#password").val();this.password2.val(e);this.validPassword(e)?this.handleSuccess($(".modal").find("#password")):this.handleError($(".modal").find("#password"),this.messages.password)},displayShowLink:function(){var e=this.fields.password.val();if(e.length&&e!==this.fields.password.attr("placeholder")){$(".hideLink").css("display","none");$(".showLink").css("display","inline")}else this.hidePasswordLinks()},displayHideLink:function(){var e=this.password2.val();if(e.length&&e!==this.fields.password.attr("placeholder")){$(".hideLink").css("display","inline");$(".showLink").css("display","none")}else this.hidePasswordLinks()},hidePasswordLinks:function(){$(".hideLink").css("display","none");$(".showLink").css("display","none")},trackClick:function(e){var t=$(e.currentTarget),n=t.prop("name"),r="reg_modal",i="default";$(".externalSiteRegistration").length!==0&&(i="external");if(n===undefined||n==="")t.hasClass("arrow")?n="slidercaptcha":n="signUpBtn";var s=r+"_"+i+"_"+n+"_focus";Pb.Track.trn(r,s)},checkPostal:function(e){var t="input:text[id=postalCode]",n=$("#country").val();n!=="US"&&n!=="CA"&&this.removeWarning(t);if(!this.validPostalCode($("#postalCode").val())){this.handleError($(t),"");this.isValid=!1}else this.removeWarning(t)},showCongratsMessage:function(){$(".congratsMessage").css("display","block")},preCheckBirthdate:function(e){$(".birthdate.control-group").removeClass("error");$(".birthdate.control-group").find(".help-inline").html("");this.checkBirthdate(e)},checkBirthValue:function(e){var t=$(e.target).val();t===""?this.checkBirthdate(e):$(this.fields.birthDay).val()!==""&&$(this.fields.birthMonth).val()!==""&&$(this.fields.birthYear).val()!==""&&this.checkBirthdate(e)},checkBirthdate:function(e){var t=$("#currentDate").val().split("-");t[2]=parseInt(t[2],10)-13;t[1]=parseInt(t[1],10);t[0]=parseInt(t[0],10);var n=parseInt($(this.fields.birthYear).val(),10);if($(this.fields.birthDay).val()!==""&&$(this.fields.birthMonth).val()!==""){if(n<t[2]){this.isValidBirthday=!0;return}if(n===t[2]){var r=parseInt($(this.fields.birthMonth).val(),10);if(r<t[1]){this.isValidBirthday=!0;return}if(r===t[1]){var i=parseInt($(this.fields.birthDay).val(),10);if(i<=t[0]){this.isValidBirthday=!0;return}}}}this.isValidBirthday=!1},checkEmail:function(e){setTimeout($.proxy(function(){var e=this.fields.email.val();if(!this.validEmail(e)){this.handleError(this.fields.email,"");return}Pb.Ajax.ajax({url:"/action/user/checkEmail",data:{email:e},success:$.proxy(function(t){if(t.status){if($(this.fields.username).val().length===0){var n=e.split("@")[0];this.autoPopUsername(n.replace(/[^\w\s]/gi,""))}this.handleSuccess(this.fields.email)}else t.messages&&this.handleError(this.fields.email,"")},this)})},this),0)},checkCaptcha:function(){if($("#g-recaptcha-response").val()===""&&$("#g-recaptcha-response").val().length===0){$(".captchaContainer").addClass("error");this.isValid=!1}},suggest:function(e){var t,n;if(e===undefined){t=this.fields.username[0].value;n=$(".modal").find("#username")}else{t=$(e.target).val();n=$(e.target)}if(!this.fetchingSuggestions&&this.validUsername(t)){this.fetchingSuggestions=!0;Pb.Ajax.ajax({url:"/action/user/suggest",data:{username:t},success:$.proxy(function(e){if(e.status)if(e.data.available){n.parents(".control-group").removeClass("error");n.parent().find(".help-inline").html("");n.parents(".stacked").find(".help-mobile").html("");this.handleSuccess(this.fields.username)}else{var t="Suggestions: ",r=e.messages[0].details.replace(new RegExp("<br>","g")," "),i=t+r;this.handleError(this.fields.username,i)}this.fetchingSuggestions=!1},this),messageHandler:function(){return!0}})}this.validUsername(t)?this.handleSuccess(this.fields.username):this.handleError(this.fields.username,this.messages.username)},autoPopUsername:function(e){Pb.Ajax.ajax({url:"/action/user/suggest",data:{username:e},success:$.proxy(function(t){if(t.status){if(!t.data.available){var n=$($(t.messages[0].details)[2]).text();n=n.replace(/ /g,"");$(this.fields.username).val(n)}else $(this.fields.username).val(e);$(".modal").find("#username").parents(".control-group").removeClass("warning").removeClass("error");$(".modal").find("#username").parents(".controls").find(".help-inline").html("");$(".modal").find("#username").parents(".control-group").find(".help-inline").html("")}},this),messageHandler:function(){return!0}})},removeWarning:function(e){$(e,this.form).parents(".control-group").removeClass("warning").removeClass("error");$(e,this.form).parents(".controls").find(".help-inline").html("");$(e,this.form).parents(".control-group").find(".help-inline").html("")},tip:function(e){$(e.target).tooltip("show")},validate:function(){this.submitBtn.text("Validating...").prop("disabled","disabled");this.isValid=!0;$(".control-group",this.form).removeClass("error");$(".help-inline",this.form).html("");this.validateRequired(this.fields,this.handleRequiredError,this);this.checkPostal();this.checkBirthdate();this.checkCaptcha();this.validEmail(this.fields.email.val())?this.handleSuccess(this.fields.email):this.handleError(this.fields.email,this.messages.email);this.suggest();this.validPassword(this.fields.password.val())?this.handleSuccess(this.fields.password):this.handleError(this.fields.password,this.messages.password)},handleError:function(e,t){e.parents(".control-group").removeClass("success").addClass("error");e.parents(".control-group").find(".help-inline").html(t);e.parents(".stacked").find(".help-mobile").html(t);e.css("background-color","rgb(255, 255, 255);");this.isValid=!1;return!0},handleSuccess:function(e){e.parents(".control-group").addClass("error").removeClass("error").addClass("success");e.parents(".stacked").find(".help-mobile").html("");e.parents(".control-group").find(".help-inline").html("")},handleRequiredError:function(e,t,n){e.parents(".control-group").addClass("error");e.prop("name")==="birthDay"||e.prop("name")==="birthMonth"||e.prop("name")==="birthYear"?$("div.birthdate > .controls > .help-inline").html(t.messages.required):e.parents(".controls").find(".help-inline").html(t.messages.required);n.isValid=!1},onSubmit:function(e){if(!this.registering&&!this.submitBtn.hasClass("disabled")&&this.submitBtn.prop("disabled")!=="disabled"){this.validate();if(this.isValid){if(!this.isValidBirthday){Pb.Utilities.cookie("pb_under_age",!0);window.location="/register";return}this.registering=!0;var t={},n=this.form.serializeArray(),r=0,i=n.length;for(r=0;r<i;r++)t[n[r].name]=n[r].value;Pb.Ajax.ajax({url:"/action/user/register",data:t,success:$.proxy(this.onSuccess,this),messageHandler:$.proxy(function(e){$("#"+e.memo).parents(".control-group").removeClass("success");if(e.memo==="birthDate"){$("#birthdate").parents(".control-group").addClass("error");$("#birthDateGroup").find("> .help-inline").html(e.message);this.submitBtn.text("Create Account").removeAttr("disabled");this.registering=!1;return!0}this.submitBtn.text("Create Account").removeAttr("disabled");this.registering=!1;return!1},this)})}else this.submitBtn.text("Create Account").removeAttr("disabled")}e.preventDefault()},onSuccess:function(e){var t=e.status,n={properties:{}};if(t&&e.data){Pb.Utilities.cookie("pb_firstlogin",!0);n.component=this.component;n.username=e.data.username;n.properties["registration type"]=e.data.source;n.properties.brand=e.data.brand;Pb.Data.get("mixpanel")&&(n.location=Pb.Data.get("mixpanel"));Pb.Component.Tracking.Mixpanel.trackCreateAccount(n);this.handleRegistration(e)}var r=$("#planLevel option:selected").text().split(" - ")[1];Pb.Track.tr("register_"+r+"_submit");this.registering=!1},handleRegistration:function(e){if(!$.isEmptyObject(e.data.redirect)){location.href=e.data.redirect;return}Pb.Component.Element.Message.showDefaultSuccessMessage();if(e.data.returnUrl==="print"){$("#saveProgressLoginModal")&&$("#saveProgressLoginModal").find(".close").click();window.location="/print?action=openPrint"}else{var t=Pb.Data.get(Pb.Data.Shared.PRINT_PRODUCT),n=Pb.Data.get(Pb.Data.Shared.SELECTED_SET),r=Pb.Data.get(Pb.Data.Shared.ALBUM),i=Pb.Data.get(Pb.Data.Shared.MEDIA),s;if(t||n||r||i){s=$('<form action="'+e.data.returnUrl+'" method="POST"></form>');t&&$.each(t,function(e,t){s.append("<input type='hidden' name='"+e+"' value='"+t+"' />")});n&&$.each(n,function(e,t){s.append("<input type='hidden' name='selected[]' value='"+t+"' />")});r&&s.append("<input type='hidden' name='albumPath' value='"+encodeURIComponent(r.path)+"' />");i&&s.append("<input type='hidden' name='mediaUrl' value='"+encodeURIComponent(i.linkUrl)+"' />");s.appendTo("body").submit();return}window.location=e.data.returnUrl}}});var t=new e;Pb.InitEventQueue.addToDomReady(function(){$(document).on("LoginModal::show",$.proxy(function(e,n){t.init({component:"register modal"});e.screen!=="login"&&Pb.Component.Tracking.Mixpanel.trackPageView({"page name":"register modal"})},this)).on("SaveProgressLoginModal::show",$.proxy(function(e,n){t.init({component:"print register modal"});e.screen!=="login"&&Pb.Component.Tracking.Mixpanel.trackPageView({"page name":"print register modal"})},this))},Pb.InitEventQueue.LOW_PRIORITY);return t}();$.getObject("Pb.Component.Element.Captcha",!0).Checkbox=function(){function e(e){this.init(e)}var t={init:function(e){this.scriptTag="<script>var runCallback="+this.pbCaptchaCallback.toString()+";</script>";this.captchaSrc='<script src="https://www.google.com/recaptcha/api.js?onload=runCallback&render=explicit" async defer></script>';this.id="#checkboxCaptcha";this.instructions="Follow the instructions below to show you are human.";this.errorCopy="You must check the box to prove you're human.";this.redcopy="";Pb.Data.get("isAdBlockActive")&&(this.redcopy="This captcha might not work correctly if Ad Block is enabled. Please whitelist photobucket.com or disable Ad Block if you are experiencing issues.")},pbCaptchaCallback:function(){grecaptcha.render("recaptcha_widget",{sitekey:"6Ld39wYAAAAAAHRh1EnuW-QHMbOsPSRCNg4jgvqe",type:"image",callback:function(e){$("#checkboxCaptcha").trigger($.Event("Pb.Component.Element.Captcha.Checkbox::challenge_solved",{responseData:e}));$("#recaptcha_widget").removeClass("error")}})},renderCaptcha:function(e){var t=$(Pb.JSTemplates.render("#checkboxCaptchaTemplate",{errorCopy:this.errorCopy,instructions:this.instructions,scriptTag:this.scriptTag,captchaSrc:this.captchaSrc,redcopy:this.redcopy}));$("#checkboxCaptcha").remove();$(e).append(t)}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.Element.Form",!0).Honeypot=function(){function e(e){}return{init:e}}();$.getObject("Pb.Component.Common.Login",!0).Login=function(){function e(e){}$.extend(e.prototype,Pb.InputValidator.prototype,{loggingIn:!1,init:function(){this.loginBtn=$("#loginBtn");this.form=$("#loginForm");this.loggingIn=!1;$(this.form).submit($.proxy(this.onSubmit,this));this.loginBtn.on("click",$.proxy(this.onSubmit,this));$("input",this.form).keypress($.proxy(function(e){e.which===13&&this.onSubmit(e)},this));$("#loginForm").find(".loginHideLink").click($.proxy(function(e){e.preventDefault();$("#loginForm").find("#loginPassword").val($("#loginForm").find("#loginPassword2").val());$("#loginForm").find("#loginPassword").show();$("#loginForm").find("#loginPassword2").hide();this.displayShowLink()},this));$("#loginForm").find(".loginShowLink").click($.proxy(function(e){e.preventDefault();$("#loginForm").find("#loginPassword2").val($("#loginForm").find("#loginPassword").val());$("#loginForm").find("#loginPassword").hide();$("#loginForm").find("#loginPassword2").show();this.displayHideLink()},this))},displayShowLink:function(){$("#loginForm").find(".loginHideLink").css("display","none");$("#loginForm").find(".loginShowLink").css("display","inline")},displayHideLink:function(){$("#loginForm").find(".loginHideLink").css("display","inline");$("#loginForm").find(".loginShowLink").css("display","none")},handleLogin:function(e){if(e.data.redirect==="print"){$("#saveProgressLoginModal")&&$("#saveProgressLoginModal").find(".close").click();window.location="/print?action=openPrint"}else{var t=Pb.Data.get(Pb.Data.Shared.PRINT_PRODUCT),n=Pb.Data.get(Pb.Data.Shared.SELECTED_SET),r=Pb.Data.get(Pb.Data.Shared.ALBUM),i=Pb.Data.get(Pb.Data.Shared.MEDIA),s;if(t||n||r||i){s=$('<form action="'+e.data.redirect+'" method="POST"></form>');t&&$.each(t,function(e,t){s.append("<input type='hidden' name='"+e+"' value='"+t+"' />")});n&&$.each(n,function(e,t){s.append("<input type='hidden' name='selected[]' value='"+t.linkUrl+"' />")});r&&s.append("<input type='hidden' name='albumPath' value='"+encodeURIComponent(r.path)+"' />");i&&s.append("<input type='hidden' name='mediaUrl' value='"+encodeURIComponent(i.linkUrl)+"' />");s.appendTo("body").submit();return}window.location=e.data.redirect}},onSuccess:function(e){var t=e.status;t&&e.data&&this.handleLogin(e);Pb.Track.tr("login_submit");this.loggingIn=!1;this.loginBtn.text("Log in")},onSubmit:function(){if(!this.loggingIn){this.loggingIn=!0;this.loginBtn.text("Logging in...");var e={},t=this.form.serializeArray(),n=0,r=t.length;for(n=0;n<r;n++)e[t[n].name]=t[n].value;Pb.Ajax.ajax({url:"/action/auth/login",data:e,success:$.proxy(this.onSuccess,this),messageHandler:$.proxy(function(e){this.loggingIn=!1;this.loginBtn.text("Log in");return!1},this)})}}});var t=new e;Pb.InitEventQueue.addToDomReady(function(){$(document).on("LoginModal::show",$.proxy(function(e,n){t.init()},this)).on("SaveProgressLoginModal::show",$.proxy(function(e,n){t.init()},this))},Pb.InitEventQueue.LOW_PRIORITY);return t}();window.fbAsyncInit=function(){FB.init({appId:Pb.Data.get("facebookKey"),version:"v2.3",status:!0,cookie:!0,xfbml:!0,oauth:!0,channelUrl:document.location.protocol+"//"+document.domain+"/channel.html"});$(document).trigger("Pb.Component.Facebook.Facebook::fb-init")};(function(e,t,n){var r,i=e.getElementsByTagName(t)[0];if(e.getElementById(n))return;r=e.createElement(t);r.id=n;r.src="//connect.facebook.net/en_US/sdk.js";i.parentNode.insertBefore(r,i)})(document,"script","facebook-jssdk");$.getObject("Pb.Component.Facebook",!0).Facebook=function(){function e(e){var t={};e&&(t.scope=e);FB.login(function(e){if(e.authResponse){var t=e.authResponse;$(document).trigger({type:"Pb.Component.Facebook.Facebook::login",userId:t.userID,accessToken:t.accessToken,signedRequest:t.signedRequest})}else $(document).trigger("Pb.Component.Facebook.Facebook::login-failed")},t)}function t(){FB.logout(function(e){$(document).trigger("Pb.Component.Facebook.Facebook::logout")})}function n(){FB.getLoginStatus(function(e){$(document).trigger({type:"Pb.Component.Facebook.Facebook::login-status",status:e.status,authResponse:e.authResponse})})}function r(e,t){FB.api(e,t)}function i(e,t,n){$.isArray(e)||(e=e.split(","));FB.getLoginStatus(function(r){r.status==="connected"?FB.api("/me/permissions",function(r){var i=r.data,s,o=[],u=[],a;a=i.filter(function(e){return e.status==="granted"});for(s=0;s<a.length;s++)o.push(a[s].permission);for(s=0;s<e.length;s++)o.indexOf(e[s])===-1&&u.push(e[s]);if(u.length){n({status:"error",failedPerms:u});return}t({status:"success",grantedPerms:a})}):r.status==="not_authorized"?n({status:"not_authorized",failedPerms:e}):n({status:"error",failedPerms:e})})}return{login:e,logout:t,getLoginStatus:n,api:r,checkPerms:i}}();$.getObject("Pb.Component.Ad",!0).VideoAdModal=function(){function i(e,t){if($("#"+r).length){$("#"+r).empty();$(document).one("Pb.Component.Ad.VideoAd::adLoaded",function(){n.startAd()});n.initAd(e,t,Pb.Data.get("videoAdProps"));Pb.Track.tr("uploader_video_impression")}}function s(n){switch(n.type){case t.AdLoaded:$(document).trigger("Pb.Component.Ad.VideoAd::adLoaded");break;case t.AdStarted:e=!0;$(document).trigger("Pb.Component.Ad.VideoAd::adStarted");break;case t.AdCompanionDisplay:break;case t.AdClickThru:break;case t.AdStopped:e&&$(document).trigger("Pb.Component.Ad.VideoAd::adStopped");break;case t.AdError:}}function o(e){var i=__adaptv__,o=$(".ad.mrec").first(),a;r=e;n=new i.ads.vpaid.VPAIDAd(e);t=i.ads.vpaid.VPAIDEvent;for(a in t)t.hasOwnProperty(a)&&n.on(t[a],s);o.attr("id")===undefined&&o.attr("id","admrec_"+Math.random());u({companionId:o.attr("id")})}function u(e){var t=Pb.Data.get("videoAdProps"),n=$.extend(!0,t,e);Pb.Data.add("videoAdProps",n)}function a(e){Pb.Data.get("showAds")&&$.getScript("http://redir.adap.tv/redir/javascript/vpaid.js",function(){$.getScript("http://redir.adap.tv/redir/javascript/adaptvAdPlayer.js",function(){o(e)})})}var e=!1,t,n,r;Pb.InitEventQueue.add(function(){a("videoAdModal")},Pb.InitEventQueue.LOW_PRIORITY);return{init:a,playAd:i,setAdProps:u}}();$.getObject("Pb",!0).DetailInit=function(){function e(e){var n=Pb.Data.get(Pb.Data.Shared.MEDIA).fullsizeUrl,r;r={mediaUrl:n,firstFetch:!0};Pb.Ajax.ajax({url:e,data:r,type:"get",success:$.proxy(function(e){var n=Pb.Data.get(Pb.Data.Shared.MEDIA),r=e.mediaData;Pb.Data.Shared.put(Pb.Data.Shared.MEDIA_SET,r,"",!1);var i=e.fetcherData.currentOffset;if(r.hasOwnProperty(i)&&Pb.Data.get(Pb.Data.Shared.MEDIA_SET)[i].fullsizeUrl===r[i].fullsizeUrl)t(n,i);else for(var s in Pb.Data.get(Pb.Data.Shared.MEDIA_SET))if(Pb.Data.get(Pb.Data.Shared.MEDIA_SET).hasOwnProperty(s)&&Pb.Data.get(Pb.Data.Shared.MEDIA_SET)[s].fullsizeUrl===r[s].fullsizeUrl){i=s;t(n,s);break}var o=$("#stotal");if(o.length>0){o.html(e.fetcherData.total);$(".breadcrumbNav .breadcrumb").css("visibility","visible")}var u=$.Event("Detail::first_batch_received",{currentOffset:i,fetcherData:e.fetcherData,filmStripData:e.filmStripData});$(document).trigger(u)},this)})}function t(e,t){var n=Pb.Data.get(Pb.Data.Shared.MEDIA_SET)[t];n.placeHold=!1;n.fsWidth=e.fsWidth;n.fsHeight=e.fsHeight;n.rsWidth=e.rsWidth;n.rsHeight=e.rsHeight;n.offset=t;n.thumbUrl=e.thumbUrl;n.fullsizeUrl=e.fullsizeUrl;Pb.Data.add(Pb.Data.Shared.MEDIA,n)}function n(){typeof Pb.Component.Common!="undefined"&&typeof Pb.Component.Common.Comments!="undefined"&&new Pb.Component.Common.Comments({commentTarget:Pb.Data.Shared.get(Pb.Data.Shared.MEDIA)});var e=$.Event("Pb.Component.Detail.Detail::current_media_update",{newTarget:Pb.Data.get(Pb.Data.Shared.MEDIA)}),t=Pb.Data.get(Pb.Data.Shared.MEDIA);promoImageThumb=$(".promoImage");if(t){var n=t.path.split(".").pop().toLowerCase();if(t.mediaType==="image"&&n!=="gif"&&t.cp){$(".printPromoContainer").show();$(".printPromoLink").attr("href",Pb.Data.get("secureUrl")+"print/homedecor/framedprints?media="+encodeURIComponent(t.linkUrl));$(".calendarPromoLink").attr("href",Pb.Data.get("secureUrl")+"print/calendars?media="+encodeURIComponent(t.linkUrl));$(".canvasPromoLink").attr("href",Pb.Data.get("secureUrl")+"print/homedecor/canvasprints?media="+encodeURIComponent(t.linkUrl));$(".holidayCardPromoLink").attr("href",Pb.Data.get("secureUrl")+"print/cardsandstationery/holidayphotocards?media="+encodeURIComponent(t.linkUrl));$(".editorPromoLink").attr("href","/editor?image="+encodeURIComponent(t.fullsizeUrl)+"&detailUrl="+encodeURIComponent(t.linkUrl));t.fsHeight>t.fsWidth?promoImageThumb.attr("style","background-position: initial; background-image: url('"+t.fullsizeUrl+"');"):promoImageThumb.attr("style","background-position: center; background-image: url('"+t.fullsizeUrl+"');")}else $(".printPromoContainer").hide()}$(document).trigger(e)}return{init:e,initPrivate:n}}();$.getObject("Pb.Component.Detail",!0).Fetcher=function(){function e(e){this.init(e)}var t={libData:null,offset:null,prevOffset:null,total:null,direction:null,context:null,filters:null,init:function(e){this.offset=e.currentOffset;this.prevOffset=this.offset;this.total=e.total;this.context=e.context;this.query=e.query;Pb.Data.add("detailQuery",this.query);this.libData=Pb.Data.Shared.get(Pb.Data.Shared.MEDIA_SET);this.setLibDataMinMax();this.bindEvents()},setLibDataMinMax:function(){var e=0,t,n,r,i=this.convertToArray(this.libData);for(r in i)if(i.hasOwnProperty(r)){if(r==="pbdkey")continue;e===0&&(t=parseInt(i[r].id,10));n=parseInt(i[r].id,10);e++}Pb.Data.add("libDataMin",t);Pb.Data.add("libDataMax",n);Pb.Data.add("libDataCount",e)},bindEvents:function(){$(document).on("Pb.Component.Filmstrip.Filmstrip::filmstrip_slide_update",$.proxy(this.handleSlideUpdate,this));$(document).on("Pb.Component.Detail.MediaManager::media_manager_update",$.proxy(this.handleSlideUpdate,this));$(document).on("Pb.Component.RecentUploads.RecentUploadsDetailManager::recentuploads_update",$.proxy(this.handleSlideUpdate,this))},handleSlideUpdate:function(e){this.fetchMore(e)},fetchMore:function(e){var t="/component/Detail-"+this.context,n=e.dir,r,i;t+="?"+this.query;!e.startOffset&&e.startOffset!==0?r=n===-1?Pb.Data.get("libDataMin"):Pb.Data.get("libDataMax")+1:r=e.startOffset;i={offset:r,dir:n};Pb.Ajax.ajax({url:t,data:i,type:"get",success:$.proxy(function(e){var t,r,i;if(Object.keys(e).length>0){r=this.findRange(e,n);if(!r)return;n===-1?t=this.prependToData(e):t=this.appendToData(e);Pb.Data.Shared.put(Pb.Data.Shared.MEDIA_SET,t,"",!1);this.libData=Pb.Data.Shared.get(Pb.Data.Shared.MEDIA_SET);this.setLibDataMinMax();i=$.Event("Pb.Component.Detail.Fetcher::libdata_update",{dir:n,startOffset:r.low,endOffset:r.high});$(document).trigger(i)}},this)})},prependToData:function(e){var t=$.extend(e,this.libData);return t},appendToData:function(e){var t=$.extend(this.libData,e);return t},findRange:function(e,t){var n,r,i=0,s=this.findCount(e)-1;if(t===-1)for(n in e){if(this.libData.hasOwnProperty(n)){i++;continue}if(e.hasOwnProperty(n)){r={low:parseInt(n,10),high:parseInt(n,10)+s-i};return r}}else{var o=1;for(n in e){n=parseInt(n,10)+s-o+1;n=n.toString();o+=2;if(this.libData.hasOwnProperty(n)){i++;continue}if(e.hasOwnProperty(n)){r={low:parseInt(n,10)+i-s,high:parseInt(n,10)};return r}}}},findCount:function(e){var t,n=0;for(t in e)e.hasOwnProperty(t)&&n++;return n},convertToArray:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t.sort(function(e,t){return parseInt(e.id,10)-parseInt(t.id,10)})}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.Detail",!0).Detail=function(){function e(e){this.init(e)}var t={oldData:null,currentData:null,mediaSet:null,currentOffset:null,context:null,linkCodesInited:!1,profilePic:null,profileOwnerName:null,profileLink:null,likeCnt:null,viewCnt:null,commentCnt:null,linksHeading:null,description:null,isMobile:!1,loggedInUser:null,isFollowing:!1,promoImageThumb:null,printPromoLink:null,holidayCardPromoLink:null,calendarPromoLink:null,canvasPromoLink:null,action:null,showPreview:!1,profilePicUrl:"/component/Common-ProfilePic-ProfilePic",init:function(e){this.currentData=Pb.Data.get(Pb.Data.Shared.MEDIA);this.mediaSet=Pb.Data.get(Pb.Data.Shared.MEDIA_SET);this.onView();typeof e.currentIndex!="undefined"&&(this.currentOffset=parseInt(e.currentIndex,10));e.context&&(this.context=e.context);e.showPreview&&(this.showPreview=e.showPreview);if(this.currentData.isFollowing){$("a.follow").text("");$("a.follow").append("<span>Following</span>")}this.isMobile=Pb.Data.get("isMobile");this.loggedInUser=Pb.Data.get("loggedInUserData");this.mediaDesc=$(".mediaDescription").first();this.currentData.hashtagMedia?this.mediaDesc.hide():this.mediaDesc.show();this.updatePageState();this.getUpdateableElements();this.attachSharedKey();Pb.Component.Ad.AdRefresh.initMediaDetail();var t="";if($("#googleJsScriptContainer").length){var t="<!-- Google Tag Manager -->";t+="<noscript>";t+='<iframe src="//www.googletagmanager.com/ns.html?id=GTM-TNHVQV" height="0" width="0" style="display:none;visibility:hidden"></iframe>';t+="</noscript>";t+="<script>";t+="(function(w, d, s, l, i) {w[l] = w[l] || [];w[l].push({'gtm.start': new Date().getTime(),event: 'gtm.js'});var f = d.getElementsByTagName(s)[0],j = d.createElement(s),dl = l != 'dataLayer' ? '&l=' + l : '';j.async = true;j.src ='//www.googletagmanager.com/gtm.js?id=' + i + dl;f.parentNode.insertBefore(j, f);})(window, document, 'script', 'dataLayer', 'GTM-TNHVQV');";t+="</script>";t+="<!-- End Google Tag Manager -->";$("#googleJsScriptContainer").html(t)}else{var t='<div id="googleJsScriptContainer"><!-- Google Tag Manager -->';t+="<noscript>";t+='<iframe src="//www.googletagmanager.com/ns.html?id=GTM-TNHVQV" height="0" width="0" style="display:none;visibility:hidden"></iframe>';t+="</noscript>";t+="<script>";t+="(function(w, d, s, l, i) {w[l] = w[l] || [];w[l].push({'gtm.start': new Date().getTime(),event: 'gtm.js'});var f = d.getElementsByTagName(s)[0],j = d.createElement(s),dl = l != 'dataLayer' ? '&l=' + l : '';j.async = true;j.src ='//www.googletagmanager.com/gtm.js?id=' + i + dl;f.parentNode.insertBefore(j, f);})(window, document, 'script', 'dataLayer', 'GTM-TNHVQV');";t+="</script>";t+="<!-- End Google Tag Manager --></div>";$("body").append(t)}this.bindEvents();$("#linksHelp").tooltip({placement:"left",delay:{show:300,hide:100}});e.action&&(e.action.toLowerCase()==="like"?$("a.like").trigger("click"):e.action.toLowerCase()==="copy"&&$(document).trigger({type:"CopyMoveMediaModal::show",pbData:this.currentData}));if(Pb.Data.get("featureTrackingKey")==="mwdetail.current"){var n=this.currentData.ext==="gif"?"gif":this.currentData.mediaType,r=this.currentData.public?!0:!1,i=this.currentData.io;Pb.Data.add("detailModal",{context:this.context});Pb.Component.Tracking.Mixpanel.trackMediaView({mediaType:n,mediaPrivacy:r,context:this.context,isOwner:i})}this.updatePrintPromos()},updatePageState:function(){var e={offset:this.currentOffset},t=document.location.href,n=t.indexOf("?")!==-1?document.location.href.slice(window.location.href.indexOf("?")):"",r=this.currentData.linkUrl.split("photobucket.com").pop()+n,i={replace:!0,state:e,url:r,title:$("title").text()};$(document).trigger($.Event("HistoryManager::updatePageHistory",i))},getUpdateableElements:function(){this.profilePic=$(".profileWrapper img.avatar");this.profileOwnerName=$("#profileOwnerName");this.profileLink=this.profileOwnerName.parent();this.profileImgLink=$(".profileWrapper a");this.likeCnt=$("#likeCount");this.viewCnt=$("#viewCount");this.commentCnt=$("#commentCount");this.linksHeading=$(".sidebar div.linkcodes h2 span");this.followLink=$("a.follow");this.promoImageThumb=$(".promoImage");this.printPromoLink=$(".printPromoLink");this.holidayCardPromoLink=$(".holidayCardPromoLink");this.calendarPromoLink=$(".calendarPromoLink");this.canvasPromoLink=$(".canvasPromoLink");var e=$(".mediaDescription"),t=e.find("span.editable-field").first();t.length>0?this.description=t:this.description=e},attachSharedKey:function(){Pb.Data.Shared.attach($(".detailWrapper"),Pb.Data.Shared.MEDIA)},bindEvents:function(){var e=$(document);e.on("Pb.Component.Filmstrip.Filmstrip::filmstrip_offset_update",$.proxy(this.handleCurrentMediaUpdate,this));e.on("Pb.Component.Detail.MediaManager::media_offset_update",$.proxy(this.handleCurrentMediaUpdate,this));e.on("Pb.Component.RecentUploads.RecentUploadsDetailManager::recentuploads_offset_update",$.proxy(this.handleCurrentMediaUpdate,this));e.on("Pb.Component.Detail.Detail::current_media_update",$.proxy(this.updatePageElements,this));e.on("Pb.Component.Common.Follow.FollowAction::action_complete",$.proxy(this.handleUpdateFollowing,this));e.on("click",".sharePromoLink",function(){$(document).trigger($.Event("Pb.Component.Share.ShareModal::show",{pbData:Pb.Data.get(Pb.Data.Shared.MEDIA),shareType:"social",shareMode:"media"}))});History.Adapter.bind(window,"statechange",$.proxy(this.checkHistory,this));this.bindDescription();e.on("click",".comment-post",function(){Pb.Track.tr("detailpage_comment_post_click")});if(typeof Pb.Animation!="undefined"){var t=.2*window.innerWidth,n=75>t?t:75;$("#mediaTemplate").swipe({swipeLeft:function(){$(document).trigger($.Event("Pb.Component.Media.Media::media_next_swipe"))},swipeRight:function(){$(document).trigger($.Event("Pb.Component.Media.Media::media_previous_swipe"))},allowPageScroll:"vertical",maxTimeThreshold:5e3,fingers:1,threshold:n});Pb.Animation.setTransitionEndEvent(".slideContainer .slides",$.proxy(this.triggerMediaUpdate,this))}},bindDescription:function(){var e=this;this.mediaDesc=$(".mediaDescription .editable-field").first();this.mediaDesc.length>0&&this.mediaDesc.editInPlace({callback:function(t,n,r){e.saveDescription(n,r);n===""&&(n="Click to add description");return n},show_buttons:!0,save_button:'<button class="btn btn-small btn-primary inplace_save icon-ok"></button>',cancel_button:'<button class="btn btn-small inplace_cancel icon-remove"></button>',default_text:"Click to add description",field_type:"textarea",pb_track:function(){Pb.Track.trf("detailpage_description_click")},pb_validation:function(e,t){var n=!0;e=$.trim(e);if(e.length>2048){var r={status:0,message:"Description cannot be more than 2048 characters",details:""};Pb.Component.Element.Message.show(r);n=!1}return n}})},checkHistory:function(e){var t,n,r=History.getState();if(typeof r!="object")return;t=r.data.offset;if(typeof t!="undefined"&&this.currentOffset!==t){n=$("#thumb_"+t).find("a");if(n.length>0)n.trigger("click",["prevnextclick"]);else{var i={};i.oldOffset=this.currentOffset;i.currentOffset=t;this.handleCurrentMediaUpdate(i)}}},handleCurrentMediaUpdate:function(e){var t=Pb.Data.Shared.get(Pb.Data.Shared.MEDIA_SET);this.oldData=t[e.oldOffset];this.currentData=t[e.currentOffset];this.currentOffset=e.currentOffset;Pb.Data.Shared.put(Pb.Data.Shared.MEDIA,this.currentData);var n={offset:e.currentOffset},r,i,s,o,u=this.currentData.mediaType==="image"?"photo":this.currentData.mediaType,a=this.currentData.title.length>0?this.currentData.title:this.currentData.name;if($("html").hasClass("is_ie8")){r=document.location.href.slice(window.location.href.indexOf("#")+1);i=r.indexOf("?");s=r.indexOf("&_suid");r=r.substring(i,s)}else{r=document.location.href.slice(window.location.href.indexOf("#")+1);i=r.indexOf("?");r=i!==-1?r.substring(i):""}r=r.replace("o="+e.oldOffset,"o="+e.currentOffset);o={state:n,url:this.currentData.linkUrl.split("photobucket.com").pop()+r,title:a+" "+u+" by "+this.currentData.ownername};$(document).trigger($.Event("HistoryManager::updatePageHistory",o));this.updatePrintPromos();if(typeof Pb.Animation!="undefined"&&e.oldOffset!==e.currentOffset&&Math.abs(e.oldOffset-e.currentOffset)<=1)this.animateToMedia(e);else{var f,l=e.oldOffset<e.currentOffset?1:-1,c=Math.abs(e.oldOffset-e.currentOffset)===1;if(this.showPreview&&c&&!1){f=$(".tableWrapper .currentView img").width();setTimeout($.proxy(function(){this.triggerMediaUpdate()},this),333);if(l===-1){$(".tableWrapper .prevPreview div").width(f).css("opacity",1);$(".tableWrapper .nextPreview div").width(0).css("opacity",0)}else{$(".tableWrapper .currentView img").css({marginLeft:f*-1+"px"});$(".tableWrapper .nextPreview div").width(f).css("opacity",1);$(".tableWrapper .prevPreview div").css("display","none")}}else this.triggerMediaUpdate()}if(Pb.Data.has("featureTrackingKey")){Pb.Track.tr("detail_page_"+Pb.Data.get("featureTrackingKey")+"_view");if(Pb.Data.get("featureTrackingKey")==="mwdetail.current"){var u=this.currentData.ext==="gif"?"gif":this.currentData.mediaType,h=this.currentData.public?!0:!1,p=this.currentData.io;Pb.Component.Tracking.Mixpanel.trackMediaView({mediaType:u,mediaPrivacy:h,context:this.context,isOwner:p})}}Pb.Track.tr("detail_page_view");Pb.Track.trf("detail_pagination_click");Pb.Track.trl("media_detail_views");typeof Pb.PageTracker!="undefined"&&Pb.PageTracker.trackPageView({pb_pg:"detail"});typeof Pb.MobilePageTracker!="undefined"&&Pb.MobilePageTracker.trackPageView("mobiledetail")},triggerMediaUpdate:function(){var e=$.Event("Pb.Component.Detail.Detail::current_media_update");e.newTarget=this.currentData;$(document).trigger(e)},animateToMedia:function(e){var t=0,n=e.oldOffset<e.currentOffset?1:-1,r=0,i=$(".currentMedia"),s=$(".slideContainer").find(".slides");s.find(".mediawrapper").each(function(e,t){r+=$(t).width()});s.width(r);if(i.length){t=i.width()*n*-1;Pb.Animation.setSwipeAnimation(s,t,!0)}},updatePageElements:function(){this.updateProfile();this.updateLinkCodes();this.updateDescription();this.updateFollowButton();this.updateFlagButton();setTimeout($.proxy(this.onView,this))},updateLinkCodes:function(){if(Pb.Component.Common&&Pb.Component.Common.Links){if(!this.linkCodesInited){$(".link-container").empty();var e=new Pb.Component.Common.Links.LinkCodes({selector:".link-container",prefix:"linksModule"});this.linkCodesInited=!0}$(".link-container").trigger({type:"Pb.Component.Common.Links.LinkCodes::refresh",objectData:this.currentData});var t=this.currentData.ext==="gif"?"gif":this.currentData.mediaType;t=t.charAt(0)+t.slice(1);t=t==="image"?"photo":t;this.linksHeading.text("SHARE THIS "+t.toUpperCase())}},updateProfile:function(){if(this.profileOwnerName.text()!==this.currentData.ownername){this.updateProfilePic();this.profileOwnerName.html(this.currentData.ownername);this.profileLink.attr("href",this.currentData.ownerprofilelink);this.profileImgLink.attr("href",this.currentData.ownerprofilelink)}},updateProfilePic:function(){if(!this.currentData.profilePicUrl){var e={url:this.profilePicUrl,type:"GET",data:{username:this.currentData.ownername,json:1},success:$.proxy(function(e){if(e.url){this.currentData.profilePicUrl=e.url;this.profilePic.attr("src",e.url)}},this)};Pb.Ajax.ajax(e)}else this.profilePic.attr("src",this.currentData.profilePicUrl)},updateDescription:function(){this.mediaDesc=$(".mediaDescription").first();if(this.currentData.hashtagMedia){this.mediaDesc.hide();return}this.mediaDesc.show();var e=this.description.find(".inplace_cancel");e.length>0&&e.trigger("click");if(this.isMobile){this.description.text(this.currentData.description);return}var t=this.currentData.description?this.currentData.description:this.currentData.io?"Click to add description":"";this.description.text(t);this.currentData.io&&this.bindDescription()},updatePrintPromos:function(){$(".printPromoContainer #epsonPrintContainer").find(".pixel").attr("href","#");$(".printPromoContainer #epsonPrintContainer").find(".pixel img").attr("src","https://opic2.pbsrc.com/common/pixel.png");if(this.currentData){var e=this.currentData.path.split(".").pop().toLowerCase();if(this.currentData.mediaType==="image"&&e!=="gif"&&this.currentData.cp){$(".printPromoContainer").show();this.printPromoLink.attr("href",Pb.Data.get("secureUrl")+"print");$(".editorPromoLink").attr("href","/editor?image="+encodeURIComponent(this.currentData.fullsizeUrl)+"&detailUrl="+encodeURIComponent(this.currentData.linkUrl))}else $(".printPromoContainer").hide()}},updateFollowButton:function(){var e=this.mediaSet[this.currentOffset],t=this.followLink;if(e)var n=e.isFollowing;if(t.length>0){t.attr("data-followee",this.currentData.ownername);this.loggedInUser&&(this.currentData.ownername===this.loggedInUser.username?t.hide():t.show())}if(!t.hasClass("disabled"))if(n){t.addClass("following");t.removeClass("btn-primary");t.text(""),t.append("<span>Following</span>")}else{t.removeClass("following");t.addClass("btn-primary");t.removeClass("btn-secondary");t.text("");t.append("<span>Follow</span>")}},handleUpdateFollowing:function(e){var t=Pb.Data.Shared.get("shared.mediaSet");this.updateMediaSet(t,this.currentOffset,"isFollowing",!e.action)},updateMediaSet:function(e,t,n,r){var i=e[t],s=Object.keys(e);for(var o=0,u=s.length;o<u;o+=1){var a=e[s[o]];a.ownername===i.ownername&&(a[n]=r)}},updateFlagButton:function(){var e=$("#flagBox");e.length>0&&this.loggedInUser&&(this.currentData.ownername===this.loggedInUser.username?e.hide():e.show())},onView:function(){if(!this.currentData.isPersisted)return;var e="/action/media/onView",t={mediaUrl:this.currentData.fullsizeUrl};Pb.Ajax.ajax({url:e,data:t,success:$.proxy(function(e){return e.status===1?!0:!1},this)})},saveDescription:function(e,t){var n="/action/media/updateDescription",r={description:e,mediaUrl:this.currentData.fullsizeUrl};Pb.Component.Ad&&Pb.Component.Ad.AdRefresh&&Pb.Component.Ad.AdRefresh.reloadAds();Pb.Ajax.ajax({url:n,data:r,success:$.proxy(function(e){if(e.status===1){this.currentData.description=e.data.description;this.currentData.isPersisted=!0;return!0}return!1},this)})}};$.extend(e.prototype,t);return e}();$.getObject("Pb",!0).ClientImagePreloader=function(){function e(e){this.init(e)}var t={pb_loadContainer:null,pb_dims:{},totalCount:0,completedCount:0,completedEventName:null,memo:null,init:function(e){},preLoad:function(e,t,n){this.totalCount=t.length;this.completedEventName=e;this.pb_dims[this.completedEventName]={};n&&(this.memo=n);this.checkPreloadContainer();var r=this;for(var i=0;i<t.length;i++){var s=$('<img id="preload_'+(e+i)+'" src="'+t[i]+'" />');this.pb_loadContainer.append(s);if(s[0].complete)this.handlePreLoadedImage(s);else{s[0].onload=function(){s=$(this);r.handlePreLoadedImage(s)};s[0].onerror=function(){s=$(this);r.handleImageLoadError(s)}}}},handlePreLoadedImage:function(e){if(this.completedCount===this.totalCount)return;var t={width:e.width(),height:e.height()},n=e.attr("src");this.pb_dims[this.completedEventName][n]=t;this.completedCount++;this.checkComplete()},handleImageLoadError:function(e){if(this.completedCount===this.totalCount)return;var t={width:0,height:0};this.pb_dims[this.completedEventName][e.attr("src")]=t;this.completedCount++;this.checkComplete()},checkComplete:function(){if(this.completedCount==this.totalCount){var e=$.Event(this.completedEventName);e.dimensions=this.pb_dims[this.completedEventName];this.memo&&(e.memo=this.memo);$(document).trigger(e)}},get:function(e){return this.pb_dims[this.completedEventName][e]},checkPreloadContainer:function(){this.pb_loadContainer=$("#pbPreload");if(this.pb_loadContainer.length===0){$("body").append('<div id="pbPreload" style="overflow:hidden; position:absolute; width: 1px; height: 0px; top: -10px; left: -10px;"></div>');this.pb_loadContainer=$("#pbPreload")}}};$.extend(e.prototype,t);return e}();$.getObject("Pb",!0).ClientImageRescaler=function(){function e(e){this.init(e)}var t={maxWidth:null,maxHeight:null,init:function(e){if(e){e.width&&(this.maxWidth=e.width);e.height&&(this.maxHeight=e.height)}},setMaxWidth:function(e){this.maxWidth=e},setMaxHeight:function(e){this.maxHeight=e},rescale:function(e){var t=e.width,n=e.height;if(t>this.maxWidth){n=this.maxWidth*n/t;t=this.maxWidth}if(n>this.maxHeight){t=t/n*this.maxHeight;n=this.maxHeight}return{width:t,height:n}}};$.extend(e.prototype,t);return e}();(function(e,t){"use strict";var n=e.History=e.History||{},r=e.jQuery;if(typeof n.Adapter!="undefined")throw new Error("History.js Adapter has already been loaded...");n.Adapter={bind:function(e,t,n){r(e).bind(t,n)},trigger:function(e,t,n){r(e).trigger(t,n)},extractEventData:function(e,n,r){var i=n&&n.originalEvent&&n.originalEvent[e]||r&&r[e]||t;return i},onDomLoad:function(e){r(e)}};typeof n.init!="undefined"&&n.init()})(window);(function(e,t){"use strict";var n=e.document,r=e.setTimeout||r,i=e.clearTimeout||i,s=e.setInterval||s,o=e.History=e.History||{};if(typeof o.initHtml4!="undefined")throw new Error("History.js HTML4 Support has already been loaded...");o.initHtml4=function(){if(typeof o.initHtml4.initialized!="undefined")return!1;o.initHtml4.initialized=!0;o.enabled=!0;o.savedHashes=[];o.isLastHash=function(e){var t=o.getHashByIndex(),n;n=e===t;return n};o.saveHash=function(e){if(o.isLastHash(e))return!1;o.savedHashes.push(e);return!0};o.getHashByIndex=function(e){var t=null;typeof e=="undefined"?t=o.savedHashes[o.savedHashes.length-1]:e<0?t=o.savedHashes[o.savedHashes.length+e]:t=o.savedHashes[e];return t};o.discardedHashes={};o.discardedStates={};o.discardState=function(e,t,n){var r=o.getHashByState(e),i;i={discardedState:e,backState:n,forwardState:t};o.discardedStates[r]=i;return!0};o.discardHash=function(e,t,n){var r={discardedHash:e,backState:n,forwardState:t};o.discardedHashes[e]=r;return!0};o.discardedState=function(e){var t=o.getHashByState(e),n;n=o.discardedStates[t]||!1;return n};o.discardedHash=function(e){var t=o.discardedHashes[e]||!1;return t};o.recycleState=function(e){var t=o.getHashByState(e);o.discardedState(e)&&delete o.discardedStates[t];return!0};if(o.emulated.hashChange){o.hashChangeInit=function(){o.checkerFunction=null;var t="",r,i,u,a;if(o.isInternetExplorer()){r="historyjs-iframe";i=n.createElement("iframe");i.setAttribute("id",r);i.style.display="none";n.body.appendChild(i);i.contentWindow.document.open();i.contentWindow.document.close();u="";a=!1;o.checkerFunction=function(){if(a)return!1;a=!0;var n=o.getHash()||"",r=o.unescapeHash(i.contentWindow.document.location.hash)||"";if(n!==t){t=n;if(r!==n){u=r=n;i.contentWindow.document.open();i.contentWindow.document.close();i.contentWindow.document.location.hash=o.escapeHash(n)}o.Adapter.trigger(e,"hashchange")}else if(r!==u){u=r;o.setHash(r,!1)}a=!1;return!0}}else o.checkerFunction=function(){var n=o.getHash();if(n!==t){t=n;o.Adapter.trigger(e,"hashchange")}return!0};o.intervalList.push(s(o.checkerFunction,o.options.hashChangeInterval));return!0};o.Adapter.onDomLoad(o.hashChangeInit)}if(o.emulated.pushState){o.onHashChange=function(t){var r=t&&t.newURL||n.location.href,i=o.getHashByUrl(r),s=null,u=null,a=null,f;if(o.isLastHash(i)){o.busy(!1);return!1}o.doubleCheckComplete();o.saveHash(i);if(i&&o.isTraditionalAnchor(i)){o.Adapter.trigger(e,"anchorchange");o.busy(!1);return!1}s=o.extractState(o.getFullUrl(i||n.location.href,!1),!0);if(o.isLastSavedState(s)){o.busy(!1);return!1}u=o.getHashByState(s);f=o.discardedState(s);if(f){o.getHashByIndex(-2)===o.getHashByState(f.forwardState)?o.back(!1):o.forward(!1);return!1}o.pushState(s.data,s.title,s.url,!1);return!0};o.Adapter.bind(e,"hashchange",o.onHashChange);o.pushState=function(t,r,i,s){if(o.getHashByUrl(i))throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(s!==!1&&o.busy()){o.pushQueue({scope:o,callback:o.pushState,args:arguments,queue:s});return!1}o.busy(!0);var u=o.createStateObject(t,r,i),a=o.getHashByState(u),f=o.getState(!1),l=o.getHashByState(f),c=o.getHash();o.storeState(u);o.expectedStateId=u.id;o.recycleState(u);o.setTitle(u);if(a===l){o.busy(!1);return!1}if(a!==c&&a!==o.getShortUrl(n.location.href)){o.setHash(a,!1);return!1}o.saveState(u);o.Adapter.trigger(e,"statechange");o.busy(!1);return!0};o.replaceState=function(e,t,n,r){if(o.getHashByUrl(n))throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(r!==!1&&o.busy()){o.pushQueue({scope:o,callback:o.replaceState,args:arguments,queue:r});return!1}o.busy(!0);var i=o.createStateObject(e,t,n),s=o.getState(!1),u=o.getStateByIndex(-2);o.discardState(s,i,u);o.pushState(i.data,i.title,i.url,!1);return!0}}o.emulated.pushState&&o.getHash()&&!o.emulated.hashChange&&o.Adapter.onDomLoad(function(){o.Adapter.trigger(e,"hashchange")})};typeof o.init!="undefined"&&o.init()})(window);(function(e,t){"use strict";var n=e.console||t,r=e.document,i=e.navigator,s=e.sessionStorage||!1,o=e.setTimeout,u=e.clearTimeout,a=e.setInterval,f=e.clearInterval,l=e.JSON,c=e.alert,h=e.History=e.History||{},p=e.history;l.stringify=l.stringify||l.encode;l.parse=l.parse||l.decode;if(typeof h.init!="undefined")throw new Error("History.js Core has already been loaded...");h.init=function(){if(typeof h.Adapter=="undefined")return!1;typeof h.initCore!="undefined"&&h.initCore();typeof h.initHtml4!="undefined"&&h.initHtml4();return!0};h.initCore=function(){if(typeof h.initCore.initialized!="undefined")return!1;h.initCore.initialized=!0;h.options=h.options||{};h.options.hashChangeInterval=h.options.hashChangeInterval||100;h.options.safariPollInterval=h.options.safariPollInterval||500;h.options.doubleCheckInterval=h.options.doubleCheckInterval||500;h.options.storeInterval=h.options.storeInterval||1e3;h.options.busyDelay=h.options.busyDelay||250;h.options.debug=h.options.debug||!1;h.options.initialTitle=h.options.initialTitle||r.title;h.intervalList=[];h.clearAllIntervals=function(){var e,t=h.intervalList;if(typeof t!="undefined"&&t!==null){for(e=0;e<t.length;e++)f(t[e]);h.intervalList=null}};h.debug=function(){(h.options.debug||!1)&&h.log.apply(h,arguments)};h.log=function(){var e=typeof n!="undefined"&&typeof n.log!="undefined"&&typeof n.log.apply!="undefined",t=r.getElementById("log"),i,s,o,u,a;if(e){u=Array.prototype.slice.call(arguments);i=u.shift();typeof n.debug!="undefined"?n.debug.apply(n,[i,u]):n.log.apply(n,[i,u])}else i="\n"+arguments[0]+"\n";for(s=1,o=arguments.length;s<o;++s){a=arguments[s];if(typeof a=="object"&&typeof l!="undefined")try{a=l.stringify(a)}catch(f){}i+="\n"+a+"\n"}if(t){t.value+=i+"\n-----\n";t.scrollTop=t.scrollHeight-t.clientHeight}else e||c(i);return!0};h.getInternetExplorerMajorVersion=function(){var e=h.getInternetExplorerMajorVersion.cached=typeof h.getInternetExplorerMajorVersion.cached!="undefined"?h.getInternetExplorerMajorVersion.cached:function(){var e=3,t=r.createElement("div"),n=t.getElementsByTagName("i");while((t.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->")&&n[0]);return e>4?e:!1}();return e};h.isInternetExplorer=function(){var e=h.isInternetExplorer.cached=typeof h.isInternetExplorer.cached!="undefined"?h.isInternetExplorer.cached:Boolean(h.getInternetExplorerMajorVersion());return e};h.emulated={pushState:!Boolean(e.history&&e.history.pushState&&e.history.replaceState&&!/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(i.userAgent)&&!/AppleWebKit\/5([0-2]|3[0-2])/i.test(i.userAgent)),hashChange:Boolean(!("onhashchange"in e||"onhashchange"in r)||h.isInternetExplorer()&&h.getInternetExplorerMajorVersion()<8)};h.enabled=!h.emulated.pushState;h.bugs={setHash:Boolean(!h.emulated.pushState&&i.vendor==="Apple Computer, Inc."&&/AppleWebKit\/5([0-2]|3[0-3])/.test(i.userAgent)),safariPoll:Boolean(!h.emulated.pushState&&i.vendor==="Apple Computer, Inc."&&/AppleWebKit\/5([0-2]|3[0-3])/.test(i.userAgent)),ieDoubleCheck:Boolean(h.isInternetExplorer()&&h.getInternetExplorerMajorVersion()<8),hashEscape:Boolean(h.isInternetExplorer()&&h.getInternetExplorerMajorVersion()<7)};h.isEmptyObject=function(e){for(var t in e)return!1;return!0};h.cloneObject=function(e){var t,n;if(e){t=l.stringify(e);n=l.parse(t)}else n={};return n};h.getRootUrl=function(){var e=r.location.protocol+"//"+(r.location.hostname||r.location.host);if(r.location.port||!1)e+=":"+r.location.port;e+="/";return e};h.getBaseHref=function(){var e=r.getElementsByTagName("base"),t=null,n="";if(e.length===1){t=e[0];n=t.href.replace(/[^\/]+$/,"")}n=n.replace(/\/+$/,"");n&&(n+="/");return n};h.getBaseUrl=function(){var e=h.getBaseHref()||h.getBasePageUrl()||h.getRootUrl();return e};h.getPageUrl=function(){var e=h.getState(!1,!1),t=(e||{}).url||r.location.href,n;n=t.replace(/\/+$/,"").replace(/[^\/]+$/,function(e,t,n){return/\./.test(e)?e:e+"/"});return n};h.getBasePageUrl=function(){var e=r.location.href.replace(/[#\?].*/,"").replace(/[^\/]+$/,function(e,t,n){return/[^\/]$/.test(e)?"":e}).replace(/\/+$/,"")+"/";return e};h.getFullUrl=function(e,t){var n=e,r=e.substring(0,1);t=typeof t=="undefined"?!0:t;/[a-z]+\:\/\//.test(e)||(r==="/"?n=h.getRootUrl()+e.replace(/^\/+/,""):r==="#"?n=h.getPageUrl().replace(/#.*/,"")+e:r==="?"?n=h.getPageUrl().replace(/[\?#].*/,"")+e:t?n=h.getBaseUrl()+e.replace(/^(\.\/)+/,""):n=h.getBasePageUrl()+e.replace(/^(\.\/)+/,""));return n.replace(/\#$/,"")};h.getShortUrl=function(e){var t=e,n=h.getBaseUrl(),r=h.getRootUrl();t=t.replace(r,"/");h.isTraditionalAnchor(t)&&(t="./"+t);t=t.replace(/^(\.\/)+/g,"./").replace(/\#$/,"");return t};h.store={};h.idToState=h.idToState||{};h.stateToId=h.stateToId||{};h.urlToId=h.urlToId||{};h.storedStates=h.storedStates||[];h.savedStates=h.savedStates||[];h.normalizeStore=function(){h.store.idToState=h.store.idToState||{};h.store.urlToId=h.store.urlToId||{};h.store.stateToId=h.store.stateToId||{}};h.getState=function(e,t){typeof e=="undefined"&&(e=!0);typeof t=="undefined"&&(t=!0);var n=h.getLastSavedState();!n&&t&&(n=h.createStateObject());if(e){n=h.cloneObject(n);n.url=n.cleanUrl||n.url}return n};h.getIdByState=function(e){var t=h.extractId(e.url),n;if(!t){n=h.getStateString(e);if(typeof h.stateToId[n]!="undefined")t=h.stateToId[n];else if(typeof h.store.stateToId[n]!="undefined")t=h.store.stateToId[n];else{for(;;){t=(new Date).getTime()+String(Math.random()).replace(/\D/g,"");if(typeof h.idToState[t]=="undefined"&&typeof h.store.idToState[t]=="undefined")break}h.stateToId[n]=t;h.idToState[t]=e}}return t};h.normalizeState=function(e){var t,n;if(!e||typeof e!="object")e={};if(typeof e.normalized!="undefined")return e;if(!e.data||typeof e.data!="object")e.data={};t={};t.normalized=!0;t.title=e.title||"";t.url=h.getFullUrl(h.unescapeString(e.url||r.location.href));t.hash=h.getShortUrl(t.url);t.data=h.cloneObject(e.data);t.id=h.getIdByState(t);t.cleanUrl=t.url.replace(/\??\&_suid.*/,"");t.url=t.cleanUrl;n=!h.isEmptyObject(t.data);if(t.title||n){t.hash=h.getShortUrl(t.url).replace(/\??\&_suid.*/,"");/\?/.test(t.hash)||(t.hash+="?");t.hash+="&_suid="+t.id}t.hashedUrl=h.getFullUrl(t.hash);(h.emulated.pushState||h.bugs.safariPoll)&&h.hasUrlDuplicate(t)&&(t.url=t.hashedUrl);return t};h.createStateObject=function(e,t,n){var r={data:e,title:t,url:n};r=h.normalizeState(r);return r};h.getStateById=function(e){e=String(e);var n=h.idToState[e]||h.store.idToState[e]||t;return n};h.getStateString=function(e){var t,n,r;t=h.normalizeState(e);n={data:t.data,title:e.title,url:e.url};r=l.stringify(n);return r};h.getStateId=function(e){var t,n;t=h.normalizeState(e);n=t.id;return n};h.getHashByState=function(e){var t,n;t=h.normalizeState(e);n=t.hash;return n};h.extractId=function(e){var t,n,r;n=/(.*)\&_suid=([0-9]+)$/.exec(e);r=n?n[1]||e:e;t=n?String(n[2]||""):"";return t||!1};h.isTraditionalAnchor=function(e){var t=!/[\/\?\.]/.test(e);return t};h.extractState=function(e,t){var n=null,r,i;t=t||!1;r=h.extractId(e);r&&(n=h.getStateById(r));if(!n){i=h.getFullUrl(e);r=h.getIdByUrl(i)||!1;r&&(n=h.getStateById(r));!n&&t&&!h.isTraditionalAnchor(e)&&(n=h.createStateObject(null,null,i))}return n};h.getIdByUrl=function(e){var n=h.urlToId[e]||h.store.urlToId[e]||t;return n};h.getLastSavedState=function(){return h.savedStates[h.savedStates.length-1]||t};h.getLastStoredState=function(){return h.storedStates[h.storedStates.length-1]||t};h.hasUrlDuplicate=function(e){var t=!1,n;n=h.extractState(e.url);t=n&&n.id!==e.id;return t};h.storeState=function(e){h.urlToId[e.url]=e.id;h.storedStates.push(h.cloneObject(e));return e};h.isLastSavedState=function(e){var t=!1,n,r,i;if(h.savedStates.length){n=e.id;r=h.getLastSavedState();i=r.id;t=n===i}return t};h.saveState=function(e){if(h.isLastSavedState(e))return!1;h.savedStates.push(h.cloneObject(e));return!0};h.getStateByIndex=function(e){var t=null;typeof e=="undefined"?t=h.savedStates[h.savedStates.length-1]:e<0?t=h.savedStates[h.savedStates.length+e]:t=h.savedStates[e];return t};h.getHash=function(){var e=h.unescapeHash(r.location.hash);return e};h.unescapeString=function(t){var n=t,r;for(;;){r=e.unescape(n);if(r===n)break;n=r}return n};h.unescapeHash=function(e){var t=h.normalizeHash(e);t=h.unescapeString(t);return t};h.normalizeHash=function(e){var t=e.replace(/[^#]*#/,"").replace(/#.*/,"");return t};h.setHash=function(e,t){var n,i,s;if(t!==!1&&h.busy()){h.pushQueue({scope:h,callback:h.setHash,args:arguments,queue:t});return!1}n=h.escapeHash(e);h.busy(!0);i=h.extractState(e,!0);if(i&&!h.emulated.pushState)h.pushState(i.data,i.title,i.url,!1);else if(r.location.hash!==n)if(h.bugs.setHash){s=h.getPageUrl();h.pushState(null,null,s+"#"+n,!1)}else r.location.hash=n;return h};h.escapeHash=function(t){var n=h.normalizeHash(t);n=e.escape(n);h.bugs.hashEscape||(n=n.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?"));return n};h.getHashByUrl=function(e){var t=String(e).replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");t=h.unescapeHash(t);return t};h.setTitle=function(e){var t=e.title,n;if(!t){n=h.getStateByIndex(0);n&&n.url===e.url&&(t=n.title||h.options.initialTitle)}try{r.getElementsByTagName("title")[0].innerHTML=t.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(i){}r.title=t;return h};h.queues=[];h.busy=function(e){typeof e!="undefined"?h.busy.flag=e:typeof h.busy.flag=="undefined"&&(h.busy.flag=!1);if(!h.busy.flag){u(h.busy.timeout);var t=function(){var e,n,r;if(h.busy.flag)return;for(e=h.queues.length-1;e>=0;--e){n=h.queues[e];if(n.length===0)continue;r=n.shift();h.fireQueueItem(r);h.busy.timeout=o(t,h.options.busyDelay)}};h.busy.timeout=o(t,h.options.busyDelay)}return h.busy.flag};h.busy.flag=!1;h.fireQueueItem=function(e){return e.callback.apply(e.scope||h,e.args||[])};h.pushQueue=function(e){h.queues[e.queue||0]=h.queues[e.queue||0]||[];h.queues[e.queue||0].push(e);return h};h.queue=function(e,t){typeof e=="function"&&(e={callback:e});typeof t!="undefined"&&(e.queue=t);h.busy()?h.pushQueue(e):h.fireQueueItem(e);return h};h.clearQueue=function(){h.busy.flag=!1;h.queues=[];return h};h.stateChanged=!1;h.doubleChecker=!1;h.doubleCheckComplete=function(){h.stateChanged=!0;h.doubleCheckClear();return h};h.doubleCheckClear=function(){if(h.doubleChecker){u(h.doubleChecker);h.doubleChecker=!1}return h};h.doubleCheck=function(e){h.stateChanged=!1;h.doubleCheckClear();h.bugs.ieDoubleCheck&&(h.doubleChecker=o(function(){h.doubleCheckClear();h.stateChanged||e();return!0},h.options.doubleCheckInterval));return h};h.safariStatePoll=function(){var t=h.extractState(r.location.href),n;if(!h.isLastSavedState(t)){n=t;n||(n=h.createStateObject());h.Adapter.trigger(e,"popstate");return h}return};h.back=function(e){if(e!==!1&&h.busy()){h.pushQueue({scope:h,callback:h.back,args:arguments,queue:e});return!1}h.busy(!0);h.doubleCheck(function(){h.back(!1)});p.go(-1);return!0};h.forward=function(e){if(e!==!1&&h.busy()){h.pushQueue({scope:h,callback:h.forward,args:arguments,queue:e});return!1}h.busy(!0);h.doubleCheck(function(){h.forward(!1)});p.go(1);return!0};h.go=function(e,t){var n;if(e>0)for(n=1;n<=e;++n)h.forward(t);else{if(!(e<0))throw new Error("History.go: History.go requires a positive or negative integer passed.");for(n=-1;n>=e;--n)h.back(t)}return h};if(h.emulated.pushState){var d=function(){};h.pushState=h.pushState||d;h.replaceState=h.replaceState||d}else{h.onPopState=function(t,n){var i=!1,s=!1,o,u;h.doubleCheckComplete();o=h.getHash();if(o){u=h.extractState(o||r.location.href,!0);if(u)h.replaceState(u.data,u.title,u.url,!1);else{h.Adapter.trigger(e,"anchorchange");h.busy(!1)}h.expectedStateId=!1;return!1}i=h.Adapter.extractEventData("state",t,n)||!1;i?s=h.getStateById(i):h.expectedStateId?s=h.getStateById(h.expectedStateId):s=h.extractState(r.location.href);s||(s=h.createStateObject(null,null,r.location.href));h.expectedStateId=!1;if(h.isLastSavedState(s)){h.busy(!1);return!1}h.storeState(s);h.saveState(s);h.setTitle(s);h.Adapter.trigger(e,"statechange");h.busy(!1);return!0};h.Adapter.bind(e,"popstate",h.onPopState);h.pushState=function(t,n,r,i){if(h.getHashByUrl(r)&&h.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(i!==!1&&h.busy()){h.pushQueue({scope:h,callback:h.pushState,args:arguments,queue:i});return!1}h.busy(!0);var s=h.createStateObject(t,n,r);if(h.isLastSavedState(s))h.busy(!1);else{h.storeState(s);h.expectedStateId=s.id;p.pushState(s.id,s.title,s.url);h.Adapter.trigger(e,"popstate")}return!0};h.replaceState=function(t,n,r,i){if(h.getHashByUrl(r)&&h.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(i!==!1&&h.busy()){h.pushQueue({scope:h,callback:h.replaceState,args:arguments,queue:i});return!1}h.busy(!0);var s=h.createStateObject(t,n,r);if(h.isLastSavedState(s))h.busy(!1);else{h.storeState(s);h.expectedStateId=s.id;p.replaceState(s.id,s.title,s.url);h.Adapter.trigger(e,"popstate")}return!0}}if(s){try{h.store=l.parse(s.getItem("History.store"))||{}}catch(v){h.store={}}h.normalizeStore()}else{h.store={};h.normalizeStore()}h.Adapter.bind(e,"beforeunload",h.clearAllIntervals);h.Adapter.bind(e,"unload",h.clearAllIntervals);h.saveState(h.storeState(h.extractState(r.location.href,!0)));if(s){h.onUnload=function(){var e,t;try{e=l.parse(s.getItem("History.store"))||{}}catch(n){e={}}e.idToState=e.idToState||{};e.urlToId=e.urlToId||{};e.stateToId=e.stateToId||{};for(t in h.idToState){if(!h.idToState.hasOwnProperty(t))continue;e.idToState[t]=h.idToState[t]}for(t in h.urlToId){if(!h.urlToId.hasOwnProperty(t))continue;e.urlToId[t]=h.urlToId[t]}for(t in h.stateToId){if(!h.stateToId.hasOwnProperty(t))continue;e.stateToId[t]=h.stateToId[t]}h.store=e;h.normalizeStore();s.setItem("History.store",l.stringify(e))};h.intervalList.push(a(h.onUnload,h.options.storeInterval));h.Adapter.bind(e,"beforeunload",h.onUnload);h.Adapter.bind(e,"unload",h.onUnload)}if(!h.emulated.pushState){h.bugs.safariPoll&&h.intervalList.push(a(h.safariStatePoll,h.options.safariPollInterval));if(i.vendor==="Apple Computer, Inc."||(i.appCodeName||"")==="Mozilla"){h.Adapter.bind(e,"hashchange",function(){h.Adapter.trigger(e,"popstate")});h.getHash()&&h.Adapter.onDomLoad(function(){h.Adapter.trigger(e,"hashchange")})}}};h.init()})(window);$.getObject("Pb.History",!0).HistoryManager=function(){function e(){this.init()}var t={pageState:{},pageTitle:null,pageUrl:null,init:function(){this.bindEvents()},bindEvents:function(){$(document).on("HistoryManager::updatePageHistory",$.proxy(function(e){this.updatePageHistory(e)},this))},updatePageHistory:function(e){var t=e.replace?!0:!1;e.state&&this.setCurrentState(e.state);e.url&&this.setPageUrl(e.url);e.title&&this.setPageTitle(e.title);this.updateState(t)},updateState:function(e){if(typeof History!="undefined")try{e?History.replaceState(this.pageState,this.pageTitle,this.pageUrl):History.pushState(this.pageState,this.pageTitle,this.pageUrl)}catch(t){typeof console!="undefined"&&console.log(t)}},collapseEmail:function(e){if(e.indexOf("/images/")!==-1){var t=e.split("/images/"),n=t[t.length-1];t[t.length-1]=n.replace(/[\@|\.]/gi,"");e=t.join("/images/")}return e},setCurrentState:function(e){this.pageState=e},setPageUrl:function(e){e.indexOf("@")!==-1&&(e=this.collapseEmail(e));this.pageUrl=e},setPageTitle:function(e){this.pageTitle=e}};e.prototype=t;return e}();$.getObject("Pb.History",!0).HistoryManager=new Pb.History.HistoryManager;(function(){var e=typeof window!="undefined"?window:exports,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n=function(){try{document.createElement("$")}catch(e){return e}}();e.btoa||(e.btoa=function(e){for(var r,i,s=0,o=t,u="";e.charAt(s|0)||(o="=",s%1);u+=o.charAt(63&r>>8-s%1*8)){i=e.charCodeAt(s+=.75);if(i>255)throw n;r=r<<8|i}return u});e.atob||(e.atob=function(e){e=e.replace(/=+$/,"");if(e.length%4==1)throw n;for(var r=0,i,s,o=0,u="";s=e.charAt(o++);~s&&(i=r%4?i*64+s:s,r++%4)?u+=String.fromCharCode(255&i>>(-2*r&6)):0)s=t.indexOf(s);return u})})();$.getObject("Pb.Media",!0).MediaIdentifierFactory=function(){function e(){}var t={getIdentifier:function(e){var t;e instanceof Pb.Path.PBPath?t=this.fromPBPath(e):e.path?t=this.fromPBPath(new Pb.Path.PBPath(e.path)):t=null;return t},fromPBPath:function(e){var t=null;if(e.filename!==null){var n="path:";e.location===""||e.location===null?n+="/"+e.filename:n+=e.location+e.filename;t=btoa(n)}return t}};$.extend(e.prototype,t);return new e}();$.getObject("Pb.Component.Detail",!0).Stats=function(){function e(e){this.init(e)}var t={exifData:[],likesViewData:[],init:function(e){$.views.helpers({parseExifData:function(e){var t="";for(var n in e)n.length>0&&(t+="<li>"+n+":</li><li class='value'>"+e[n]+"</li>");return t}});this.currentMedia=Pb.Data.get(Pb.Data.Shared.MEDIA);this.bindEvents();$.ajax({url:Pb.Data.get("statsContainer").statsFetchData,type:"get",success:$.proxy(function(e){$("#statsPlaceholder").replaceWith(e)},this)});this.link()},bindEvents:function(){$(document).on("Pb.Component.Media.Media::template-update",$.proxy(this.handleMediaContentUpdate,this));$(document).on("click",".detailStatsWrapper #showmore",$.proxy(this.fetchExif,this))},setCurrentMedia:function(e){this.currentMedia=e},handleMediaContentUpdate:function(e){this.setCurrentMedia(e.newTarget);this.hideExif()},link:function(){Pb.JSTemplates.link("#statsExifTemplate","#exifData",[this.exifData]);Pb.JSTemplates.link("#likesViewsTemplate","#viewData",[this.likesViewData]);$("#statsCounts").hide()},fetchExif:function(){$(".moretoggle").hide();$("#statsLoading").show();Pb.Track.tr("detailpage_mediainfo_more_click");var e=new Pb.Path.PBPath(this.currentMedia.path),t=Pb.Media.MediaIdentifierFactory.getIdentifier(e),n={type:"GET",url:"/api/user/"+e.ownername+"/media/"+encodeURIComponent(t)+"/exif",messageHandler:function(){return!0},error:function(){this.showExif([])},success:$.proxy(function(e){e.status===1?this.showExif(e.data):this.showExif([])},this)};Pb.Ajax.ajax(n)},showExif:function(e){this.exifData=e;this.likesViewData={viewCount:this.currentMedia.viewCount.toString(),likeCount:this.currentMedia.likeCount.toString()};this.link();$("#statsCounts").show();$("#statsLoading").hide();$("#viewData").show()},hideExif:function(){this.exifData=[];this.link();$("#statsCounts").hide();$("#statsLoading").hide();$("#viewData").hide();this.currentMedia.mediaType!=="image"?$(".moretoggle").hide():$(".moretoggle").show()}};$.extend(e.prototype,t);return e}();!function(e){"use strict";var t=function(t,n){this.$element=e(t);this.options=e.extend({},e.fn.button.defaults,n)};t.prototype={constructor:t,setState:function(e){var t="disabled",n=this.$element,r=n.data(),i=n.is("input")?"val":"html";e+="Text";r.resetText||n.data("resetText",n[i]());n[i](r[e]||this.options[e]);setTimeout(function(){e=="loadingText"?n.addClass(t).attr(t,t):n.removeClass(t).removeAttr(t)},0)},toggle:function(){var e=this.$element.parent('[data-toggle="buttons-radio"]');e&&e.find(".active").removeClass("active");this.$element.toggleClass("active")}};e.fn.button=function(n){return this.each(function(){var r=e(this),i=r.data("button"),s=typeof n=="object"&&n;i||r.data("button",i=new t(this,s));n=="toggle"?i.toggle():n&&i.setState(n)})};e.fn.button.defaults={loadingText:"loading..."};e.fn.button.Constructor=t;e(function(){e("body").on("click.button.data-api","[data-toggle^=button]",function(t){var n=e(t.target);n.hasClass("btn")||(n=n.closest(".btn"));n.button("toggle")})})}(window.jQuery);$.getObject("Pb.Component.Common.Follow",!0).FollowAction=function(){function t(t){e=t;var n=u()||e.data("followee");i();var s={url:"/action/follow/follow",type:"POST",data:{followType:e.data("type"),followee:n,userId:e.data("user-id")},success:r,error:o};Pb.Ajax.ajax(s)}function n(t){e=t;var n=u()||e.data("followee");i();var s={url:"/action/follow/unfollow",type:"POST",data:{followType:e.data("type"),followee:n,userId:e.data("user-id")},success:r,error:o};Pb.Ajax.ajax(s)}function r(e){var t=e.status;t?s():o()}function i(){var t=$.Event("Pb.Component.Common.Follow.FollowAction::action_start");$(e).trigger(t)}function s(){var t=$.Event("Pb.Component.Common.Follow.FollowAction::action_complete");t.action=this.followState;$(e).trigger(t)}function o(){var t=$.Event("Pb.Component.Common.Follow.FollowAction::action_error");$(e).trigger(t)}function u(){var e=this.currentData||null;if(e){var e=Pb.Data.Shared.get("shared.media"),t=Pb.Data.Shared.get("shared.mediaSet"),n=t[e.offset].username;return n}}var e=null;if(Pb.Data.get(Pb.Data.Shared.MEDIA)){this.currentData=Pb.Data.get(Pb.Data.Shared.MEDIA);this.followState=this.currentData.isFollowing}return{follow:t,unfollow:n}}();$.getObject("Pb.Component.Common.Follow",!0).Button=function(){function e(){this.init.apply(this,arguments)}$.extend(e.prototype,{isLoggedIn:null,isMobile:!1,init:function(e){this.isLoggedIn=Pb.Data.get("isLoggedIn");this.isMobile=Pb.Data.get("isMobile");this.initEvents()},initEvents:function(){var e=this;$(document.body).on("mouseover mouseout","a.follow.following",function(t){t.type==="mouseover"&&!e.isMobile?e.showHover($(this)):e.isMobile||e.hideHover($(this))}).on("click","a.follow:not(.postAuthAction)",function(t){t.preventDefault();Pb.Track.tr("follow button click");e.toggle($(this))}).on("Pb.Component.Common.Follow.FollowAction::action_start","a.follow",this.toggleStart).on("Pb.Component.Common.Follow.FollowAction::action_complete","a.follow",this.toggleComplete).on("Pb.Component.Common.Follow.FollowAction::action_error","a.follow",this.toggleReset)},showHover:function(e){e.find("span").text("Unfollow");e.hasClass("btn-link")||e.addClass("btn-secondary")},hideHover:function(e){e.find("span").text("Following");e.removeClass("btn-secondary");e.find("i").removeClass("sicon-minus-sign")},toggle:function(e){if(!this.isLoggedIn){e.tooltip({delay:{show:2e3,hide:2e3}});e.tooltip("show");return}if(!e.hasClass("disabled"))if(e.hasClass("following")){e.data("complete-text","Follow");Pb.Component.Common.Follow.FollowAction.unfollow(e)}else{e.data("complete-text","Following");Pb.Component.Common.Follow.FollowAction.follow(e)}},toggleStart:function(e){$(e.currentTarget).button("loading")},toggleComplete:function(e){if($(e.currentTarget).data("remove-id")){$("#"+$(e.currentTarget).data("remove-id")).remove();return}if($(e.currentTarget).hasClass("following")){$(e.currentTarget).removeClass("following");if(!Pb.Data.get("isMobile")){$(e.currentTarget).removeClass("btn-secondary");$(e.currentTarget).addClass("btn-primary")}}else{$(e.currentTarget).removeClass("btn-primary");$(e.currentTarget).addClass("btn-secondary");$(e.currentTarget).addClass("following")}$(e.currentTarget).button("complete");$(e.currentTarget).wrapInner("<span>");$(e.currentTarget).prepend("<i>")},toggleReset:function(e){Pb.Component.Element.Message.showDefaultErrorMessage();$(e.currentTarget).button("reset")}});return e}();Pb.InitEventQueue.addToDomReady(function(){new Pb.Component.Common.Follow.Button});$.getObject("Pb.Component.Detail",!0).DetailActions=function(){function e(e){this.init(e)}var t={isLoggedIn:!1,isCompact:!1,isMobile:!1,actionTargetNormalId:"#detailActions",actionTargetCompactId:"#detailActionsCompact",actionTarget:null,actionTemplate:"#detailActionsTemplate",actionData:[],defaultActionData:[],showPagination:!0,eventRegister:null,currentMedia:null,currentMediaUrl:null,currentMediaIsOwner:!1,rotatePostUrl:"/action/media/rotate",init:function(e){this.showPagination=e.showPagination;this.isMobile=Pb.Data.get("isMobile");this.defaultActionData=e;this.actionData=$.extend(!0,{},this.defaultActionData);this.setCurrentMedia(Pb.Data.Shared.get(Pb.Data.Shared.MEDIA));this.getElements();this.isMobile&&(this.actionTemplate="#detailActionsMobileTemplate");for(var t=0;t<this.actionData.eventRegister.length;t++)$(document).trigger($.Event("ActionEventsDispatcher::registerevent",{pbEvent:{eventSelector:this.actionData.eventRegister[t].eventSelector,eventType:this.actionData.eventRegister[t].eventType,event:this.actionData.eventRegister[t].event}}));this.bindEvents();this.link()},setCurrentMedia:function(e){this.isLoggedIn=Pb.Data.get("isLoggedIn");this.currentMedia=e;this.currentMediaUrl=e.fullsizeUrl;this.currentMediaIsOwner=e.io;this.actionData.btngroupsocial=this.setOwnerOptionPerms(this.actionData.btngroupsocial);this.actionData.btngroupshare=this.setOwnerOptionPerms(this.actionData.btngroupshare);this.actionData.btngrouptools.items=this.setOwnerOptionPerms(this.actionData.btngrouptools);this.actionData.btngroupnav.items=this.setOwnerOptionPerms(this.actionData.btngroupnav)},setOwnerOptionPerms:function(e){var t=[],n=this.currentMedia.mediaType==="image";for(var r=0;r<e.length;r++){var i=e[r];i.jsAttributes.checkperms?i.jsAttributes.identifier==="edit"?(this.currentMediaIsOwner||this.currentMedia.cd)&&n&&t.push(i):i.jsAttributes.identifier==="slideshow"?this.showPagination&&this.currentMedia.context==="album"&&t.push(i):i.jsAttributes.identifier==="download_button"?this.currentMedia.cd&&this.currentMedia.downloadUrl&&t.push(i):i.jsAttributes.identifier==="btnprev"?this.showPagination&&t.push(i):i.jsAttributes.identifier==="btnnext"?this.showPagination&&t.push(i):i.jsAttributes.identifier==="btnalbum"?this.showPagination&&t.push(i):i.jsAttributes.identifier==="btnstory"?this.showPagination&&t.push(i):i.jsAttributes.identifier==="btnzoom"?(this.showPagination||this.isMobile)&&t.push(i):this.currentMediaIsOwner&&t.push(i):t.push(i)}return t},getElements:function(){this.actionTarget=$("#detailActions")},bindEvents:function(){var e=$(document);e.on("Pb.Component.Media.Media::template-update",$.proxy(this.handleMediaContentUpdate,this));e.on("Pb.Component.Filmstrip.Filmstrip::compact",$.proxy(this.switchToCompactActions,this));e.on("Pb.Component.Filmstrip.Filmstrip::normal",$.proxy(this.switchToNormalActions,this));this.bindActions()},bindActions:function(){var e=$(document);e.on("DetailActions::facebook",$.proxy(function(e){Pb.Track.trf("detail_page_share_facebook_click");var t=e.pbData.ext==="gif"?"gif":e.pbData.mediaType;Pb.Component.Tracking.Mixpanel.trackShareClick({type:"facebook",component:"media detail",location:"top bar",sharable:t});this.isMobile&&window.open($(e.pbEventTarget).attr("href"),"_blank");if(Pb.Data.get("isLoggedIn")){typeof appboy!="undefined"&&appboy.logCustomEvent("web_media_share");$(document).trigger($.Event("Pb.Component.Share.ShareModal::show",{pbData:e.pbData,shareType:"facebook",shareMode:"media",pbEventTarget:e.pbEventTarget}));return}e.preventDefault();Pb.Component.Common.Social.Facebook.open(e.pbData.linkUrl,"detail")},this));e.on("DetailActions::gplus",$.proxy(function(e){e.preventDefault();Pb.Track.trf("detail_page_share_gplus_click");var t=e.pbData.ext==="gif"?"gif":e.pbData.mediaType;Pb.Component.Tracking.Mixpanel.trackShareClick({type:"gplus",component:"media detail",location:"top bar",sharable:t});typeof appboy!="undefined"&&appboy.logCustomEvent("web_media_share");Pb.Component.Common.Social.GooglePlus.open(e.pbData.fullsizeUrl,"detail")},this));e.on("DetailActions::pinterest",$.proxy(function(e){e.preventDefault();Pb.Track.trf("detail_page_share_pinterest_click");var t=e.pbData.ext==="gif"?"gif":e.pbData.mediaType;Pb.Component.Tracking.Mixpanel.trackShareClick({type:"pinterest",component:"media detail",location:"top bar",sharable:t});typeof appboy!="undefined"&&appboy.logCustomEvent("web_media_share");Pb.Component.Common.Social.Pinterest.open(e.pbData.linkUrl,"detail",e.pbData.fullsizeUrl)},this));e.on("DetailActions::tumblr",$.proxy(function(e){e.preventDefault();Pb.Track.trf("detail_page_share_tumblr_click");var t=e.pbData.ext==="gif"?"gif":e.pbData.mediaType;Pb.Component.Tracking.Mixpanel.trackShareClick({type:"tumblr",component:"media detail",location:"top bar",sharable:t});typeof appboy!="undefined"&&appboy.logCustomEvent("web_media_share");Pb.Component.Common.Social.Tumblr.open(e.pbData,"detail")},this));e.on("click","a.follow:not(.postAuthAction)",$.proxy(function(e){Pb.Data.get("detailModal")&&Pb.Component.Tracking.Mixpanel.trackActionClick({action:"follow",context:Pb.Data.get("detailModal").context})},this));e.on("click","#flagAsInappropriate",$.proxy(function(e){Pb.Data.get("detailModal")&&Pb.Component.Tracking.Mixpanel.trackActionClick({action:"flag",context:Pb.Data.get("detailModal").context})},this));e.on("DetailActions::twitter",$.proxy(function(e){Pb.Track.trf("detail_page_share_twitter_click");var t=e.pbData.ext==="gif"?"gif":e.pbData.mediaType;Pb.Component.Tracking.Mixpanel.trackShareClick({type:"twitter",component:"media detail",location:"top bar",sharable:t});this.isMobile&&window.open($(e.pbEventTarget).attr("href"),"_blank");if(Pb.Data.get("isLoggedIn")){typeof appboy!="undefined"&&appboy.logCustomEvent("web_media_share");$(document).trigger($.Event("Pb.Component.Share.ShareModal::show",{pbData:e.pbData,shareType:"twitter",shareMode:"media",pbEventTarget:e.pbEventTarget}));return}e.preventDefault();Pb.Component.Common.Social.Twitter.open(e.pbData.linkUrl,"detail")},this));e.on("DetailActions::email",$.proxy(function(e){Pb.Track.trf("detail_page_share_email_click");var t=e.pbData.ext==="gif"?"gif":e.pbData.mediaType;Pb.Component.Tracking.Mixpanel.trackShareClick({type:"email",component:"media detail",location:"top bar",sharable:t});this.isMobile&&(location.href=$(e.pbEventTarget).attr("href"));typeof appboy!="undefined"&&Pb.Data.Shared.get("loggedInUser")&&appboy.logCustomEvent("web_media_share");$(document).trigger($.Event("Pb.Component.Share.ShareModal::show",{pbData:e.pbData,shareType:"email",shareMode:"media",pbEventTarget:e.pbEventTarget}))},this));e.on("DetailActions::download_button",$.proxy(function(e){Pb.Track.trf("detail_page_download_button_click");this.isMobile&&(location.href=$(e.pbEventTarget).attr("href"));var t=e.pbData?e.pbData:Pb.Data.get(Pb.Data.Shared.MEDIA);document.location="/component/Download-File?file="+encodeURIComponent(t.path);Pb.Component.Ad&&Pb.Component.Ad.AdRefresh&&Pb.Component.Ad.AdRefresh.reloadAds()},this));e.on("DetailActions::links",$.proxy(function(e){Pb.Track.trf("detail_page_share_links_click");var t=e.pbData.ext==="gif"?"gif":e.pbData.mediaType;Pb.Component.Tracking.Mixpanel.trackShareClick({type:"links",component:"media detail",location:"top bar",sharable:t});this.isMobile&&(location.href=$(e.pbEventTarget).attr("href"));typeof appboy!="undefined"&&Pb.Data.Shared.get("loggedInUser")&&appboy.logCustomEvent("web_media_share");$(document).trigger($.Event("Pb.Component.Share.ShareModal::show",{pbData:e.pbData,shareType:"links",shareMode:"media",pbEventTarget:e.pbEventTarget}))},this));e.on("DetailActions::other",$.proxy(function(e){Pb.Track.trf("detail_page_share_other_click");var t=e.pbData.ext==="gif"?"gif":e.pbData.mediaType;Pb.Component.Tracking.Mixpanel.trackShareClick({type:"other",component:"media detail",location:"top bar",sharable:t});this.isMobile&&(location.href=$(e.pbEventTarget).attr("href"));typeof appboy!="undefined"&&Pb.Data.Shared.get("loggedInUser")&&appboy.logCustomEvent("web_media_share");$(document).trigger($.Event("Pb.Component.Share.ShareModal::show",{pbData:e.pbData,shareType:"social",shareMode:"media",pbEventTarget:e.pbEventTarget}))},this));e.on("DetailActions::slideshow",$.proxy(function(e){document.location="/user/"+Pb.Data.get(Pb.Data.Shared.MEDIA).ownername+"/slideshow/"+Pb.Data.get(Pb.Data.Shared.MEDIA).location},this));e.on("DetailActions::edit",$.proxy(function(e){document.location="/editor?image="+escape(this.currentMediaUrl)+"&detailUrl="+Pb.Data.get(Pb.Data.Shared.MEDIA).linkUrl},this));if(!this.showPagination&&!this.isMobile)return;e.on("click","#btnprev",function(){e.trigger($.Event("Pb.Component.Detail.DetailActions::media_previous_click"))});e.on("click","#btnnext",function(){e.trigger($.Event("Pb.Component.Detail.DetailActions::media_next_click"))});e.on("click","#btnalbum",function(){document.location=Pb.Data.get(Pb.Data.Shared.MEDIA).albumUrl});e.on("click","#btnstory",function(){document.location=Pb.Data.get(Pb.Data.Shared.MEDIA).storyUrl});e.on("click","#btnzoom",function(){document.location="/user/"+Pb.Data.get(Pb.Data.Shared.MEDIA).ownername+"/media-full/"+Pb.Data.get(Pb.Data.Shared.MEDIA).location+"/"+Pb.Data.get(Pb.Data.Shared.MEDIA).name+".html"})},switchToCompactActions:function(){if(this.isCompact)return;this.removeActionTarget();$("#mediaTemplateTarget").append('<div id="detailActionsCompact" class="detailActions detailActionsCompact"></div>');this.actionTarget=$(this.actionTargetCompactId);this.actionTemplate="#detailActionsCompactTemplate";this.link();this.isCompact=!0},switchToNormalActions:function(){if(!this.isCompact)return;this.removeActionTarget();$(".detailfilmstripwrap").before('<div id="detailActions" class="detailActions"></div>');this.actionTarget=$(this.actionTargetNormalId);this.actionTemplate="#detailActionsTemplate";this.bindActions();this.link();this.isCompact=!1},handleMediaContentUpdate:function(e){this.setCurrentMedia(e.newTarget);if(this.isCompact){$("#mediaTemplateTarget").append('<div id="detailActionsCompact" class="detailActions detailActionsCompact"></div>');this.actionTarget=$(this.actionTargetCompactId)}this.link();this.isMobile&&this.actionTarget.find(".btn-social").each($.proxy(function(e,t){var n=$(t).attr("href");n=n.replace(/(\?u=).*/,"?u="+encodeURIComponent(document.location.href));n=n.replace(/(\?text=).*/,"?text="+encodeURIComponent(document.location.href));$(t).attr("href",n)},this));this.fetchShareThis();this.currentMedia.mediaType==="image"?$(".imageOnly").removeClass("hide"):$(".imageOnly").addClass("hide")},fetchShareThis:function(){typeof stLight=="undefined"&&!this.isMobile&&$.ajax({url:"http://w.sharethis.com/button/buttons.js",dataType:"script",success:$.proxy(function(){stLight.options({publisher:"6b3cc47e-c11d-420e-a208-11704eb2c43b"})},this),cache:!0})},link:function(){Pb.JSTemplates.link(this.actionTemplate,this.actionTarget,this.actionData)},removeActionTarget:function(){this.actionTarget.off();this.actionTarget.parent()[0].removeChild(this.actionTarget[0])}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.Common.Social",!0).GooglePlus=function(){function e(e,t){e.indexOf("?")>=0?e+="&":e+="?";var n="plus_share";t&&(n=t+"_"+n);e+="src=pb&evt="+n;e=encodeURIComponent(e);window.open("https://plus.google.com/share?url="+e,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600")}return{open:e}}();$.getObject("Pb.Component.Common.Social",!0).Pinterest=function(){function e(e,t,n){var r=t+"_pinterest_share",i="http://www.pinterest.com/pin/create/button/?url=",s="",o={url:e,directUrl:n,trackingKey:r},u="menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600";Object.keys(o).forEach(function(e){o[e]=encodeURIComponent(o[e])});s+=o.url+"&media="+o.directUrl+"&src=pb&evt="+o.trackingKey;window.open(i+s,"",u)}return{open:e}}();$.getObject("Pb.Component.Common.Social",!0).Tumblr=function(){function e(e,t){var n=e.shareMode,e=e.shareObject?e.shareObject:e,r=t+"_tumblr_share",i="https://www.tumblr.com/share/",s="",o={trackingKey:r},u=e.description?e.description.text||e.description:"",a=e.title||e.name;windowParams="menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600";n==="media"||e.mediaType?i+="photo?source="+encodeURIComponent(e.fullsizeUrl)+"&caption="+encodeURIComponent(a)+"&clickthru="+encodeURIComponent(e.linkUrl):n==="story"?i+="video?embed="+encodeURIComponent(e.linkcodes[1].inputText)+"&caption="+encodeURIComponent(a)+"&clickthru="+encodeURIComponent(e.storyUrl):i+="link?url="+encodeURIComponent(e.url||e.URL)+"&name="+encodeURIComponent(a)+"&description="+encodeURIComponent(u);s+="&src=pb&evt="+o.trackingKey;window.open(i+s,"",windowParams)}return{open:e}}();$.getObject("Pb.Component.Common.Social",!0).Facebook=function(){function e(e,t){e.indexOf("?")>=0?e+="&":e+="?";var n="facebook_share";t&&(n=t+"_"+n);e+="src=pb&evt="+n;FB.ui({method:"share",href:e},function(e){})}return{open:e}}();$.getObject("Pb.Component.Common.Social",!0).Twitter=function(){function e(e,t){e.indexOf("?")>=0?e+="&":e+="?";var n="twitter_share";t&&(n=t+"_"+n);e+="src=pb&evt="+n;e=encodeURIComponent(e);window.open("https://twitter.com/share?url="+e,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600")}return{open:e}}();$.getObject("Pb.Component.Share",!0).ShareModal=function(){function e(){e.superclass.constructor.call(this)}var t,n={currentController:null,privacy:null,linkTitle:null,init:function(t){var n={eventName:"Pb.Component.Share.ShareModal::show",shownEvent:"Pb.Component.Share.ShareModal::shown",hideEvent:"Pb.Component.Share.ShareModal::hidden",modalId:"#shareModal",modalName:"shareModal",showProgress:!0,refreshAdsOnHide:!0};t&&$.extend(n,t);e.superclass.init.call(this,n);this.initEvents(n);Pb.InitEventQueue.addToPageLoad(function(){if(Pb.Data.get("shareModal")&&Pb.Data.get("shareModal").isSponsoredEdit&&Pb.Data.get(Pb.Data.Shared.MEDIA).io){Pb.Data.get(Pb.Data.Shared.MEDIA).spedit=!0;$("#detailActions #facebook").click()}})},initEvents:function(e){$(document).trigger($.Event("ActionEventsDispatcher::registerevent",{pbEvent:{eventSelector:".shareModalAction",eventType:"click",event:e.eventName}}))},onShow:function(t){var n=t.pbData,r=t.shareMode,s=t.shareType,o=t.showPrint,u=t.pbEventTarget,a=t.url,f,l=!0,c=Pb.Data.get("shareModal");c.ajaxFetchData&&Pb.Ajax.ajax({url:c.ajaxFetchData,async:!1,success:function(e){if(e){c=$.extend(c,e);delete c.ajaxFetchData;Pb.Data.add("shareModal",c)}}});if(Pb.Data.get("shareModal").isSponsoredEdit&&Pb.Data.get(Pb.Data.Shared.MEDIA).spedit){Pb.Data.get("shareModal").socialShare.mediaDefaultMessage=Pb.Data.get("shareModal").sponsoredShareMessage;Pb.Data.get("shareModal").email.mediaDefaultMessage=Pb.Data.get("shareModal").sponsoredShareMessage;Pb.Data.get("shareModal").sponsor=Pb.Data.get("shareModal").sponsoredClass;Pb.Track.tr("share_modal_"+Pb.Data.get("shareModal").sponsoredClass+"_editor_view")}else{Pb.Data.get("shareModal").sponsor="";Pb.Data.get("shareModal").socialShare.mediaDefaultMessage=Pb.Data.get("shareModal").shareMessage;Pb.Data.get("shareModal").email.mediaDefaultMessage=Pb.Data.get("shareModal").shareMessage}r||(r=$(u).closest("[data-sharemode]").data("sharemode"));s||(s=$(u).closest("[data-sharetype]").data("sharetype"));if(!n&&$(".showingRecent").length){n=Pb.Data.Albums.getRootAlbum();n.slideshowUrl=null;n.data.url+="?view=recent";n.url=n.data.url;n.type="recent";this.privacy="Public";n.ownername=Pb.Data.get("libraryOwner")}r==="story"&&(n.items=Pb.Data.Shared.get("shared.albumStorySet"));if(!n&&($("#hashtagsSettings .hashtag").length||$(".emptyHashtagView").length)){r="hashtag";n={};n.slideshowUrl=null;n.url=a;$(".emptyHashtagView").length?n.hashtag=$(".emptyHashtagView").find(".hashtagLabel").text():n.hashtag=$("#hashtagsSettings .hashtag").text();this.privacy="Public";l=!1}n&&n.url&&n.url.length&&!n.fullsizeUrl&&(n.fullsizeUrl=n.url);f=this.getTitle(r,n);t.headerTitle=f;t.modalData={title:f,shareMode:r,shareType:s,shareObject:n,pbEventTarget:u};r==="story"&&(n.url=n.storyUrl);if(s==="gplus"){Pb.Component.Common.Social.GooglePlus.open(n.url,"share");return}if(s==="pinterest"){Pb.Component.Common.Social.Pinterest.open(n.url,"share",n.thumbUrl);return}if(s==="tumblr"){Pb.Component.Common.Social.Tumblr.open(t.modalData,"share");return}e.superclass.onShow.call(this,t);$(".spinner").hide();var h=$(this.modalId);h.on("hide",function(){Pb.Data.data.shareModal.tabs.activeTab="social"});t.embed&&(h=$(this.embedId));$("#patentMessage").hide();r==="story"&&$("#patentMessage").show();if(t.embed)Pb.Track.tr("share_embed_"+r+"_view");else{Pb.Track.tr("share_modal_"+r+"_view");Pb.Component.Tracking.Mixpanel.trackPageView({"page name":"share modal"})}$("#printPromotion").hide();if(o){if(n.mediaType==="image"){var p=n.fullsizeUrl.split(".").pop().toLowerCase();if(p!=="gif"){$("#printPromotion").show();$("#framedPromoLink").attr("href","/print/homedecor/framedprints?media="+encodeURI(n.path));$("#canvasPromoLink").attr("href","/print/homedecor/canvasprints?media="+encodeURI(n.path));$(".promoImage").attr("style","background-image: url('"+n.fullsizeUrl+"');")}}}else if(r==="media"||r==="search")$("#printPromotion").hide();else if(n.items){var d,v=n.items;for(i=0;i<v.length;i++){d=v[i];if(d===null)continue;if(d.mediaType==="image"||r==="slideshow"){var p=d.fullsizeUrl.split(".").pop().toLowerCase();if(p!=="gif"&&(d.isOwner||d.cd||n.cd)){$("#printPromotion").show();$("#framedPromoLink").attr("href","/print/homedecor/framedprints?album="+encodeURI(n.path));$("#canvasPromoLink").attr("href","/print/homedecor/canvasprints?album="+encodeURI(n.path));$(".promoImage").attr("style","background-image: url('"+d.fullsizeUrl+"');");break}}}}else $("#printPromotion").hide();h.find(".nav-tabs a#email").attr("data-target","#"+h.attr("id")+" #shareModal_email");h.find(".nav-tabs a#social").attr("data-target","#"+h.attr("id")+" #shareModal_social");h.find(".nav-tabs a").on("shown",$.proxy(function(e){var t=$(e.currentTarget).data("tabtype");Pb.Data.data.shareModal.tabs.activeTab=t;switch(t){case"email":this.currentController=Pb.Component.Share.Email;$(document).trigger($.Event("Pb.Component.Share.ShareModal::emailTabShown",{modal:h.attr("id")}));break;case"followers":this.currentController=Pb.Component.Share.Followers;$(document).trigger($.Event("Pb.Component.Share.ShareModal::followersTabShown",{modal:h.attr("id")}));break;case"social":this.currentController=Pb.Component.Share.SocialShare;$(document).trigger($.Event("Pb.Component.Share.ShareModal::socialTabShown",{modal:h.attr("id")}));break;case"links":this.currentController=Pb.Component.Share.SocialShare;$(document).trigger($.Event("Pb.Component.Share.ShareModal::socialTabShown",{modal:h.attr("id")}))}h.find(".linkCodes").children().length===0&&$(document).trigger($.Event("Pb.Component.Share.ShareModal::linksTabShown",{modal:h.attr("id")}))},this));var m=h.find(".nav-tabs");if(s==="email"){m.find('a[data-tabtype="email"]').tab("show");Pb.Component.Share.SocialShare.setOptions(null)}else if(s==="followers")m.find('a[data-tabtype="followers"]').tab("show");else{m.find('a[data-tabtype="social"]').tab("show");m.find('a[data-tabtype="social"]').trigger($.Event("shown"));if(s==="facebook"||s==="twitter"){Pb.Component.Share.SocialShare.setOptions({service:s});Pb.Component.Share.SocialShare.updateUI()}else Pb.Component.Share.SocialShare.setOptions({showMore:!0})}h.find("#shareModal_email").find("#shareModalSubmit").on("click",$.proxy(function(e){e.preventDefault();if(!$(this).hasClass("disabled")){Pb.Data.data.shareModal.shareObject.hashtag&&Pb.Track.tr("share_modal_"+Pb.Data.data.shareModal.tabs.activeTab+"_hashtag_share_click");var t=h.find("form:visible");t.length&&this.onSubmit(e)}},this));h.find("#shareModal_social").find("#shareModalSubmit").on("click",$.proxy(function(e){e.preventDefault();if(!$(this).hasClass("disabled")){Pb.Data.data.shareModal.shareObject.hashtag&&Pb.Track.tr("share_modal_"+Pb.Data.data.shareModal.tabs.activeTab+"_hashtag_share_click");var t=h.find("form:visible");t.length&&this.onSubmit(e)}},this));l?h.find("#linksTitle").text(this.linkTitle):h.find("a#links").parent().css("display","none");if(r==="search"){$("#shareModal_links").hide();$("#shareModal_links").css("width","0px");$(".tabContainer").css("width","100%");$("#shareModal").css("width","586px")}if(Pb.Data.get("shareModal").isSponsoredEdit&&Pb.Data.get(Pb.Data.Shared.MEDIA).spedit){$("#shareModal").addClass(Pb.Data.get("shareModal").sponsoredClass);$("#socialmessage, #message").prop("placeholder",Pb.Data.get("shareModal").sponsoredShareMessage).val(Pb.Data.get("shareModal").sponsoredShareMessage)}},positionModal:function(){},onSuccess:function(t){e.superclass.onSuccess.call(this,t);$("textarea").val("");$("#toAddress, #fromName").val("");Pb.Data.get("shareModal").sponsor&&(Pb.Data.get(Pb.Data.Shared.ALBUM)?$("textarea").val(Pb.Data.get(Pb.Data.Shared.ALBUM).sponsoredShareMessage):$("textarea").val(Pb.Data.get("shareModal").sponsoredShareMessage))},buildSubmitData:function(){var e=null;if(this.currentController){this.submitUrl=this.currentController.getSubmitUrl();e=this.currentController.buildSubmitData(Pb.Data.get(this.modalName))}e&&Pb.Data.get("shareModal").sponsor&&(e.sponsor=Pb.Data.get("shareModal").sponsor);return e},onFail:function(){$(document).trigger({type:"Pb.Component.Share.ShareModal::error"})},enableSubmit:function(){$("a#shareModalSubmit").removeClass("disabled")},disableSubmit:function(){$("a#shareModalSubmit").addClass("disabled")},getTitle:function(e,t){var n,r;if(e==="album"||e==="slideshow")if(t.isSlideshow){n="Share this slideshow";this.linkTitle="Slideshow Links"}else if(t.dirName){n="Share the album: "+t.dirName;this.linkTitle="Album Links"}else{n="Share: "+t.ownername+"'s Library";this.linkTitle="Library Links"}else if(e==="story"){t.title?n="Share the story: "+t.title:n="Share the story: "+t.dirName;this.linkTitle="Story Links"}else if(e==="recent"){t.ownername&&(n="Share: "+t.ownername+"'s Recent Uploads");this.linkTitle="Recent Links"}else if(e==="recentUploads"){n="Share: Recent Uploads";this.linkTitle="Recent Links"}else if(e==="hashtag"){n="Share the hashtag: "+t.hashtag;linkTitle="Hashtag Links"}else if(e==="search"){n="Share these search results";this.linkTitle="Search Links"}else{r=t.mediaType;r==="image"&&(r="photo");n="Share the "+r;t.title&&(n+=": "+t.title);this.linkTitle=r.charAt(0).toUpperCase()+r.slice(1)+" Links"}return n}};Pb.subclass(e,Pb.Component.Element.Modal,n);t=new e;Pb.InitEventQueue.add(function(){t.init()});return t}();$.getObject("Pb.Component.Share",!0).SocialShare=function(){function e(){this.init()}var t={options:null,facebookFeedUrl:"https://www.facebook.com/dialog/share",twitterFeedUrl:"http://twitter.com/intent/tweet",init:function(){this.initEvents()},initEvents:function(){$(document).on("Pb.Component.Share.ShareModal::shown",$.proxy(this.onModalShown,this));$(document).on("Pb.Component.Share.ShareModal::hidden",$.proxy(this.onModalHidden,this));$(document).on("Pb.Component.Share.ShareModal::socialTabShown",$.proxy(this.onTabShown,this))},onModalShown:function(e){var t=Pb.Data.get("shareModal"),n="input[name=defaultMessage_"+t.shareMode+"]",r=Pb.Data.get("shareModal"),i=r.embed?"#"+r.id+"Embed":"#"+r.id,s=$(i),o=s.find("#socialShare").find("form"),u=this;s.find("#socialmessage").attr("placeholder",o.find(n).val());s.find("#socialShare_more_label").on("click",$.proxy(this.onLessOrMoreClick,this));s.find("#socialShare_less_label").on("click",$.proxy(this.onLessOrMoreClick,this));s.find(".extra-service-selector .pinterest").on("click",function(){u.trackShare(null,"pinterest");t.shareMode==="search"?Pb.Component.Common.Social.Pinterest.open(Pb.Data.Shared.get("shared.searchSetCollection").data.url,"search",Pb.Data.Shared.get("shared.searchSetCollection").data.items[0].fullsizeUrl):t.shareMode==="recentUploads"?Pb.Component.Common.Social.Pinterest.open(t.shareObject.data.url,"recentUploads",t.shareObject.data.thumbUrl):t.shareMode==="album"?Pb.Component.Common.Social.Pinterest.open(t.shareObject.url,"share",t.shareObject.thumbUrl):Pb.Component.Common.Social.Pinterest.open(t.shareObject.linkUrl,"share",t.shareObject.fullsizeUrl)});s.find(".extra-service-selector .tumblr").on("click",function(e){u.trackShare(null,"tumblr");var n=t.shareMode==="search"||t.shareMode==="recentUploads"?t.pbEventTarget:t;Pb.Component.Common.Social.Tumblr.open(n,"share")});s.find(".moreIconsButton").on("click",function(){s.find("#socialShare_more").show();s.find(".moreIconsButton").hide();s.find(".lessIconsButton").show()});s.find(".lessIconsButton").on("click",function(){s.find("#socialShare_more").hide();s.find(".lessIconsButton").hide();s.find(".moreIconsButton").show()});s.find("#socialShare div.connectionInfo").on("Pb_Component_ExternalSite_Connection::success Pb_Component_ExternalSite_Connection::selectCheckbox Pb_Component_ExternalSite_Connection::unselectCheckbox Pb_Component_ExternalSite_Connection::error",$.proxy(this.onServiceClick,this));s.find("#socialShare div.connectionInfo").on("Pb_Component_ExternalSite_Connection::success",$.proxy(function(e){this.trackShare(null,$(e.currentTarget).find("input").attr("id").replace("service_",""))},this));$(document).on("click",i+" #service_facebook, "+i+" #service_twitter",$.proxy(function(e){$(e.currentTarget).is(":checked")&&this.trackShare(null,$(e.currentTarget).attr("id").replace("service_",""))},this));s.on("click","#facebookConnection .socialicon, #twitterConnection .socialicon",function(e){$(e.currentTarget).parent().parent().find("input").click()});this.fetchShareThis();this.reset();this.updateUI();this.updateMessage()},updateMessage:function(){var e=Pb.Data.get("shareModal");e.shareMode==="hashtag"&&($("#service_twitter").is(":checked")?$("#socialmessage").val("I got a @Photobucket Hashtag! Use "+e.shareObject.hashtag+" to share photos & videos with me! All our pics will be in this album: "):$("#service_facebook").is(":checked")?$("#socialmessage").val("I've got my own Photobucket Hashtag!  Add my hashtag "+e.shareObject.hashtag+" when you post pictures to Twitter, Instagram or Photobucket to share your photos with me!  All our pictures will be in this album on Photobucket: "):$("#socialmessage").val("I got a @Photobucket Hashtag! Use "+e.shareObject.hashtag+" to share photos & videos with me! All our pics will be in this album: "))},trackShare:function(e,t){var n=Pb.Data.get("shareModal"),r=Pb.Component.Tracking.Mixpanel.getPagenameFromPath(),i=n.shareObject,s=n.shareMode,o=n.embed?"share embed":"share modal";s==="media"&&(s=i.ext==="gif"?"gif":i.mediaType);s==="recentUploads"&&(s="browse recent");s==="recent"&&(s="album");Pb.Component.Tracking.Mixpanel.trackShareClick({type:t,component:r,location:o,sharable:s})},fetchShareThis:function(){typeof stLight=="undefined"?$.ajax({url:"http://w.sharethis.com/button/buttons.js",dataType:"script",success:$.proxy(function(){stLight.options({publisher:"6b3cc47e-c11d-420e-a208-11704eb2c43b"});this.updateShareThis()},this),cache:!0}):this.updateShareThis()},updateShareThis:function(){if(typeof stWidget!="undefined"){var e=Pb.Data.get("shareModal"),t=this.getExternalShareData(e.shareMode,e.shareObject);$(".extra-service-selector span:not(.native)").empty();$(".extra-service-selector span:not(.native)").each(function(e,n){var r={service:$(this).attr("class"),element:this,url:t.url,title:t.name,type:"large",image:t.picture};stWidget.addEntry(r)});$(".moreIconsButton").show()}if(typeof stLight!="undefined"&&!this.stRegistered){this.stRegistered=!0;stLight.subscribe("click",this.trackShare)}},onModalHidden:function(){var e=Pb.Data.get("shareModal"),t=e.embed?"#"+e.id+"Embed":"#"+e.id,n=$(t);n.find("#socialShare_more_label").off("click");n.find("#socialShare_less_label").off("click");n.find(".service-selector li input").off("change");n.find(".service-selector").off(".socialShare");n.find("#socialmessage").val("")},onLessOrMoreClick:function(){$("#socialShare_more_label").is(":visible")?this.toggleMore(!0):this.toggleMore(!1)},onServiceClick:function(e){var t=Pb.Data.get("shareModal"),n=t.embed?"#"+t.id+"Embed":"#"+t.id,r=$(n);e.type==="Pb_Component_ExternalSite_Connection::success"||e.type==="Pb_Component_ExternalSite_Connection::selectCheckbox"?$(e.currentTarget.parentNode).addClass("selected"):e.type==="Pb_Component_ExternalSite_Connection::unselectCheckbox"||e.type==="Pb_Component_ExternalSite_Connection::error"?$(e.currentTarget.parentNode).removeClass("selected"):$(e.currentTarget.parentNode).toggleClass("selected");this.updateMessage()},onTabShown:function(e){e.stopImmediatePropagation();var t=Pb.Data.get("shareModal"),n,r,i,s,o=t.embed?"#"+t.id+"Embed":"#"+t.id,u=$(o);if(t&&t.socialShare&&t.socialShare.sites){n=t.socialShare.sites;for(r=0;r<n.length;r++){i={connectionData:n[r],element:o+" #"+n[r].service+"Connection",promptForAutoPublish:n[r].promptForAutoPublish};s=new Pb.Component.ExternalSite.Connection(i);Pb.Data.add("connection-"+n[r].service,s)}}if(!Pb.Data.get("isLoggedIn")){var a=u.find(".connectionInfo"),f=this.getExternalShareData(t.shareMode,t.shareObject);a.find('input[type="checkbox"]').each(function(){$(this).hide()});u.find(".service-selector").on("click",".facebook-icon, #lbl_facebook, .twitter-icon, #lbl_twitter",$.proxy(function(e){var t=$(e.currentTarget),n,r,i="";if(t.hasClass("facebook-icon")||t.attr("id")==="lbl_facebook"){n={app_id:Pb.Data.get("connection-facebook").connectionData.serviceAppId,href:f.url,redirect_uri:"http://"+document.location.hostname+"/externalpopup",display:"popup"};i=$.param(n);i=i.replace(/\+/g,"%20");r=this.facebookFeedUrl+"?"+i;window.open(r,"Share","width=550,height=420")}else if(t.hasClass("twitter-icon")||t.attr("id")==="lbl_twitter"){r=this.twitterFeedUrl+"?url="+encodeURIComponent(f.url.replace(" ","%20"));f.pbTitle!==""&&(r+="&text="+escape(f.pbTitle));window.open(r,"Share","width=550,height=420")}},this));Pb.Component.Share.ShareModal.disableSubmit()}else Pb.Component.Share.ShareModal.enableSubmit()},getSubmitUrl:function(){return $("#socialShare").find("form").attr("action")},buildSubmitData:function(e){var t=Pb.Data.get("shareModal"),n=$("#socialShare:visible").first().find("form"),r=n.find(".service-selector").find("input:checked:not(:disabled)"),i=null,s=r.map(function(){return this.id}).get().join(","),o=e.shareMode==="slideshow"?e.shareObject.slideshowUrl:e.shareObject.fullsizeUrl||e.shareObject.url||e.shareObject.data.url,t={targetType:e.shareMode,services:s,message:n.find("#socialShare_message textarea").val()};e.shareMode==="search"?i=Pb.Data.get(Pb.Data.Shared.SEARCH_SET)[0].thumbUrl:e.shareMode==="recentUploads"?i=e.shareObject.data.thumbUrl:e.shareMode==="story"&&(i=Pb.Data.get("storyPage").thumbUrl);i&&(t.targetThumbUrl=i);t.target=o;return t},reset:function(){this.toggleMore(!0)},setOptions:function(e){this.options=e},toggleMore:function(e){var t=Pb.Data.get("shareModal"),n=t.embed?"#"+t.id+"Embed":"#"+t.id,r=$(n);if(e){r.find("#socialShare_more_label").hide();r.find("#socialShare_less_label").show();r.find("#socialShare_more_content").show()}else{r.find("#socialShare_more_label").show();r.find("#socialShare_less_label").hide();r.find("#socialShare_more_content").hide()}},updateUI:function(){if(this.options){this.options.showMore&&this.toggleMore(!0);if(this.options.service){var e=Pb.Data.get("shareModal"),t=e.embed?"#"+e.id+"Embed":"#"+e.id,n=$(t),r=n.find("#service_"+this.options.service);r.trigger("Pb_Component_ExternalSite_Connection::checkboxChange");n.find("#service_facebook, #service_twitter").removeAttr("checked");n.find("#service_"+this.options.service).prop("checked","checked")}}},getExternalShareData:function(e,t){var n={url:"",caption:"photobucket.com",description:"",name:"",picture:"",pbTitle:""};if(e==="album"||e==="slideshow"){n.url=e==="slideshow"?t.slideshowUrl:t.url;t.thumbFileName?n.picture="http://"+t.subdomain+".photobucket.com"+t.path+"/bth_"+t.thumbFileName:t.media&&t.media.length>0?n.picture=t.media[0].thumbUrl:t.items&&t.items.length>0&&(n.picture=t.items[0].thumbUrl);n.name=t.ownername+"'s ";n.name+=t.isRootAlbum?"library":t.name+" "+e;n.name+=" on Photobucket";n.description=t.description?t.description.text:""}else if(e==="recent"){n.url=t.data.url;n.name="Recent Uploads on Photobucket"}else if(e==="recentUploads"){n.url=t.data.url;n.name="Recent Uploads on Photobucket";n.picture=t.data.thumbUrl}else if(e==="story"){n.url=t.storyUrl;t.thumbUrl?n.picture=t.thumbUrl:t.media&&t.media.length>0?n.picture=t.media[0].thumbUrl:t.items&&t.items.length>0&&(n.picture=t.items[0].thumbUrl);n.name=t.ownername+"'s ";n.name+=t.isRootAlbum?"story":t.name+" "+e;n.name+=" on Photobucket";n.description=t.description?t.description.text:"";n.pbTitle=n.name}else if(e==="search"){n.url=t.data.url;n.name=t.data.title;n.picture=t.data.items[0].thumbUrl;n.pbTitle=n.name;n.description=t.data.description?t.data.description:""}else if(e==="hashtag"){n.url=t.url;n.name=t.hashtag}else{n.url=t.linkUrl;n.picture=t.fullsizeUrl;if(t.title!==""){n.name=t.title;n.pbTitle=n.name}else{n.name=t.username+"'s ";n.name+=t.mediaType==="image"?" photo":t.mediaType;n.name+=" on Photobucket"}n.description=t.description?t.description.text:""}n.url+=n.url.indexOf("?")===-1?"?src=pb_unauth":"&src=pb_unauth";return n}};$.extend(e.prototype,t);return new e}();$.getObject("Pb.Component.ExternalSite",!0).Connection=function(){function e(e){this.init(e)}var t={init:function(e){this.element=$(e.element);this.connectionData=e.connectionData;e.hasOwnProperty("promptForAutoPublish")?this.promptForAutoPublish=e.promptForAutoPublish:this.promptForAutoPublish=!0;this.linkData();this.initEvents()},initEvents:function(){if(Pb.Data.get("isLoggedIn")){this.connectionData.connectMethod==="checkbox"?this.element.find("input[type=checkbox]").on("click Pb_Component_ExternalSite_Connection::checkboxChange",$.proxy(this.connectByCheckbox,this)):this.element.on("click",".connectLink",$.proxy(function(e){e.preventDefault();var t=$(e.currentTarget);this.toggleConnection(t)},this));this.element.on("change",".autoShare input",$.proxy(function(e){this.toggleAutoshare(e.currentTarget.checked)},this))}},toggleConnection:function(e){var t=e.attr("href"),n=e.data("connected"),r=$(e).data("track");if(n)this.disconnect();else{if($(e).hasClass("mobile")&&r){Pb.Track.tr(r);location.href=t;return}this.doConnect(t)}},connect:function(e){this.doConnect(e.href)},doConnect:function(e){$(document).one("Pb.Component.ExternalSite.Connect::connect",$.proxy(this.connectCallback,this));Pb.Component.ExternalSite.Connect.connect(e,!this.promptForAutoPublish)},connectByCheckbox:function(e){e.type==="Pb_Component_ExternalSite_Connection::checkboxChange"&&(e.target.checked=!e.target.checked);if(e.target.checked)if(this.connectionData.isConnected&&this.connectionData.service!=="facebook"||this.connectionData.isConnected&&this.connectionData.service=="facebook"&&this.connectionData.hasPublishActions)this.element.trigger("Pb_Component_ExternalSite_Connection::selectCheckbox");else{this.doConnect($(e.target).data("connecturl"));e.target.disabled=!0}else this.element.trigger("Pb_Component_ExternalSite_Connection::unselectCheckbox")},connectCallback:function(e){var t,n,r;if(e.status){n=e.connectInfo.siteAuth;this.connectionData.isConnected=!0;this.connectionData.hasPublishActions=!1;this.connectionData.siteUsername=n.siteUsername;this.connectionData.siteUserLink=n.siteUserLink;this.connectionData.siteUserImage=n.siteUserImage;this.connectionData.style==="verbose"?this.connectionData.connectionLabel="Connected as "+n.siteUsername:this.connectionData.connectionLabel=n.siteUsername;if(this.connectionData.actionBtn){var i=this.connectionData.actionBtn;i.classString=i.classString.replace(/btn-primary/,"btn-secondary");i.label="Disconnect";i.iconClass="icon-minus-sign";i.extraAttributes="data-connected='true'"}this.connectionData.autoshare&&(n.publishState&&n.publishState.toLowerCase()==="auto"?this.connectionData.autoshare.boxes[0].value="true":this.connectionData.autoshare.boxes[0].value="false");this.linkData();this.element.trigger({type:"Pb_Component_ExternalSite_Connection::success",siteAuth:n});t=this.element.find("input[type=checkbox]");if(t.length){t.prop("disabled",!1);t.prop("checked",!0)}}else{r={type:"Pb_Component_ExternalSite_Connection::error"};t=this.element.find("input[type=checkbox]");if(t.length){t.prop("disabled",!1);t.prop("checked",!1)}this.element.trigger(r)}},linkData:function(){var e;Pb.JSTemplates.link("#connectionItem",this.element,this.connectionData);this.connectionData.autoshare&&this.element.find(".autoShare input").prop("checked",this.connectionData.autoshare.boxes[0].value==="true")},disconnectSuccess:function(e){if(e.status){this.connectionData.isConnected=!1;if(this.connectionData.actionBtn){var t=this.connectionData.actionBtn;t.classString=t.classString.replace(/btn-secondary/,"btn-primary");t.label="Connect";t.iconClass="";t.extraAttributes="data-connected='false'"}this.connectionData.autoshare&&(this.connectionData.autoshare.boxes[0].value="false");this.linkData()}},disconnect:function(){Pb.Component.ExternalSite.DisconnectConfirm&&Pb.Component.ExternalSite.DisconnectConfirm.show(this.connectionData.siteId,$.proxy(this.disconnectSuccess,this))},handleAutoshareSuccess:function(e){var t=this.element.find(".autoShare input");this.connectionData.autoshare.boxes[0].value=t.prop("checked")?"true":"false"},handleAutoshareError:function(e){var t;if(e.data&&e.data.requiredPermissions){t=this.element.find(".actionButton");if(t.length){$(document).one("Pb.Component.ExternalSite.Connect::permissions",$.proxy(function(e){e.status===1?this.toggleAutoshare(!0):this.resetAutoshare()},this));Pb.Component.ExternalSite.Connect.getPermissions(t.attr("href"),e.data.requiredPermissions)}}else this.resetAutoshare()},resetAutoshare:function(){var e=this.element.find(".autoShare input");e.prop("checked",!e.prop("checked"));this.connectionData.autoshare.boxes[0].value=e.prop("checked")?"true":"false"},toggleAutoshare:function(e){Pb.Ajax.ajax({url:"/action/externalSite/updateAutoShare",data:{siteId:this.connectionData.siteId,autoshare:e},success:$.proxy(function(e){e.status?this.handleAutoshareSuccess(e):this.handleAutoshareError(e)},this),error:$.proxy(this.handleAutoshareError,this)})}};e.prototype=t;return e}();$.getObject("Pb.Component.ExternalSite",!0).DisconnectConfirm=function(){function e(){e.superclass.constructor.call(this)}if(!Pb.Modal||!Pb.Modal.ModalActionBase)return null;var t,n={init:function(t){var n={modalId:"#disconnectConfirm",modalName:"disconnectConfirm",submitButtonId:"#disconnectSubmit",submitUrl:"/action/externalSite/disconnect",showProgress:!0};t&&$.extend(n,t);e.superclass.init.call(this,n)},show:function(e,t,n){$(this.modalId).find("#siteId").val(e);t&&(this.onSuccess=this.getSuccessCallback(t));n&&(this.onFail=n);this.onShow()},buildSubmitData:function(){var e=$(this.modalId).find("form"),t={siteId:e.find("#siteId").val()};return t},getSuccessCallback:function(e){return function(t){Pb.Component.Common.ProfilePic.ProfilePic.update(t.data.profilePic);$(document).trigger({type:"DisconnectConfirm::success",siteId:t.data.siteId});e.call(this,t)}}};Pb.subclass(e,Pb.Modal.ModalActionBase,n);t=new e;Pb.InitEventQueue.add(function(){t.init()});return t}();$.getObject("Pb.Component.Share",!0).Email=function(){function e(){this.init()}var t={init:function(){this.initEvents();this.hasCaptcha=!1;this.captchaSolved=!1;this.validator=new Pb.InputValidator;this.isLoggedIn=Pb.Data.get("isLoggedIn")},initEvents:function(){$(document).on("Pb.Component.Share.ShareModal::shown",$.proxy(this.onModalShown,this));$(document).on("Pb.Component.Share.ShareModal::hidden",$.proxy(this.onModalHidden,this));$(document).on("Pb.Component.Share.ShareModal::emailTabShown",$.proxy(this.onTabShown,this));$(document).on("keyup blur change mouseout input","input#toAddress, input#fromName",$.proxy(this.checkEmailFields,this))},onCaptchaSuccess:function(){this.captchaSolved=!0;this.checkEmailFields()},onModalShown:function(e){this.captchaSolved=!1;var t=Pb.Data,n=t.get("shareModal"),r=n.embed?"#"+n.id+"Embed":"#"+n.id,i=$(r),s=i.find(".shareEmail").find("form"),o=t.get("isLoggedIn");s.length>0&&s.get(0).reset();var u="input[name=defaultMessage_"+n.shareMode+"]";s.find("#message").attr("placeholder",s.find(u).val());this.attachCaptcha();n.shareMode==="hashtag"&&$("#message").val("I've got my own Photobucket Hashtag!  Add my hashtag "+n.shareObject.hashtag+" when you post pictures to Twitter, Instagram or Photobucket to share your photos with me!  All our pictures will be in this album on Photobucket: "+n.shareObject.url);$(document).on("Pb.Component.Share.ShareModal::error",$.proxy(this.onFail,this))},attachCaptcha:function(){var e=new Pb.Component.Element.Captcha.Checkbox;e.renderCaptcha("form#shareEmail");$(e.id).on("Pb.Component.Element.Captcha.Checkbox::challenge_solved",$.proxy(this.onCaptchaSuccess,this));this.hasCaptcha=!0},checkEmailFields:function(){var e=!1,t=!1,n=!1,r=$("input#fromName").val(),i=$("input#toAddress").val();if(i){var s=i.split(","),o=s.length;if(o>10){this.showEmailWarning();return}if(o>1)for(var u=0;u<o;u+=1){if(!this.validator.validEmail(s[u].trim())){n=!1;break}n=!0}else n=this.validator.validEmail(i)}n&&this.disableEmailWarning();r&&r.length>1?t=!0:t=!1;e=this.isLoggedIn?n&&this.captchaSolved:n&&t&&this.captchaSolved;e?Pb.Component.Share.ShareModal.enableSubmit():Pb.Component.Share.ShareModal.disableSubmit()},showEmailWarning:function(){Pb.Component.Share.ShareModal.disableSubmit();$("#toAddress").parents(".control-group").find(".help-inline").html("You may only enter up to 10 email addresses at a time.");$("#toAddress").parents(".control-group").find(".help-inline").css("display","inline-block");$("#toAddress").parents(".control-group").addClass("error")},disableEmailWarning:function(){$("#toAddress").parents(".control-group").find(".help-inline").html("");$("#toAddress").parents(".control-group").removeClass("error")},onModalHidden:function(){$(document).off("Pb.Component.Share.ShareModal::error",$.proxy(this.onFail,this))},onTabShown:function(e){e.stopImmediatePropagation();Pb.Component.Share.ShareModal.disableSubmit();var t=$("#"+e.modal);t.find("#shareModalSubmit").show()},getSubmitUrl:function(){return $(".shareEmail").first().find("form").attr("action")},buildSubmitData:function(e){var t=Pb.Data.get("shareModal"),n=$(".shareEmail:visible").first().find("form"),r,i=e.shareObject.fullsizeUrl,s=null,t={targetType:e.shareMode};r=n.find("input");for(var o=0;o<r.length;o++)t[r[o].name]=r[o].value;r=n.find("textarea");for(var o=0;o<r.length;o++)t[r[o].name]=r[o].value;if(!i){i=e.shareObject.url;e.shareMode==="slideshow"&&(i=e.shareObject.slideshowUrl);if(e.shareMode==="search"){i=e.shareObject.data.url;s=Pb.Data.get(Pb.Data.Shared.SEARCH_SET)[0].thumbUrl}else if(e.shareMode==="recentUploads"){i=e.shareObject.data.url;s=e.shareObject.data.thumbUrl}else e.shareMode==="story"&&(s=Pb.Data.get("storyPage").thumbUrl)}t.target=i;s&&(t.targetThumbUrl=s);return t},setOptions:function(e){this.options=e},resetErrors:function(){$(".control-group").removeClass("error");$(".help-inline").text("")},onFail:function(){Pb.Component.Share.ShareModal.disableSubmit()}};$.extend(e.prototype,t);return new e}();(function(){function e(e){e.stopImmediatePropagation();new Pb.Component.Common.Links.LinkCodes({selector:"#"+e.modal+" .linkCodes",prefix:e.modal});var t=Pb.Data.get("shareModal").shareObject,n=Pb.Data.get("shareModal").shareMode;n==="media"&&(n=t.ext==="gif"?"gif":t.mediaType);n==="recentUploads"&&(n="browse recent");n==="recent"&&(n="album");t.mixpanel=n;$("#"+e.modal+" .linkCodes").trigger({type:"Pb.Component.Common.Links.LinkCodes::refresh",objectData:t})}$(document).on("Pb.Component.Share.ShareModal::linksTabShown",e)})();$.getObject("Pb.Path",!0).PBPath=function(){function e(e){this.pathString=decodeURIComponent(e);this.parse(this.pathString)}var t={pathFormat:/^\/?([^\/]+)\/([^\/]+)\/([^\/]+)\/(.*\/)?([^\/]+)$/,parse:function(e){var t=this.pathFormat.exec(e);if(t==null){this.albumType=null;this.vee=null;this.ownername=null;this.location=null;this.filename=null}else{this.albumType=t[1];this.vee=t[2];this.ownername=t[3];this.location=t[4]===undefined?"":t[4];this.filename=t[5]}}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.Common.Links",!0).LinkCodes=function(){function e(e){this.init(e)}function t(e,t){switch(e){case"email":return"Email & IM";case"direct":return"Direct";case"html":return t==="verbose"?"HTML <span>(for eBay, Craigslist, blogs, websites)</span>":"HTML";case"htmlThumb":return"HTML thumb";case"img":return t==="verbose"?"IMG codes <span>(for forums, boards)</span>":"IMG";case"imgThumb":return"IMG thumb";case"slideshow":return"Slideshow";case"story":return"Story";case"embed":return"Embed";default:return""}}function n(e,n,r,i,s,o,u){var a=t(e,o),f=null;a&&(f={zclipId:i+"_zeroclipboard_"+r,cclipboardId:i+"_copycode_"+r,ccInputId:i+"_ccinput_"+r,inputLabel:a,inputText:$("<div />").html(n).text(),tracking:"share_file_get_link_code_"+e+"_click",mixpanel:u,type:s});return f}var r={init:function(e){if(!e.selector)return;this.element=$(e.selector);this.prefix=e.prefix;this.labelType=e.labelType;this.inputType=e.inputType;this.inputType||(this.inputType="input");this.linkCodesData=[];this.initEvents();$(document).on("Pb.Component.Album.Edit.EditAlbum::editAlbumCompleted",$.proxy(function(e){e.album?e.objectData=e.album.data:e.objectData=Pb.Data.Albums.getCurrentAlbumData()[0];this.refresh(e)},this));this.element.length&&Pb.JSTemplates.link("#copyCodeTemplate",this.element,this.linkCodesData)},initEvents:function(){this.element.on("Pb.Component.Common.Links.LinkCodes::refresh",$.proxy(this.refresh,this))},populateCodes:function(e,t){var n=[],r=0,i=!1;t&&t.privacyLevel&&t.privacyLevel==="private"&&(i=!0);if(i){$(".linkCodes, .link-container, #socialShare, #emailShare").addClass("privateLinks");$("#shareModalSubmit").addClass("disabled")}else{$(".linkCodes, .link-container, #socialShare, #emailShare").removeClass("privateLinks");$("#shareModalSubmit").removeClass("disabled")}if($.isArray(e)){for(r=0;r<e.length;r++){e[r].zclipId=this.prefix+"_zeroclipboard_"+r;e[r].cclipboardId=this.prefix+"_copycode_"+r;e[r].ccInputId=this.prefix+"_ccinput_"+r}$.observable(this.linkCodesData).refresh(e);this.bindCopyCodes()}else if(!$.isEmptyObject(e)){n=this.buildLinkCodesFromArray(e);$.observable(this.linkCodesData).refresh(n);this.bindCopyCodes()}else this.element.html('<p class="noLinkCodes">No link options enabled</p>')},buildLinkCodesFromArray:function(e){var t,r=0,i,s=[];for(t in e)if(e.hasOwnProperty(t)){i=n(t,e[t],r,this.prefix,this.inputType,this.labelType,this.mixpanel);if(i){s.push(i);r++}}return s},refresh:function(e){var t,n,r,i,s,o;e.objectData&&e.objectData.mixpanel&&(this.mixpanel=e.objectData.mixpanel);if(e.objectData&&e.objectData.linkcodes){t=e.objectData.linkcodes;if(typeof t=="string"){t=$.parseJSON(t);e.objectData.linkcodes=t}this.populateCodes(t,e.objectData)}else if(e.objectData!==undefined)if(e.objectData.type==="Pb_Component_Media_MediaThumbnail"||e.objectData.type==="Pb_Component_Library_MediaSelector_MediaThumbnail"){if(e.objectData.linkCodesConfig){o=e.objectData.linkCodesConfig;t=[];for(s=0;s<o.length;s++)t[o[s]]="Loading...";$.observable(this.linkCodesData).refresh(this.buildLinkCodesFromArray(t))}else $.observable(this.linkCodesData).refresh([]);n=new Pb.Path.PBPath(e.objectData.path);r=Pb.Media.MediaIdentifierFactory.getIdentifier(n);i={type:"GET",url:"/api/user/"+n.ownername+"/media/"+encodeURIComponent(r)+"/links",error:$.proxy(this.onRetrieveLinksError,this),success:$.proxy(function(t){this.onRetrieveLinksSuccess(t,e.objectData)},this)};Pb.Ajax.ajax(i)}else if(e.objectData.type==="album"){var u;if(e.objectData.linkCodesConfig){o=e.objectData.linkCodesConfig;t=[];for(s=0;s<o.length;s++)t[o[s]]="Loading...";$.observable(this.linkCodesData).refresh(this.buildLinkCodesFromArray(t))}else $.observable(this.linkCodesData).refresh([]);u=e.objectData.path.split("/");if(u.length<3)return;var a=u[2];n=u.slice(3).join("/");i={type:"GET",url:"/api/user/"+a+"/album/"+n+"/links",error:$.proxy(this.onRetrieveLinksError,this),success:$.proxy(function(t){this.onRetrieveLinksSuccess(t,e.objectData)},this)};Pb.Ajax.ajax(i)}else if(e.objectData.type==="recent"){var t=this.buildLinkCodesFromArray({email:Pb.Data.Albums.getRootAlbum().url});e.objectData.linkcodes=t;this.populateCodes(t,e.objectData)}else if(e.objectData.data.type==="recent"){var t=this.buildLinkCodesFromArray({email:e.objectData.data.url});e.objectData.linkcodes=t;this.populateCodes(t,e.objectData)}},bindCopyCodes:function(){var e=Pb.Component.Common.CopyCode.CopyCode,t=0;for(t=0;t<this.linkCodesData.length;t++)e.createZeroClipboard("#"+this.linkCodesData[t].ccInputId,!1)},onRetrieveLinksError:function(e,t,n){typeof console!="undefined"&&console.error(n)},onRetrieveLinksSuccess:function(e,t){t.linkcodes=e.data;this.populateCodes(e.data,t)}};$.extend(e.prototype,r);$.views.helpers({buildLinkCodeData:n,getLinkCodeLabel:t,unescapeLinkCode:function(e){return $("<div />").html(e).text()}});return e}();$.getObject("Pb.Component.Share",!0).Warning=function(){function e(e){this.init(e)}var t={warningData:[],init:function(e){this.initEvent();$(document).on("Pb.Component.Album.Edit.EditAlbum::editAlbumCompleted",$.proxy(this.hideWarning,this))},initEvent:function(){$(document).one("change","#makePublic",$.proxy(this.makePublic,this))},hideWarning:function(e){var t,n;e.album?t=e.album.data:t=Pb.Data.Albums?Pb.Data.Albums.getCurrentAlbumData()[0]:Pb.Data.Shared.get("shared.album");n=Pb.Data.Albums?Pb.Data.Albums.getCurrentAlbumData()[0].name:Pb.Data.Shared.get("shared.album").name;t.privacyPassword&&t.privacyPassword!==null&&t.privacyLevel!=="password";if(t.name===n)if(t.privacyLevel==="private"){$(".privateWarningMessage").show();$(".privacyIcon").find("i").removeClass().addClass("icon-lock")}else{$(".privateWarningMessage").hide();t.privacyLevel==="public"&&$(".privacyIcon").find("i").removeClass().addClass("icon-unlock");t.privacyLevel==="password"&&$(".privacyIcon").find("i").removeClass().addClass("icon-key")}},makePublic:function(e){e.preventDefault();e.stopImmediatePropagation();$(e.currentTarget).prop("checked",!0);Pb.Ajax.ajax({url:"/action/album/update",data:{privacyLevel:"public",name:$(e.currentTarget).data("name"),albumPath:$(e.currentTarget).data("path")},success:$.proxy(function(t){if(t.status){var n=Pb.Data.Albums?Pb.Data.Albums.getCurrentAlbumData()[0]:Pb.Data.Shared.get("shared.album");$.extend(n,t.data);$(document).trigger($.Event("Pb.Component.Album.Edit.EditAlbum::editAlbumCompleted",{album:{data:n}}))}else $(e.currentTarget).prop("checked",!1)},this),error:function(){$(e.currentTarget).prop("checked",!1)},complete:$.proxy(function(){this.initEvent()},this)})}};$.extend(e.prototype,t);return new e}();(function(e){e.fn.drag=function(t,n,r){var i=typeof t=="string"?t:"",s=e.isFunction(t)?t:e.isFunction(n)?n:null;i.indexOf("drag")!==0&&(i="drag"+i);r=(t==s?n:r)||{};return s?this.bind(i,r,s):this.trigger(i)};var t=e.event,n=t.special,r=n.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",noBubble:!0,add:function(t){var n=e.data(this,r.datakey),i=t.data||{};n.related+=1;e.each(r.defaults,function(e,t){i[e]!==undefined&&(n[e]=i[e])})},remove:function(){e.data(this,r.datakey).related-=1},setup:function(){if(e.data(this,r.datakey))return;var n=e.extend({related:0},r.defaults);e.data(this,r.datakey,n);t.add(this,"touchstart mousedown",r.init,n);this.attachEvent&&this.attachEvent("ondragstart",r.dontstart)},teardown:function(){var n=e.data(this,r.datakey)||{};if(n.related)return;e.removeData(this,r.datakey);t.remove(this,"touchstart mousedown",r.init);r.textselect(!0);this.detachEvent&&this.detachEvent("ondragstart",r.dontstart)},init:function(i){if(r.touched)return;var s=i.data,o;if(i.which!=0&&s.which>0&&i.which!=s.which)return;if(e(i.target).is(s.not))return;if(s.handle&&!e(i.target).closest(s.handle,i.currentTarget).length)return;r.touched=i.type=="touchstart"?this:null;s.propagates=1;s.mousedown=this;s.interactions=[r.interaction(this,s)];s.target=i.target;s.pageX=i.pageX;s.pageY=i.pageY;s.dragging=null;o=r.hijack(i,"draginit",s);if(!s.propagates)return;o=r.flatten(o);if(o&&o.length){s.interactions=[];e.each(o,function(){s.interactions.push(r.interaction(this,s))})}s.propagates=s.interactions.length;s.drop!==!1&&n.drop&&n.drop.handler(i,s);r.textselect(!1);r.touched?t.add(r.touched,"touchmove touchend",r.handler,s):t.add(document,"mousemove mouseup",r.handler,s);if(!r.touched||s.live)return!1},interaction:function(t,n){var i=e(t)[n.relative?"position":"offset"]()||{top:0,left:0};return{drag:t,callback:new r.callback,droppable:[],offset:i}},handler:function(i){var s=i.data;switch(i.type){case!s.dragging&&"touchmove":i.preventDefault();case!s.dragging&&"mousemove":if(Math.pow(i.pageX-s.pageX,2)+Math.pow(i.pageY-s.pageY,2)<Math.pow(s.distance,2))break;i.target=s.target;r.hijack(i,"dragstart",s);s.propagates&&(s.dragging=!0);case"touchmove":i.preventDefault();case"mousemove":if(s.dragging){r.hijack(i,"drag",s);if(s.propagates){s.drop!==!1&&n.drop&&n.drop.handler(i,s);break}i.type="mouseup"};case"touchend":case"mouseup":default:r.touched?t.remove(r.touched,"touchmove touchend",r.handler):t.remove(document,"mousemove mouseup",r.handler);if(s.dragging){s.drop!==!1&&n.drop&&n.drop.handler(i,s);r.hijack(i,"dragend",s)}r.textselect(!0);s.click===!1&&s.dragging&&e.data(s.mousedown,"suppress.click",(new Date).getTime()+5);s.dragging=r.touched=!1}},hijack:function(n,i,s,o,u){if(!s)return;var a={event:n.originalEvent,type:n.type},f=i.indexOf("drop")?"drag":"drop",l,c=o||0,h,p,d,v=isNaN(o)?s.interactions.length:o;n.type=i;n.originalEvent=null;s.results=[];do if(h=s.interactions[c]){if(i!=="dragend"&&h.cancelled)continue;d=r.properties(n,s,h);h.results=[];e(u||h[f]||s.droppable).each(function(o,u){d.target=u;n.isPropagationStopped=function(){return!1};l=u?t.dispatch.call(u,n,d):null;if(l===!1){if(f=="drag"){h.cancelled=!0;s.propagates-=1}i=="drop"&&(h[f][o]=null)}else i=="dropinit"&&h.droppable.push(r.element(l)||u);i=="dragstart"&&(h.proxy=e(r.element(l)||h.drag)[0]);h.results.push(l);delete n.result;if(i!=="dropinit")return l});s.results[c]=r.flatten(h.results);i=="dropinit"&&(h.droppable=r.flatten(h.droppable));i=="dragstart"&&!h.cancelled&&d.update()}while(++c<v);n.type=a.type;n.originalEvent=a.event;return r.flatten(s.results)},properties:function(e,t,n){var i=n.callback;i.drag=n.drag;i.proxy=n.proxy||n.drag;i.startX=t.pageX;i.startY=t.pageY;i.deltaX=e.pageX-t.pageX;i.deltaY=e.pageY-t.pageY;i.originalX=n.offset.left;i.originalY=n.offset.top;i.offsetX=i.originalX+i.deltaX;i.offsetY=i.originalY+i.deltaY;i.drop=r.flatten((n.drop||[]).slice());i.available=r.flatten((n.droppable||[]).slice());return i},element:function(e){if(e&&(e.jquery||e.nodeType==1))return e},flatten:function(t){return e.map(t,function(t){return t&&t.jquery?e.makeArray(t):t&&t.length?r.flatten(t):t})},textselect:function(t){e(document)[t?"unbind":"bind"]("selectstart",r.dontstart).css("MozUserSelect",t?"":"none");document.unselectable=t?"off":"on"},dontstart:function(){return!1},callback:function(){}};r.callback.prototype={update:function(){n.drop&&this.available.length&&e.each(this.available,function(e){n.drop.locate(this,e)})}};var i=t.dispatch;t.dispatch=function(t){if(t&&"type"in t&&e.data(this,"suppress."+t.type)-(new Date).getTime()>0){e.removeData(this,"suppress."+t.type);return}return i.apply(this,arguments)};var s=t.fixHooks.touchstart=t.fixHooks.touchmove=t.fixHooks.touchend=t.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(t,n){if(n){var r=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0]||null;r&&e.each(s.props,function(e,n){t[n]=r[n]})}return t}};n.draginit=n.dragstart=n.dragend=r})(jQuery);$.getObject("Pb.Component.Element.Toggle",!0).Toggle=function(){function e(e){this.init(e)}var t={container:null,dragging:!1,init:function(e){if(!e.container)return;this.container=$(e.container);this.bindEvents()},bindEvents:function(){var e=$(this.container).find(".ball"),t=$(this.container).find(".toggle");if(e.length&&t.length){this.initialOffset=e.offset().left;this.parentOffset=this.container.offset().left;e.drag("start",$.proxy(function(t,n){this.mouseOffset=t.pageX-e.offset().left;n.limit={};n.limit.left=3;n.limit.right=35;e.addClass("dragging")},this)).drag($.proxy(function(t,n){var r=t.pageX-this.parentOffset-this.mouseOffset,i=r;i<n.limit.left?i=n.limit.left:i>n.limit.right&&(i=n.limit.right);e.css({left:i})},this)).drag("end",$.proxy(function(n,r){this.preventClick=!0;n.stopPropagation();e.removeClass("dragging");var i=n.pageX-this.parentOffset,s=t.hasClass("on");i>r.limit.left+12&&!s||i<r.limit.right-12&&s?this.toggle():s?e.css("left",r.limit.right):e.css("left",r.limit.left)},this));t.on("click",$.proxy(function(){this.preventClick?this.preventClick=!1:this.toggle()},this))}},toggle:function(){var e=$(this.container).find(".ball"),t=$(this.container).find(".ballOn"),n=$(this.container).find(".ballOff"),r=$(this.container).find(".toggle");if(!r.hasClass("on")){r.addClass("on");e.css("left","35px");t.css("display","block");n.hide();this.container.trigger("Pb.Component.Element.Toggle.Toggle::on")}else{r.removeClass("on");e.css("left","3px");t.hide();n.css("display","block");this.container.trigger("Pb.Component.Element.Toggle.Toggle::off")}}};$.extend(e.prototype,t);return e}();(function(){"use strict";var e=function(e,t){var n=e.style[t];e.currentStyle?n=e.currentStyle[t]:window.getComputedStyle&&(n=document.defaultView.getComputedStyle(e,null).getPropertyValue(t));if(n=="auto"&&t=="cursor"){var r=["a"];for(var i=0;i<r.length;i++)if(e.tagName.toLowerCase()==r[i])return"pointer"}return n},t=function(e){if(!c.prototype._singleton)return;e||(e=window.event);var t;this!==window?t=this:e.target?t=e.target:e.srcElement&&(t=e.srcElement);c.prototype._singleton.setCurrent(t)},n=function(e,t,n){e&&(e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n))},r=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)},i=function(e,t){if(e.addClass){e.addClass(t);return e}if(t&&typeof t=="string"){var n=(t||"").split(/\s+/);if(e.nodeType===1)if(!e.className)e.className=t;else{var r=" "+e.className+" ",i=e.className;for(var s=0,o=n.length;s<o;s++)r.indexOf(" "+n[s]+" ")<0&&(i+=" "+n[s]);e.className=i.replace(/^\s+|\s+$/g,"")}}return e},s=function(e,t){if(e.removeClass){e.removeClass(t);return e}if(t&&typeof t=="string"||t===undefined){var n=(t||"").split(/\s+/);if(e.nodeType===1&&e.className)if(t){var r=(" "+e.className+" ").replace(/[\n\t]/g," ");for(var i=0,s=n.length;i<s;i++)r=r.replace(" "+n[i]+" "," ");e.className=r.replace(/^\s+|\s+$/g,"")}else e.className=""}return e},o=function(t){var n={left:0,top:0,width:t.width||t.offsetWidth||0,height:t.height||t.offsetHeight||0,zIndex:1000050},r=e(t,"zIndex");r&&r!="auto"&&(n.zIndex=parseInt(r,10));n.left=$(t).offset().left;while(t){var i=parseInt(e(t,"borderLeftWidth"),10),s=parseInt(e(t,"borderTopWidth"),10);$(t).scrollLeft()&&(n.left+=$(t).scrollLeft()*-1);n.left+=isNaN(i)?0:i;n.top+=isNaN(t.offsetTop)?0:t.offsetTop;n.top+=isNaN(s)?0:s;t=t.offsetParent}return n},u=function(e){return(e.indexOf("?")>=0?"&":"?")+"nocache="+(new Date).getTime()},a=function(e){var t=[];e.trustedDomains&&(typeof e.trustedDomains=="string"?t.push("trustedDomain="+e.trustedDomains):t.push("trustedDomain="+e.trustedDomains.join(",")));return t.join("&")},f=function(e,t){if(t.indexOf)return t.indexOf(e);for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n;return-1},l=function(e){if(typeof e=="string")throw new TypeError("ZeroClipboard doesn't accept query strings.");return e.length?e:[e]},c=function(e,t){e&&(c.prototype._singleton||this).glue(e);if(c.prototype._singleton)return c.prototype._singleton;c.prototype._singleton=this;this.options={};for(var n in d)this.options[n]=d[n];for(var r in t)this.options[r]=t[r];this.handlers={};c.detectFlashSupport()&&v()},h,p=[];c.prototype.setCurrent=function(t){h=t;this.reposition();t.getAttribute("title")&&this.setTitle(t.getAttribute("title"));this.setHandCursor(e(t,"cursor")=="pointer")};c.prototype.setText=function(e){if(e&&e!==""){this.options.text=e;this.ready()&&this.flashBridge.setText(e)}};c.prototype.setTitle=function(e){e&&e!==""&&this.htmlBridge.setAttribute("title",e)};c.prototype.setSize=function(e,t){this.ready()&&this.flashBridge.setSize(e,t)};c.prototype.setHandCursor=function(e){this.ready()&&this.flashBridge.setHandCursor(e)};c.version="1.1.7";var d={moviePath:Pb.Data.get("picUrl")+"/flash/ZeroClipboardFV3.swf",trustedDomains:document.location.hostname,text:null,hoverClass:"zeroclipboard-is-hover",activeClass:"zeroclipboard-is-active",allowScriptAccess:"always"};c.setDefaults=function(e){for(var t in e)d[t]=e[t]};c.destroy=function(){c.prototype._singleton.unglue(p);var e=c.prototype._singleton.htmlBridge;e.parentNode.removeChild(e);delete c.prototype._singleton};c.detectFlashSupport=function(){var e=!1;try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash")&&(e=!0)}catch(t){navigator.mimeTypes["application/x-shockwave-flash"]&&(e=!0)}return e};var v=function(){var e=c.prototype._singleton,t=document.getElementById("global-zeroclipboard-html-bridge");if(!t){var n='      <object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" id="global-zeroclipboard-flash-bridge" width="100%" height="100%">         <param name="movie" value="'+e.options.moviePath+u(e.options.moviePath)+'"/>         <param name="allowScriptAccess" value="'+e.options.allowScriptAccess+'"/>         <param name="scale" value="exactfit"/>         <param name="loop" value="false"/>         <param name="menu" value="false"/>         <param name="quality" value="best" />         <param name="bgcolor" value="#ffffff"/>         <param name="wmode" value="transparent"/>         <param name="flashvars" value="'+a(e.options)+'"/>         <embed src="'+e.options.moviePath+u(e.options.moviePath)+'"           loop="false" menu="false"           quality="best" bgcolor="#ffffff"           width="100%" height="100%"           name="global-zeroclipboard-flash-bridge"           allowScriptAccess="always"           allowFullScreen="false"           type="application/x-shockwave-flash"           wmode="transparent"           pluginspage="http://www.macromedia.com/go/getflashplayer"           flashvars="'+a(e.options)+'"           scale="exactfit">         </embed>       </object>';t=document.createElement("div");t.id="global-zeroclipboard-html-bridge";t.setAttribute("class","global-zeroclipboard-container");t.setAttribute("data-clipboard-ready",!1);t.style.position="absolute";t.style.left="-9999px";t.style.top="-9999px";t.style.width="15px";t.style.height="15px";t.style.zIndex="1000050";t.innerHTML=n;document.body.appendChild(t)}e.htmlBridge=t;e.flashBridge=document["global-zeroclipboard-flash-bridge"]||t.children[0].lastElementChild};c.prototype.resetBridge=function(){this.htmlBridge.style.left="-9999px";this.htmlBridge.style.top="-9999px";this.htmlBridge.removeAttribute("title");this.htmlBridge.removeAttribute("data-clipboard-text");s(h,this.options.activeClass);h=null;this.options.text=null};c.prototype.ready=function(){var e=this.htmlBridge.getAttribute("data-clipboard-ready");return e==="true"||e===!0};c.prototype.reposition=function(){if(!h)return!1;var e=o(h);this.htmlBridge.style.top=e.top+"px";this.htmlBridge.style.left=e.left+"px";this.htmlBridge.style.width=e.width+"px";this.htmlBridge.style.height=e.height+"px";this.htmlBridge.style.zIndex=e.zIndex+1;this.setSize(e.width,e.height)};c.dispatch=function(e,t){c.prototype._singleton.receiveEvent(e,t)};c.prototype.on=function(e,t){var n=e.toString().split(/\s/g);for(var r=0;r<n.length;r++){e=n[r].toLowerCase().replace(/^on/,"");this.handlers[e]||(this.handlers[e]=t)}this.handlers.noflash&&!c.detectFlashSupport()&&this.receiveEvent("onNoFlash",null)};c.prototype.addEventListener=c.prototype.on;c.prototype.off=function(e,t){var n=e.toString().split(/\s/g);for(var r=0;r<n.length;r++){e=n[r].toLowerCase().replace(/^on/,"");for(var i in this.handlers)i===e&&this.handlers[i]===t&&delete this.handlers[i]}};c.prototype.removeEventListener=c.prototype.off;c.prototype.receiveEvent=function(e,t){e=e.toString().toLowerCase().replace(/^on/,"");var n=h;switch(e){case"load":if(t&&parseFloat(t.flashVersion.replace(",",".").replace(/[^0-9\.]/gi,""))<10){this.receiveEvent("onWrongFlash",{flashVersion:t.flashVersion});return}this.htmlBridge.setAttribute("data-clipboard-ready",!0);break;case"mouseover":i(n,this.options.hoverClass);break;case"mouseout":s(n,this.options.hoverClass);this.resetBridge();break;case"mousedown":i(n,this.options.activeClass);break;case"mouseup":s(n,this.options.activeClass);break;case"datarequested":var r=n.getAttribute("data-clipboard-target"),o=r?document.getElementById(r):null;if(o){var u=$(o).closest(".copycode").attr("data-clipboard-text");u&&this.setText(u)}else{var a=n.getAttribute("data-clipboard-text");a&&this.setText(a)}break;case"complete":this.options.text=null}if(this.handlers[e]){var f=this.handlers[e];typeof f=="function"?f.call(n,this,t):typeof f=="string"&&window[f].call(n,this,t)}};c.prototype.glue=function(e){e=l(e);for(var r=0;r<e.length;r++)if(f(e[r],p)==-1){p.push(e[r]);n(e[r],"mouseover",t)}};c.prototype.unglue=function(e){e=l(e);for(var n=0;n<e.length;n++){r(e[n],"mouseover",t);var i=f(e[n],p);i!=-1&&p.splice(i,1)}};typeof module!="undefined"?module.exports=c:window.ZeroClipboard=c})();$.getObject("Pb.Component.Common.CopyCode",!0).CopyCode=function(){function e(e){var t=e.closest(".zeroclipboard"),n=t.data("tracking"),r=t.data("appboy"),i=t.data("mixpanel"),s=Pb.Component.Tracking.Mixpanel.getPagenameFromPath(),o=t.find("label"),u,a,f="";n&&Pb.Track.trf(n);r&&r.length&&typeof appboy!="undefined"&&Pb.Data.Shared.get("loggedInUser")&&appboy.logCustomEvent(r);if(i){a=i;u="right rail";e.closest("#shareModal").length&&(u="share modal");u==="right rail"&&e.closest("#shareModalEmbed").length&&(u="share embed");u==="right rail"&&e.closest("#bulkLinkModal").length&&(u="bulk link modal");if(u==="right rail"&&s==="profile"){u="top bar";f="url"}Pb.Component.Tracking.Mixpanel.trackShareClick({type:o.text()||f,component:s,location:u,sharable:a})}}function t(t){t.attr("readonly",!1);t.click(function(){t.select();e(t)});$(t).on("keydown cut",function(e){e.keyCode!==9&&e.preventDefault()})}function n(n,r){var i=$(n),s=swfobject.getFlashPlayerVersion(),o,u,a,f,l,c,h,p,d;if(i.parents(".privateLinks").length){i.closest("input").prop("disabled","disabled");return}i.closest("input").prop("disabled",!1);if(r||s.major<9){t(i);return}var v=[];f=i.val();l=i.closest(".copycode");c=i.closest(".zeroclipboard");if(!l.length||!c.length){a=n.split(" ");if(a.length===1)p=n.split("_");else{h=a[a.length-1];p=h.split("_")}d=p[0];d.match(/^[.#]/)&&(d=d.substring(1));u=p[2];v.push(document.getElementById(d+"_copycode_"+u))}else v.push(l[0]);if(ZeroClipboard&&v.length){o=new ZeroClipboard(v);o.addEventListener("onComplete",function(t,n){i=$(this).find("input");i.length===0&&(i=$(this).find("textarea"));n.text===i.val()&&i.val("Copied").css("backgroundColor","#FFFF66").fadeTo("normal",.4,function(){$(this).fadeTo("normal",1,function(){$(this).css("backgroundColor","#FFFFFF").val(n.text)});e(i)})})}}return{createZeroClipboard:n}}();$.getObject("Pb.Component.Detail",!0).Options=function(){function e(e){this.init(e)}var t={isLoggedIn:!1,isCompact:!1,actionTargetNormalId:"#detailOptions",actionTargetCompactId:"#detailOptionsCompact",actionTarget:null,actionTemplate:"#detailOptionsTemplate",actionData:[],defaultActionData:[],eventRegister:null,currentMedia:null,currentMediaUrl:null,currentMediaIsOwner:!1,rotatePostUrl:"/action/media/rotate",init:function(e){this.defaultActionData=e;this.actionData=$.extend(!0,{},this.defaultActionData);this.setCurrentMedia(Pb.Data.Shared.get(Pb.Data.Shared.MEDIA));this.getElements();for(var t=0;t<this.actionData.eventRegister.length;t++)$(document).trigger($.Event("ActionEventsDispatcher::registerevent",{pbEvent:{eventSelector:this.actionData.eventRegister[t].eventSelector,eventType:this.actionData.eventRegister[t].eventType,event:this.actionData.eventRegister[t].event}}));this.bindEvents();this.link();$(this.actionTargetNormalId).tooltip({placement:"right",selector:".btn",delay:{show:300,hide:100}});$(".sharing_list").on("click",function(e){var t=$(e.target).parents(".sh_btn").attr("id");(t==="wordpress"||t==="sharethis")&&Pb.Track.trf("detail_page_share_"+t+"_click")});$("#more_sharing_more").click(function(){$("#more_sharing_less").removeClass("dim");$(this).addClass("dim");$(".sharing_list").addClass("more")});$("#more_sharing_less").click(function(){$("#more_sharing_more").removeClass("dim");$(this).addClass("dim");$(".sharing_list").removeClass("more")})},fetchShareThis:function(){typeof stLight=="undefined"?$.ajax({url:"http://w.sharethis.com/button/buttons.js",dataType:"script",success:$.proxy(function(){stLight.options({publisher:"6b3cc47e-c11d-420e-a208-11704eb2c43b"});stLight.subscribe("click",this.trackShareThis);this.updateShareThis()},this),cache:!0}):this.updateShareThis()},updateShareThis:function(){if(typeof stWidget!="undefined"){$(".sharing_list span").empty();var e=this;$(".sharing_list span").each(function(t,n){stWidget.addEntry({service:$(this).attr("id"),element:this,url:e.currentMedia.linkUrl,title:e.currentMedia.titleOrFilename,type:"large",image:e.currentMedia.fullsizeUrl})})}},trackShareThis:function(e,t){Pb.Track.trf("detail_page_share_"+t+"_"+e)},setCurrentMedia:function(e){this.isLoggedIn=Pb.Data.get("isLoggedIn");this.currentMedia=e;this.currentMediaUrl=e.fullsizeUrl;this.currentMediaIsOwner=e.io;this.actionData.iconLink.items=this.setOwnerOptionPerms(this.actionData.iconLink);this.actionData.dropdownLink.items=this.setOwnerOptionPerms(this.actionData.dropdownLink)},setOwnerOptionPerms:function(e){var t=[],n=this.currentMedia.mediaType==="image";for(var r=0;r<e.length;r++){var i=e[r];i.jsAttributes.checkperms?i.jsAttributes.identifier==="printdecor"?this.currentMedia.cp&&t.push(i):i.jsAttributes.identifier==="metalprints"?this.currentMedia.cp&&t.push(i):i.jsAttributes.identifier==="prints"?this.currentMedia.cp&&t.push(i):i.jsAttributes.identifier==="printoption"?this.currentMedia.cp&&t.push(i):i.jsAttributes.identifier==="effects"?this.currentMediaIsOwner&&n&&t.push(i):i.jsAttributes.identifier==="move"?this.currentMediaIsOwner&&t.push(i):i.jsAttributes.identifier==="rotateleft"?this.currentMediaIsOwner&&n&&t.push(i):i.jsAttributes.identifier==="crop"?this.currentMediaIsOwner&&n&&t.push(i):i.jsAttributes.identifier==="rotateright"?this.currentMediaIsOwner&&n&&t.push(i):i.jsAttributes.identifier==="delete"?this.currentMediaIsOwner&&t.push(i):i.jsAttributes.identifier==="download"?this.currentMedia.cd&&this.currentMedia.downloadUrl&&t.push(i):i.jsAttributes.identifier==="copy"?this.currentMedia.cd&&t.push(i):i.jsAttributes.identifier==="downloadoption"?this.currentMedia.cd&&this.currentMedia.downloadUrl&&t.push(i):i.jsAttributes.identifier==="copyoption"?this.currentMedia.cd&&t.push(i):i.jsAttributes.identifier==="flag"?this.currentMediaIsOwner||t.push(i):this.currentMediaIsOwner&&t.push(i):t.push(i)}return t},getElements:function(){this.actionTarget=$("#detailOptions")},bindEvents:function(){var e=$(document);e.on("Pb.Component.Media.Media::template-update",$.proxy(this.handleMediaContentUpdate,this));$("#mediaTemplate").on("mouseenter","#optionsBtn",$.throttle(300,function(){$("#detailOptionsMenu").show()})).on("mouseenter",".detailHoverBtn:not(#optionsBtn)",$.throttle(100,function(){$("#detailOptionsMenu").hide()})).on("mouseleave","#detailOptionsMenu",$.throttle(100,function(){$("#detailOptionsMenu").hide()})).on("mouseleave",$.throttle(100,function(){$("#detailOptionsMenu").hide()}));this.bindActions()},bindActions:function(){var e=$(document);Pb.Data.add("currentAlbum",!0);e.on("Options::download Options::downloadoption",$.proxy(function(e){var t=e.pbData?e.pbData:Pb.Data.get(Pb.Data.Shared.MEDIA);document.location="/component/Download-File?file="+encodeURIComponent(t.path);Pb.Component.Ad&&Pb.Component.Ad.AdRefresh&&Pb.Component.Ad.AdRefresh.reloadAds()},this));e.on("Options::move",$.proxy(function(e){var t=e.pbData?e.pbData:Pb.Data.get(Pb.Data.Shared.MEDIA);$(document).trigger($.Event("CopyMoveMediaModal::show",{pbData:t,pbEventTarget:e.pbEventTarget}))},this));e.on("Options::edit2",$.proxy(function(e){document.location="/editor?image="+escape(this.currentMediaUrl)+"&detailUrl="+Pb.Data.get(Pb.Data.Shared.MEDIA).linkUrl},this));e.on("Options::effects",$.proxy(function(e){document.location="/editor?image="+escape(this.currentMediaUrl)+"&tool=effects&detailUrl="+Pb.Data.get(Pb.Data.Shared.MEDIA).linkUrl},this));e.on("Options::crop",$.proxy(function(e){document.location="/editor?image="+escape(this.currentMediaUrl)+"&tool=crop&detailUrl="+Pb.Data.get(Pb.Data.Shared.MEDIA).linkUrl},this));e.on("Options::delete",$.proxy(function(e){$(document).trigger($.Event("DeleteMediaModal::show",{pbData:e.pbData,pbEventTarget:e.pbEventTarget}))},this));e.on("click","#viewalbum",function(){var e=/\d+/.exec(Pb.Data.get(Pb.Data.Shared.MEDIA).subdomain)[0];document.location="http://s"+e+".photobucket.com/user/"+Pb.Data.get(Pb.Data.Shared.MEDIA).ownername+"/library/"+Pb.Data.get(Pb.Data.Shared.MEDIA).location});e.on("Options::copy Options::copyoption",$.proxy(function(e){var t=e.pbData?e.pbData:Pb.Data.get(Pb.Data.Shared.MEDIA);$(document).trigger($.Event("CopyMoveMediaModal::show",{pbData:t,pbEventTarget:e.pbEventTarget}))},this));e.on("Options::rotateleft",$.proxy(function(e){var t={mediaUrl:this.currentMediaUrl,degrees:270},n={url:this.rotatePostUrl,type:"POST",data:t,showProgressModal:!0,progressTitle:"Rotating photo",success:$.proxy(function(e){this.handleEditResponse(e)},this)};Pb.Ajax.ajax(n)},this));e.on("Options::rotateright",$.proxy(function(e){var t={mediaUrl:this.currentMediaUrl,degrees:90},n={url:this.rotatePostUrl,type:"POST",data:t,showProgressModal:!0,progressTitle:"Rotating photo",success:$.proxy(function(e){this.handleEditResponse(e)},this)};Pb.Ajax.ajax(n)},this))},handleMediaContentUpdate:function(e){this.setCurrentMedia(e.newTarget);if(this.isCompact){$("#mediaTemplateTarget").append('<div id="detailOptionsCompact" class="detailOptions detailOptionsCompact"></div>');this.actionTarget=$(this.actionTargetCompactId)}this.link();this.fetchShareThis();this.currentMedia.mediaType==="image"?$(".imageOnly").removeClass("hide"):$(".imageOnly").addClass("hide")},link:function(){Pb.JSTemplates.link(this.actionTemplate,this.actionTarget,this.actionData);Pb.JSTemplates.link("#detailOptionsDropdown","#detailOptionsMenu",this.actionData)},removeActionTarget:function(){this.actionTarget.off();this.actionTarget.parent()[0].removeChild(this.actionTarget[0])},handleEditResponse:function(e){e.status===1&&setTimeout(function(){document.location.reload()},1e3)}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.Media.Delete",!0).DeleteMediaModal=function(){function e(){e.superclass.constructor.call(this)}var t={init:function(t){var n={eventName:"DeleteMediaModal::show",modalId:"#deleteMediaModal",modalName:"deleteMediaModal",shownEvent:"DeleteMediaModal::shown",hideEvent:"DeleteMediaModal::hidden",submitButtonId:"#deleteMediaSubmitButton",submitUrl:"/action/media/delete",showProgress:!0,refreshAdsOnHide:!0,progressText:"This may take a moment. Hang tight."};t&&$.extend(n,t);e.superclass.init.call(this,n);this.initEvents()},initEvents:function(){$(document).trigger($.Event("ActionEventsDispatcher::registerevent",{pbEvent:{eventSelector:".deleteMediaAction",eventType:"click",event:this.eventName}}))},onFilmstripItemRemove:function(t,n){e.superclass.onFilmstripItemRemove.call(this,t,n);this.updateTitle()},buildSubmitData:function(){var e=$(this.modalId).find("> form [name=mediaPath]"),t=[];e.each(function(){t.push($(this).val())});return{mediaPath:t}},onShow:function(t){var n=Pb.Data.get(this.modalName);n&&n.ajaxFetchData&&Pb.Ajax.ajax({url:n.ajaxFetchData,async:!1,success:function(e){if(e){n=$.extend(n,e);delete n.ajaxFetchData;Pb.Data.add(this.modalName,n)}}});Pb.Data.get(this.modalName).media=Pb.Data.Shared.getData(t.pbEventTarget);e.superclass.onShow.call(this,t);this.modalData=t.pbData;this.refreshOnSuccess=!0;t.hasOwnProperty("refreshOnSuccess")&&(this.refreshOnSuccess=t.refreshOnSuccess);this.updateTitle()},updateTitle:function(){var e=$(this.modalId).find("form"),t=[],n,r=[],i,s,o;if($.isArray(this.modalData))for(i=0;i<this.modalData.length;i++){t.push(this.modalData[i].titleOrFilename);r.push(this.modalData[i].path)}else{t.push(this.modalData.titleOrFilename);r.push(this.modalData.path)}t.length===1?n="'"+t[0]+"'":n="the selected "+t.length+" photos or videos";o=this.modalData.mediaType;n=unescape(n.replace(/\+/g," "));$("#deleteMediaTitle").text(n);$("#deleteMediaPronoun").text(o);$(this.modalId).find("input[name=mediaPath]").remove();for(i=0;i<r.length;i++){s=$('<input type="hidden" name="mediaPath" />');s.val(r[i]);e.append(s)}},onSuccess:function(e){e.status===1&&(!this.refreshOnSuccess||Pb.Data.Albums?$(document).trigger("MediaDelete::deleteMediaCompleted",e.data):location.href=e.data.destinationUrl)}};Pb.subclass(e,Pb.Component.Element.Modal,t);var n=new e;n.init();return n}();$.getObject("Pb.Component.Media.CopyMove",!0).CopyMoveMediaModal=function(){function e(){e.superclass.constructor.call(this)}var t={copy:!0,location:null,destUrl:null,chooser:null,init:function(t){var n={eventName:"CopyMoveMediaModal::show",shownEvent:"CopyMoveMediaModal::shown",hideEvent:"CopyMoveMediaModal::hidden",modalId:"#copyMoveMediaModal",modalName:"copyMoveMediaModal",submitButtonId:"#copyMoveMediaSubmitButton",showProgress:!0,refreshAdsOnHide:!0,progressText:"This may take a moment. Hang tight."};t&&$.extend(n,t);e.superclass.init.call(this,n);this.initEvents(n)},onFilmstripItemRemove:function(t,n){e.superclass.onFilmstripItemRemove.call(this,t,n);this.modalData=Pb.Data.get(Pb.Data.Shared.SELECTED_SET);$(this.modalId).find("#copymoveLabel").html(this.getLabel())},initEvents:function(e){$(document).trigger($.Event("ActionEventsDispatcher::registerevent",{pbEvent:{eventSelector:".copyMoveMediaAction",eventType:"click",event:e.eventName}}))},buildSubmitData:function(){var e=$("#copyMoveMediaSubdomain").val(),t=$(this.modalId).find("> form [name=mediaUrl]"),n;this.copy?this.submitUrl="/action/media/copy":this.submitUrl="/action/media/move";n=[];t.each(function(){n.push($(this).val())});var r={mediaUrl:n,albumUrl:this.destUrl};$.extend(r,this.buildCreateAlbumData());return r},buildCreateAlbumData:function(){if(!$("#editAlbumModalEmbed").is(":visible"))return;var e={parentAlbumPath:$(this.modalId).find("#editAlbumChooser .dropdown-toggle").attr("data-albumpath"),name:$("#editAlbumTitle").val(),description:$("#editAlbumDescription").val(),vanityName:$("#editAlbumVanity").val(),reloadPage:this.notify?!1:!0,hashtag:$(".createHashtagSectionContent #createHashtag").length&&$(".createHashtagSectionContent #createHashtag").val().length?$(".createHashtagSectionContent #createHashtag").val():!1};e.privacyLevel=$(".privacySelectionContainer li.active a").attr("data-privacy");var t=this.getPrivacyPassword();if(e.privacyLevel==="password"&&t!==this.albumPrivacyPassword){var n,r=/^[\w-]{6,50}$/;if($.trim(t)===""){n={status:0,message:"",details:this.passwordMsg};Pb.Component.Element.Message.show(n);return!1}if(!r.test(t)){n={status:0,message:"",details:this.passwordMsg};Pb.Component.Element.Message.show(n);this.showProgress=!1;return!1}e.privacyPassword=t}return e},getPrivacyPassword:function(){var e="";$(".privacyPasswordContainer #privacyPassword").is(":visible")&&(e=$(".privacyPasswordContainer #privacyPassword").val());return e},onShow:function(t){var n=Pb.Data.get(this.modalName);n&&n.ajaxFetchData&&Pb.Ajax.ajax({url:n.ajaxFetchData,async:!1,success:function(e){if(e){n=$.extend(n,e);delete n.ajaxFetchData;Pb.Data.add(this.modalName,n)}}});Pb.Data.get(this.modalName)&&(Pb.Data.get(this.modalName).media=Pb.Data.Shared.getData(t.pbEventTarget));this.modalData=t.pbData;$.isArray(this.modalData)||(this.modalData=[this.modalData]);var r=Pb.Data.get("isLoggedIn");if(!r){$(document).trigger({type:"LoginModal::show",action:this.getButtonLabel(),k:this.modalData[0].pbdkey,o:this.modalData[0].offset});return}this.determineMode(t.pbEventTarget);t.headerTitle=this.getHeaderTitle();this.refreshOnSuccess=!0;t.hasOwnProperty("refreshOnSuccess")&&(this.refreshOnSuccess=t.refreshOnSuccess);this.bulkAction=!1;t.hasOwnProperty("bulkAction")&&(this.bulkAction=t.bulkAction);var i=Pb.Data.get(this.modalName);i.filmstrip.thumbUrl=t.pbData.thumbUrl;i.filmstrip.offset=t.pbData.offset;i.media||(i.media=t.pbData);Pb.Data.data.copyMoveMediaModal=i;t.modalData=i;e.superclass.onShow.call(this,t);var s=$("#copyMoveMediaAlbumChooser");s.on("AlbumChooserDropdown::albums_loading.copyMoveMediaModal",$.proxy(this.onAlbumsLoading,this));s.on("AlbumChooserDropdown::albums_loaded.copyMoveMediaModal",$.proxy(this.onAlbumsLoaded,this));s.on("AlbumChooserDropdown::album_selected.copyMoveMediaModal",$.proxy(this.onAlbumSelected,this));var o=Pb.Data.get("currentAlbum");this.chooser=new Pb.Component.Album.Chooser.AlbumChooserDropdown({albumChooserId:"#copyMoveMediaAlbumChooser",createAlbum:!0,createNewAlbum:function(e){e.preventDefault();$("#copyMoveMediaAlbumChooser .dropdown-toggle").html("<b class='caret'></b> <span>"+$("#copyMoveMediaAlbumChooser .createAlbum").text()+"</span>");$("#editAlbumModalEmbed").show();$("#copyMoveMediaSubmitButton").attr("disabled",!1);var t={mode:"create",notify:!0,embed:!0,notifyOnTitleChange:!0,isTagged:!1,leftRailClick:!1};$(document).trigger($.Event("Pb.Component.Album.Edit::show",t));setTimeout(function(){$(window).trigger("resize.modal")},250)},filter:"none"});this.loadAlbums(this.getAlbumPath())},loadAlbums:function(e){$("#copyMoveMediaSubmitButton").val(this.getButtonLabel()).attr("disabled",!0);this.chooser.loadAlbums(e)},onAlbumsLoading:function(){$("#copyMoveMediaAlbumChooser .dropdown").hide()},onAlbumsLoaded:function(){$("#copyMoveMediaAlbumChooser .dropdown").show();this.chooser.setSelectedAlbum()},onAlbumSelected:function(e){this.destUrl=e.albumData.albumurl;$("#editAlbumModalEmbed").hide();$("#copyMoveMediaSubmitButton").attr("disabled",!1)},onSuccess:function(e){if(e.status===1)if(!this.refreshOnSuccess||Pb.Data.Albums){var t="CopyMoveMediaModal::moveSuccess";this.copy&&(t="CopyMoveMediaModal::copySuccess");$(document).trigger({type:t,response:e});e.data.album&&e.data.album.path&&$(document).trigger("EditAlbum::createAlbumCompleted",e.data.album)}else{var n=e.data.destinationUrl;n&&location.host.indexOf("media.")>=0&&(n=location.protocol+"//"+location.host.replace("media.","")+n);n&&(location.href=n)}},determineMode:function(e){var t=$(e);if(typeof t!="object"){this.copy=!0;return}var n=t.data("copymovemode");n?this.copy=n==="move"?!1:!0:this.copy=t.text().toLowerCase()==="move"?!1:!0},getHeaderTitle:function(e){return this.copy?"Copy to album":"Move to album"},prepareDataForTemplate:function(e){e.label=this.getLabel();e.mediaUrls=this.getMediaUrls();e.albumPath=this.getAlbumPath();e.copy=this.copy;return e},getLabel:function(){var e="Where do you want to ",t,n=[],r;this.copy?e+="copy ":e+="move ";for(r=0;r<this.modalData.length;r++)n.push(this.modalData[r].titleOrFilename);n.length===1?t="'"+n[0]+"'":t="the selected "+n.length+" photos or videos";t=unescape(t.replace(/\+/g," "));e+=t;e+=" to?";return e},getMediaUrls:function(){var e,t,n=[];for(e=0;e<this.modalData.length;e++){t=this.modalData[e].fullsizeUrl;n.push(t)}return n},getAlbumPath:function(){return this.modalData.length>0?this.modalData[0].albumPath:null},getButtonLabel:function(){return this.copy?"Copy":"Move"}};Pb.subclass(e,Pb.Component.Element.Modal,t);var n=new e;n.init();return n}();(function(){function e(){e.superclass.constructor.call(this)}var t={modal:null,init:function(t){var n={modalId:"#reportModal",modalName:"reportModal",eventName:"ReportModal::show",submitUrl:"/action/flag/media",submitButtonId:"#reportModalSubmitButton"};t&&$.extend(n,t);e.superclass.init.call(this,n);this.initEvents()},initEvents:function(){$(document).trigger($.Event("ActionEventsDispatcher::registerevent",{pbEvent:{eventSelector:".showReportModal",eventType:"click",event:this.eventName}}))},bindModalEvents:function(){var t=$(this.modalId);if(t.length){t.find("input[name=type]").on("change",$.proxy(this.onTypeChange,this));e.superclass.bindModalEvents.call(this)}},onShow:function(t){var n=!1;if(t.pbData){t.pbData.fullsizeUrl&&(this.mediaUrl=t.pbData.fullsizeUrl);t.pbData.hashtagMedia&&(n=!0)}var r=Pb.Data.get("reportModal");r.ajaxFetchData&&Pb.Ajax.ajax({url:r.ajaxFetchData,async:!1,success:function(e){if(e){r=$.extend(r,e);delete r.ajaxFetchData;Pb.Data.add("reportModal",r)}}});this.mediaUrl||(this.mediaUrl=$(t.pbEventTarget).data("url"));this.mediaUrl||(this.mediaUrl=Pb.Data.get("shared.media").fullsizeUrl);e.superclass.onShow.call(this,t);n?$("#reportType input[value=hashtag]").parent().show():$("#reportType input[value=hashtag]").parent().hide()},onHide:function(e){var t=$(this.modalId).find("form");t.length&&t.get(0).reset();this.mediaUrl=null},onSubmit:function(t){t.preventDefault();this.validate()&&e.superclass.onSubmit.call(this,t)},buildSubmitData:function(){var e=$(this.modalId).find("form"),t={type:e.find('input[name="type"]:checked').val(),comment:e.find("#reportComment").val(),email:e.find("#reportEmail").val(),mediaUrl:this.mediaUrl};return t},validate:function(){var e=$(this.modalId).find("form"),t=e.find('input[name="type"]:checked'),n=e.find("#reportComment"),r=e.find("#reportEmail"),i;if(t.val()==="racism"||t.val()==="other"){$(".control-group",this.form).removeClass("error");$(".help-inline",this.form).html("");if(n.val()===""){i="Please provide comments for your report";n.parents(".control-group").addClass("error");n.parents(".controls").find(".help-inline").html(i);return!1}if(r.val()===""){i="Please provide an email address";r.parents(".control-group").addClass("error");r.parents(".controls").find(".help-inline").html(i);return!1}}return!0},onTypeChange:function(e){var t=$(e.currentTarget).val(),n=$(this.modalId);if(t==="nudity"){n.find(".reportExtra").hide();n.find("input[type=submit]").show()}else if(t==="dmca"){n.find(".reportExtra").hide();Pb.Component.Element.Message.show({status:1,message:'If you own the copyright to material on the Photobucket site, please file an official Digital Millennium Copyright Act (DMCA) complaint by following the instructions posted on our <a href="/copyright/" target="_blank">Copyright policy page</a>.'});n.find("input[type=submit]").hide()}else{n.find(".reportExtra").show();n.find("input[type=submit]").show()}}};Pb.subclass(e,Pb.Component.Element.Modal,t);var n=new e;n.init()})();$.getObject("Pb.Component.Common.Likes",!0).Likes=function(){function e(){this.init()}var t={isLoggedIn:null,likeUrl:"/action/likes/like",unlikeUrl:"/action/likes/unlike",clickTarget:null,init:function(){this.isLoggedIn=Pb.Data.get("isLoggedIn");var e=$(document);e.on("click","a.like",$.proxy(this.handleLikeClick,this));e.on("click","a.unlike",$.proxy(this.handleUnLikeClick,this));e.on("mouseenter","a.unlike",$.proxy(this.handleUnLikeHoverOn,this));e.on("mouseleave","a.unlike",$.proxy(this.handleUnLikeHoverOut,this));e.on("click","a.likelogin",$.proxy(this.handleLikeLogin,this))},handleUnLikeHoverOn:function(e){if(!$(e.currentTarget).hasClass("detailHoverBtn")){var t=$(e.currentTarget),n=t.find(".liketext"),r=t.find(".heart");t.removeClass("btn-secondary").addClass("btn-primary");r.removeClass("heartfill").addClass("heartempty");n.text("UnLike")}},handleUnLikeHoverOut:function(e){var t=$(e.currentTarget),n=t.find(".liketext"),r=t.find(".heart");t.removeClass("btn-primary").addClass("btn-secondary");r.removeClass("heartempty").addClass("heartfill");n.text("Liked")},handleLikeClick:function(e){if(!this.isLoggedIn){var t=$(e.currentTarget);t.tooltip({delay:{show:2e3,hide:2e3}});t.tooltip("show");$(document).trigger({type:"LoginModal::show",action:"Like"});return}this.clickTarget=$(e.currentTarget);var n=this.clickTarget.data("likeurl"),r={likeableUrl:n};Pb.Ajax.ajax({url:this.likeUrl,data:r,success:$.proxy(this.handleLikeResponse,this)})},handleLikeResponse:function(e){if(e.status===1){if(this.clickTarget.data("context")==="detail"){var t=this.clickTarget.siblings(".unlike");t.show();this.clickTarget.hide();var n=Pb.Data.Shared.get("shared.media").offset,r=Pb.Data.Shared.get("shared.mediaSet")[n],i=parseInt(r.likeCount,10);isNaN(i)||(r.likeCount=i>=0?i+1:0);r.isLiked=!0;r.isPersisted=!0;$("#likeCount").html(r.likeCount)}if(this.clickTarget.data("context")==="as"){var s=this.clickTarget.parents(".activityEvent"),o=s.attr("id").split("_").pop(),u=s.data("objectid"),a=$.Event("Pb.Component.Common.Likes::like_added");a.rowIndex=o;a.objectId=u;$(".activitiesTarget").trigger(a)}else $(document).trigger($.Event("Pb.Component.Common.Likes::like_click"))}},handleUnLikeClick:function(e){if(!this.isLoggedIn){var t=$(e.currentTarget);t.tooltip({delay:{show:2e3,hide:2e3}});t.tooltip("show");$(document).trigger({type:"LoginModal::show",action:"UnLike"});return}this.clickTarget=$(e.currentTarget);var n=this.clickTarget.data("likeurl"),r={likeableUrl:n};Pb.Ajax.ajax({url:this.unlikeUrl,data:r,success:$.proxy(this.handleUnLikeResponse,this)})},handleUnLikeResponse:function(e){if(e.status===1){if(this.clickTarget.data("context")==="detail"){var t=this.clickTarget.siblings(".like");t.show();this.clickTarget.hide();var n=Pb.Data.Shared.get(Pb.Data.Shared.MEDIA),r=parseInt(n.likeCount,10);isNaN(r)||(n.likeCount=r>0?r-1:0);n.isLiked=!1;$("#likeCount").html(n.likeCount)}if(this.clickTarget.data("context")==="as"){var i=this.clickTarget.parents(".activityEvent"),s=i.attr("id").split("_").pop(),o=i.data("objectid"),u=$.Event("Pb.Component.Common.Likes::like_removed");u.rowIndex=s;u.objectId=o;$(".activitiesTarget").trigger(u)}if(this.clickTarget.data("context")==="story"){this.clickTarget.hide();this.clickTarget.siblings().filter(".like").show();var a=$("#end-of-story").find(".stat.likes .count"),f=parseInt(a.text(),10)-1;a.text(f)}}},handleLikeLogin:function(e){var t=encodeURIComponent(document.location.href);document.location.href="/login?returnUrl="+t}};$.extend(e.prototype,t);return e}();Pb.InitEventQueue.addToDomReady(function(){var e=new Pb.Component.Common.Likes.Likes});$.getObject("Pb.Component.Media",!0).Media=function(){function l(e){this.init(e)}var e=1e3,t=620,n=1024,r=580,i=320,s=225,o=1024,u=350,a=320,f=240,c={currentTarget:null,canEdit:!1,canCopy:!1,isMobile:!1,mediaTemplateTarget:null,mediaImg:null,mediaTitle:null,mediaDesc:null,commentCnt:null,rescaler:null,windowResizeBound:!1,winWidth:null,winHeight:null,pendingLoad:!1,direction:1,showPagination:!0,showPreview:!1,mediaSet:null,mediaMaxDims:{},swfDims:{},expressInstallPath:"/resources/common/swf/expressInstall.swf",init:function(e){var t=new Image;t.src=Pb.Data.get("picUrl")+"common/loading.gif";e.currentTarget&&(this.currentTarget=e.currentTarget);e.canEdit&&(this.canEdit=!0);e.canCopy&&(this.canCopy=!0);this.showPagination=e.showPagination;this.showPreview=e.showPreview;this.isMobile=Pb.Data.get("isMobile");this.rescaler=new Pb.ClientImageRescaler;this.getElements();this.setMediaMaxDims();this.addHelpers();this.bindEvents();this.preloadMediaFullsize()},getElements:function(){this.mediaTemplateTarget=$("#mediaTemplateTarget");this.mediaTemplate=$("#mediaTemplate");this.optionsHandle=$("#optionsBtn");this.mediaImg=$(".mediawrapper.currentMedia img")},addHelpers:function(){var e={shortText:function(e,t){return e?e.length>t?e.substring(0,t-3)+"...":e:""},toggleFullTitleLink:function(e,t){return e?e.length>t:!1}};$.views.helpers(e);return e},bindEvents:function(){var e=$(document);e.on("Detail::first_batch_received",$.proxy(function(e){if(this.showPreview){this.currentTarget.id=parseInt(e.currentOffset,10);this.setupPreviousNext(this.currentTarget.id);$(".prevPreview .bgPreview").css("backgroundImage",'url("'+this.currentTarget.prevUrl+'")');$(".nextPreview .bgPreview").css("backgroundImage",'url("'+this.currentTarget.nextUrl+'")')}else{this.currentTarget=Pb.Data.get(Pb.Data.Shared.MEDIA);this.mediaSet=Pb.Data.Shared.get("shared.mediaSet");if(this.isMobile&&typeof Pb.Animation!="undefined"){this.currentTarget.sequence="currentMedia";this.resizeMediaToFitWindow(e)}}},this));e.on("Pb.Component.Media.Media::preloadMediaFullsize",$.proxy(this.handleMediaFullsizePreload,this));e.on("Pb.Component.Media.Media::template-update",$.proxy(this.handleTemplateUpdate,this));e.on("Pb.Component.Media.Media::template-update",$.proxy(this.hidePagination,this));e.on("Pb.Component.Media.Media::replacePlaceHolder",$.proxy(this.resizeMediaToFitWindow,this));e.on("Pb.Component.Detail.Detail::current_media_update",$.proxy(this.handleMediaContentUpdate,this));e.on("click","#editBtn",$.proxy(function(e){document.location="/editor?image="+escape(this.currentTarget.fullsizeUrl)+"&detailUrl="+Pb.Data.get(Pb.Data.Shared.MEDIA).linkUrl},this));e.on("click","#slideshowBtn",$.proxy(function(e){document.location="/user/"+Pb.Data.get(Pb.Data.Shared.MEDIA).ownername+"/slideshow/"+Pb.Data.get(Pb.Data.Shared.MEDIA).location},this));e.on("click",".like",function(){Pb.Track.tr("detailpage_like_click")});e.on("click",".unlike",function(){Pb.Track.tr("detailpage_unlike_click")});this.mediaTemplate.on("click","#zoomBtn",$.proxy(function(e){if(this.currentTarget.mediaType==="video")return;Pb.Track.tr("detail_page_zoom_click");this.currentTarget.maxWidth=$(window).width();$(".contentWrapper").addClass("zoomed");Pb.JSTemplates.link("#zoomOriginalTemplate",".contentWrapper",this.currentTarget);Pb.Component.Ad&&Pb.Component.Ad.AdRefresh&&Pb.Component.Ad.AdRefresh.reloadAds();var t={path:this.currentTarget.path,url:this.currentTarget.originalUrl,title:this.currentTarget.name};window.history.pushState(t,this.currentTarget.name,this.currentTarget.linkUrl);window.onpopstate=function(e){document&&window.location.reload()}},this));if(!this.isMobile){$(".imageController").show();this.mediaTemplate.hoverIntent({over:function(){},out:function(){}});if(this.showPreview){e.on("mouseenter",".imageController",function(){$(this).attr("id")==="previous"?$(this).parent().find(".prevPreview .fancypantshovertreatment").addClass("hover"):$(this).parent().find(".nextPreview .fancypantshovertreatment").addClass("hover")});e.on("mouseleave",".imageController",function(){$(this).parent().find(".fancypantshovertreatment").removeClass("hover")})}}$(window).resize($.throttle(500,$.proxy(function(e){var t=$(window).width(),n=$(window).height();if(t!==this.winWidth||n!==this.winHeight){this.winWidth=t;this.winHeight=n;this.resizeMediaToFitWindow(e)}},this)));if(!this.canEdit&&!this.canCopy){e.on("contextmenu",".imageController",function(e){e.preventDefault()});e.on("contextmenu",".mediawrapper",function(e){e.preventDefault()})}else{e.on("mousedown",".is_moz .imageController",function(e){if(e.button===2){e.stopPropagation();$(".contentWrapper").addClass("contextMenu");$(".imageController").hide()}});e.on("mouseenter mouseleave",".is_moz .contextMenu",$.proxy(this.mozHideContextMenu,this));e.on("mouseenter mouseleave",".is_moz .contextMenu img",$.proxy(this.mozHideContextMenu,this));e.on("mouseup",".imageController",$.proxy(function(e){e.button===2&&this.showContextMenu(e)},this));e.on("contextmenu",".imageController",$.proxy(this.showContextMenu,this))}},mozShowContextMenu:function(e){e.stopPropagation();$(".contentWrapper").addClass("contextMenu");$(".imageController").hide()},mozHideContextMenu:function(e){$(".contextMenu").removeClass("contextMenu");$(".imageController").show()},showContextMenu:function(e){e.stopPropagation();$(".imageController").hide();setTimeout(function(){$(".imageController").show()},1e3)},bindInPlaceEditors:function(){if(!this.canEdit||this.isMobile)return;var e=this;this.mediaTitle=$("#mediaTitle");this.mediaTitle.length>0&&this.mediaTitle.find(".editable-field").first().editInPlace({callback:function(t,n,r){e.updateTitle(n,r);n===""&&(n="Click to add title");return n},show_buttons:!0,save_button:'<button class="btn btn-small btn-primary inplace_save icon-ok"></button>',cancel_button:'<button class="btn btn-small inplace_cancel icon-remove"></button>',default_text:"Click to add title",short_text:!1,maxlength:250,checkFullValue:!0,pb_track:function(){Pb.Track.trf("detailpage_title_click")},pb_validation:function(e){var t=!0;e=$.trim(e);if(e.length>250){var n={status:0,message:"Title cannot be more than 250 characters",details:""};Pb.Component.Element.Message.show(n);t=!1}return t},pb_helpers:this.addHelpers()})},preloadMediaFullsize:function(){if(this.currentTarget.mediaType!=="image")!this.isMobile&&typeof Pb.Animation=="undefined"&&this.resizeMediaToFitWindow();else if(!this.currentTarget.fsWidth){this.isMobile&&typeof Pb.Animation!="undefined"&&(this.windowResizeBound=!0);var e=new Pb.ClientImagePreloader,t=[this.currentTarget.fullsizeUrl];e.preLoad("Pb.Component.Media.Media::preloadMediaFullsize",t)}},handleMediaFullsizePreload:function(e){var t=e.dimensions[this.currentTarget.fullsizeUrl];this.currentTarget.fsWidth=t.width;this.currentTarget.fsHeight=t.height;this.currentTarget.nextClass="hidden";this.currentTarget.prevClass="hidden";if(this.currentTarget.rsWidth==="")if(t.width>this.mediaMaxDims.width||t.height>this.mediaMaxDims.height){var n=new Pb.ClientImageRescaler(this.mediaMaxDims),r=n.rescale(t);this.currentTarget.rsWidth=r.width;this.currentTarget.rsHeight=r.height;this.mediaImg.css({width:this.currentTarget.rsWidth+"px",height:this.currentTarget.rsHeight+"px"})}else this.mediaImg.css({width:this.currentTarget.fsWidth+"px",height:this.currentTarget.fsHeight+"px"});this.mediaImg.attr("src",this.currentTarget.fullsizeUrl);if(!this.windowResizeBound){this.windowResizeBound=!0;this.resizeMediaToFitWindow(e)}},handleMediaContentUpdate:function(e){$("#mediaTemplateTarget").removeClass("noBackground");this.currentTarget=e.newTarget;this.resizeMediaToFitWindow(e)},resizeMediaToFitWindow:function(e){if(this.videoPlaying())return;var t,n,r,i,s,o=$(window),u=o.width(),a=$(".topLinksContainer"),f=a.outerWidth()-10,l;this.setMediaMaxDims();this.mediaTemplateTarget.html("");if(this.currentTarget.mediaType==="video"||this.currentTarget.mediaType==="slideshow"){n=this.swfDims.width;t=this.swfDims.height}else{if(!this.currentTarget.fsWidth){this.currentTarget.placeHold=!0;this.pendingLoad=!0;this.setMinDefault();return}u<1024?this.showPreview?this.rescaler.setMaxWidth(this.mediaMaxDims.width-100):this.rescaler.setMaxWidth(this.mediaMaxDims.width):this.showPreview?this.rescaler.setMaxWidth(f-100):this.rescaler.setMaxWidth(f);this.rescaler.setMaxHeight(this.mediaMaxDims.height);var c={width:this.currentTarget.fsWidth,height:this.currentTarget.fsHeight},h=this.rescaler.rescale(c);t=h.height;n=h.width}if(this.isMobile){l=this.getMobileWebDims(n,t);n=l.w;t=l.h}this.linkToTemplate();this.bindInPlaceEditors();var p=this.getPolaroidDims(n,t),d=p.frameW,v=p.frameH,m=p.tableVerticalMargin,g=Math.min(d,this.mediaMaxDims.width),y=Math.min(v,this.mediaMaxDims.height),b=Math.min(n,this.mediaMaxDims.width),w=Math.min(t,this.mediaMaxDims.height);r=$(".mediawrapper.currentMedia");i=r.find(".tableWrapper");s=i.find(".currentView img");if(this.isMobile){if(n>this.mediaMaxDims.width){w=this.mediaMaxDims.width*t/n;b=this.mediaMaxDims.width}else{b=this.mediaMaxDims.height*n/t;w=this.mediaMaxDims.height}w<this.mediaMaxDims.height&&(m=(this.mediaMaxDims.height-w)/2);this.mediaTemplateTarget.css({width:Math.ceil(b)+"px",height:this.mediaMaxDims.height+"px",paddingLeft:Math.ceil((this.mediaMaxDims.width-b)/2),paddingRight:Math.ceil((this.mediaMaxDims.width-b)/2)})}r.css({width:Math.ceil(b)+"px",height:this.isMobile?"auto":w+"px"});i.css({width:b+"px",height:w+"px"});this.isMobile&&i.css({marginTop:m+"px",marginBottom:m+"px"});this.currentTarget.defaultWidth=g+"px";this.currentTarget.rsWidth=n;this.currentTarget.rsHeight=t;this.currentTarget.placeHold&&this.replacePlaceHolder();$("#mediaTemplateTarget").addClass("noBackground");this.isMobile||s.css({marginTop:($("#mediaTemplateTarget").height()-w)/2});if(this.showPreview){$(".fancypantshovertreatment").css({height:$("#mediaTemplateTarget").height()+"px"});$(".nextPreview .bgPreview, .prevPreview .bgPreview").css({height:$("#mediaTemplateTarget").height()+"px"});s.css({padding:"0 "+($("#mediaTemplateTarget").width()-100-b)/2+"px"})}s.css({width:b+"px",height:w+"px"})},setupPreviousNext:function(e){var t=Pb.Data.Shared.get(Pb.Data.Shared.MEDIA_SET),n=e-1,r=e+1,i,s,o,u,l,c,h,p,d;if(this.showPreview){t&&t[n]!==undefined&&(t[n].mediaType==="video"?this.currentTarget.prevUrl=t[n].thumbUrl:this.currentTarget.prevUrl=t[n].fullsizeUrl);t&&t[r]!==undefined&&(t[r].mediaType==="video"?this.currentTarget.nextUrl=t[r].thumbUrl:this.currentTarget.nextUrl=t[r].fullsizeUrl)}else if(this.isMobile){this.currentTarget.marginLeft=0;this.currentTarget.defaultHeight=null;this.currentTarget.tableW=null;this.currentTarget.tableH=null;this.currentTarget.tableMt=null;this.currentTarget.tableMt=null;this.currentTarget.defaultWidth=null;this.currentTarget.previous=[];this.currentTarget.next=[];if(t&&t[n]!==undefined){t[n].rsWidth?i=this.getMobileWebDims(t[n].rsWidth,t[n].rsHeight):i=this.getMobileWebDims(a,f);u=i.w;l=i.h;s=this.getPolaroidDims(u,l);c=Math.min(s.frameW,this.mediaMaxDims.width);h=Math.min(s.frameH,this.mediaMaxDims.height);if(u>this.mediaMaxDims.width){d=this.mediaMaxDims.width*l/u;p=this.mediaMaxDims.width}else{p=this.mediaMaxDims.height*u/l;d=this.mediaMaxDims.height}d<this.mediaMaxDims.height&&(s.tableVerticalMargin=(this.mediaMaxDims.height-d)/2);t[n].sequence="previousMedia";t[n].defaultHeight=h+"px";t[n].defaultWidth=c+"px";t[n].rsWidth=p;t[n].rsHeight=d;t[n].tableW=p+"px";t[n].tableH=d+"px";t[n].tableMt=s.tableVerticalMargin+"px";t[n].tableMb=s.tableVerticalMargin+"px";t[n].marginLeft="-"+c+"px";this.currentTarget.previous.push(t[n])}if(t&&t[r]!==undefined){t[r].rsWidth?i=this.getMobileWebDims(t[r].rsWidth,t[r].rsHeight):i=this.getMobileWebDims(a,f);u=i.w;l=i.h;o=this.getPolaroidDims(u,l);c=Math.min(o.frameW,this.mediaMaxDims.width);h=Math.min(o.frameH,this.mediaMaxDims.height);if(u>this.mediaMaxDims.width){d=this.mediaMaxDims.width*l/u;p=this.mediaMaxDims.width}else{p=this.mediaMaxDims.height*u/l;d=this.mediaMaxDims.height}d<this.mediaMaxDims.height&&(o.tableVerticalMargin=(this.mediaMaxDims.height-d)/2);t[r].sequence="nextMedia";t[r].marginLeft=0;t[r].defaultHeight=h+"px";t[r].defaultWidth=c+"px";t[r].rsWidth=p;t[r].rsHeight=d;t[r].tableW=p+"px";t[r].tableH=d+"px";t[r].tableMt=o.tableVerticalMargin+"px";t[r].tableMb=o.tableVerticalMargin+"px";this.currentTarget.next.push(t[r])}}},getMobileWebDims:function(e,t){e=s*e/t;t=s;return{w:e,h:t}},getPolaroidDims:function(e,t){var n,r,i=0,s=a,o=f;if(e<s&&t<o){n=s;r=o;i=t<o?(o-t)/2:0}else if(e<s&&t>=o){n=s;r=t;i=0}else if(e>=s&&t<o){n=e;r=o;i=(o-t)/2}else{n=e;r=t}return{frameW:n,frameH:r,tableVerticalMargin:i}},replacePlaceHolder:function(){var e=$("#"+this.currentTarget.placeHolderId);e.length>0&&e.attr("src",this.currentTarget.fullsizeUrl).css({width:this.currentTarget.rsWidth,height:this.currentTarget.rsHeight});this.currentTarget.placeHold=!1;this.pendingLoad=!1},setMediaMaxDims:function(){var l,c,h,p,d=$(window),v=0,m=0;m=$(".navbar").height();v=d.height()-m-$(".detailActionsWrapper").height();$("#bannerAd").length&&(v-=$("#bannerAd").height());if(this.isMobile){v=Math.min(u,v);i=Math.max(a-40,$(".detailCompWrapper").width()-5);s=Math.max(f,v)}else{v=Math.min(o,v-40);n=Math.max(r,v)}if(d.width()<=1024){l=this.isMobile?i:t;this.isMobile||(l=Math.min(d.width()-40,l));c=this.isMobile?s:n;h=this.isMobile?Math.min(d.width()-40,l):l}else{l=this.isMobile?i:e;c=this.isMobile?s:n;h=this.isMobile?Math.min(d.width()-40,l):$(".topLinksContainer").outerWidth()-10}this.mediaMaxDims={width:l,height:c};this.showPreview&&(this.mediaMaxDims.width=this.mediaMaxDims.width-24);Pb.Data.add("mediaMaxDims",this.mediaMaxDims);p=h/4*3;this.swfDims={width:h,height:p}},setMinDefault:function(){var e={width:$(".topLinksContainer").width()+"px",height:"auto"};$(".mediawrapper").css(e);$(".mediawrapper > table").css(e);$(".mediawrapper img:not(.placeHold)").css(e)},linkToTemplate:function(){var e,t=this.currentTarget.mediaType;switch(t){case"video":case"slideshow":case"flash":e="swfTemplate";break;default:if(!this.currentTarget.rsWidth){this.currentTarget.rsWidth=this.mediaMaxDims.width;this.currentTarget.placeHold=!0}e="imageTemplate"}this.currentTarget.likebutton[0].likeurl=this.currentTarget.fullsizeUrl;this.currentTarget.sequence="currentMedia";this.setupPreviousNext(this.currentTarget.id);this.isMobile?Pb.JSTemplates.link("mediaWrapperTemplate",this.mediaTemplateTarget,this.currentTarget):Pb.JSTemplates.link(e,this.mediaTemplateTarget,this.currentTarget);this.currentTarget.title||this.currentTarget.io||this.currentTarget.hashtagMedia?Pb.JSTemplates.link("#metatitleTemplate","#metatitleTarget",this.currentTarget):Pb.JSTemplates.link("#metatitleTemplate","#metatitleTarget",[]);this.isMobile&&Pb.JSTemplates.link("#metadataTemplate","#metadataTarget",this.currentTarget);Pb.JSTemplates.link("#likesButtonStarTemplate","#likeTarget",this.currentTarget);this.updateLikeButtonState(this.currentTarget);this.updateFollowButtonState(this.currentTarget);var n=$.Event("Pb.Component.Media.Media::template-update",{mediaType:t,newTarget:this.currentTarget});$(document).trigger(n);var r=this.mediaTemplateTarget.find("div#previous"),i=this.mediaTemplateTarget.find("div#next");i.on("click",function(e){$(document).trigger($.Event("Pb.Component.Media.Media::media_next_click"));(Pb.Data.get("featureTrackingKey")==="mdpreviewnew"||Pb.Data.get("featureTrackingKey")==="mdpreviewcurrent")&&Pb.Component.Tracking.Mixpanel.track("media arrow click",{direction:"next"})});r.on("click",function(e){$(document).trigger($.Event("Pb.Component.Media.Media::media_previous_click"));(Pb.Data.get("featureTrackingKey")==="mdpreviewnew"||Pb.Data.get("featureTrackingKey")==="mdpreviewcurrent")&&Pb.Component.Tracking.Mixpanel.track("media arrow click",{direction:"previous"})})},updateLikeButtonState:function(e){var t=$("#likeTarget .like"),n=$("#likeTarget .unlike");t.data("likeurl",e.fullsizeUrl);n.data("likeurl",e.fullsizeUrl);if(e.isLiked){t.hide();n.show()}else{t.show();n.hide()}},updateFollowButtonState:function(e){var t=$("a.follow");if(!t.hasClass("disabled"))if(e.isFollowing){t.addClass("following");t.text("Following");t.data("complete-text","Following")}else{t.removeClass("following");t.addClass("btn-primary");t.removeClass("btn-secondary");t.text("Follow");t.data("complete-text","Follow")}},handleTemplateUpdate:function(e){var t=["#slideshowBtn","#zoomBtn","#editBtn"];if(e.mediaType==="video"){var n=$(document.documentElement);(n.hasClass("is_iPad")||n.hasClass("is_iPhone")||n.hasClass("is_android")||this.isMobile)&&Modernizr.video.h264?this.loadVideoTag():this.loadFlashVideo();$.each(t,function(e,t){$(t).hide()});$("#detailOptionsMenu.dropdown-menu").addClass("video");$("#mediaTemplateTarget").addClass("video")}else if(e.mediaType==="slideshow")this.loadSlideshow();else if(e.mediaType==="flash")this.loadSwf();else if(e.mediaType==="image"){$.each(t,function(e,t){$(t).show()});$("#detailOptionsMenu.dropdown-menu").removeClass("video");$("#mediaTemplateTarget").removeClass("video")}},loadVideoTag:function(){$("video").remove();var e=$(".currentMedia #flashcontent"),t=$("html").hasClass("is_iPhone"),n=$("html").hasClass("is_android"),r=$("html").hasClass("is_webkit"),i=this.currentTarget.fullsizeUrl,s=t?'style="height: 1px; width: 1px;"':'style="height: '+this.swfDims.height+"px; width: "+this.swfDims.width+'px;"',o=this.isMobile?"":'autoplay="autoplay"';this.isMobile&&!t&&(s='style="max-height:'+this.mediaMaxDims.height+'px" width="98%"');i=i.replace(/^http:\/\/i/,"http://vid");i=i.replace(/^http:\/\/gi/,"http://gvid");e.html("");var u="";if(t){u+='<img src="'+this.currentTarget.posterUrl+'" '+s+' id="videoPoster" />';u+='<div class="thumbnailOverlay"></div>'}u+='<video class="video" poster="'+this.currentTarget.posterUrl+'" id="video'+this.currentTarget.id+'" '+s+' controls="controls" '+o+">";u+='<source src="'+i+'" type=\'video/mp4; codecs="avc1.42E01E, mp4a.40.2"\' />';u+="Your browser does not support the video tag.";u+="</video>";e.html(u);if(this.isMobile){(t||n&&r)&&$(e).swipe({tap:$.proxy(function(){var e=document.getElementById("video"+this.currentTarget.id);e.paused?e.play():e.pause()},this)});e.parent().parent().css({height:this.swfDims.height+"px",width:this.swfDims.width+"px"})}},loadFlashVideo:function(){var e=this.currentTarget.fullsizeUrl;e=e.replace(/^http:\/\/i/,"http://vid");e=e.replace(/^http:\/\/gi/,"http://gvid");var t=Pb.Data.get("picUrl")+"flash/oldplayer/Player.swf",n={file:e,os:1,ap:1,title:encodeURIComponent(this.currentTarget.title)},r={wmode:"transparent",allowScriptAccess:"always",allowNetworking:"all",allowFullscreen:"true"};swfobject.embedSWF(t,"flashcontent",this.swfDims.width,this.swfDims.height,"6.0.65",this.expressInstallPath,n,r)},loadSlideshow:function(){var e="/resources/common/swf/pbwidget.swf",t={pbwurl:this.currentTarget.fullsizeUrl},n={wmode:"transparent"};swfobject.embedSWF(e,"flashcontent",this.swfDims.width,this.swfDims.height,"6.0.65",this.expressInstallPath,t,n)},loadSwf:function(){var e=this.currentTarget.fullsizeUrl,t={},n={wmode:"transparent",allowScriptAccess:"never",allowNetworking:"internal"};swfobject.embedSWF(e,"flashcontent",this.swfDims.width,this.swfDims.height,"6.0.65",this.expressInstallPath,t,n)},videoPlaying:function(){var e=document.getElementById("video"+this.currentTarget.id);return e?!0:!1},updateTitle:function(e,t){var n="/action/media/updateTitle",r={title:e,mediaUrl:this.currentTarget.fullsizeUrl};Pb.Component.Ad&&Pb.Component.Ad.AdRefresh&&Pb.Component.Ad.AdRefresh.reloadAds();Pb.Ajax.ajax({url:n,data:r,success:$.proxy(function(e){if(e.status===1){this.currentTarget.title=e.data.title;this.currentTarget.isPersisted=!0;return!0}return!1},this)})},hidePagination:function(){var e="hidePagination",t={hoverArrows:"#mediaTemplate",prevnextButtons:".prevnext"};this.showPagination||$.each(t,function(t,n){$(n).addClass(e)})}};$.extend(l.prototype,c);return l}();(function(e){function n(e,t){this.settings=e;this.dom=t;this.originalValue=null;this.fullValue=null;this.didInsertDefaultText=!1;this.shouldDelayReinit=!1}function r(e){if(e.url||e.callback)return;throw new Error("Need to set either url: or callback: option for the inline editor to work.")}function i(e){if(""===e)return;var t=new Image;t.src=e}function s(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}function o(e){return undefined===e||null===e?!1:0===e.length?!1:!0}e.fn.editInPlace=function(t){var s=e.extend({},e.fn.editInPlace.defaults,t);r(s);i(s.saving_image);return this.each(function(){var t=e(this);if(t.data("editInPlace"))return;t.data("editInPlace",!0);var r=new n(s,t);r.init();t.data("editInPlaceEditor",r)})};e.fn.editInPlace.defaults={pb_validation:null,pb_track:null,openOnClick:!0,url:"",bg_over:"#ffc",bg_out:"transparent",hover_class:"editHover",show_buttons:!1,save_button:'<button class="inplace_save">Save</button>',cancel_button:'<button class="inplace_cancel">Cancel</button>',params:"",field_type:"text",default_text:"(Click here to add text)",use_html:!1,textarea_rows:10,textarea_cols:25,select_text:"Choose new value",select_options:"",short_text:!0,text_size:null,saving_text:undefined,saving_image:"",saving_animation_color:"transparent",value_required:!1,element_id:"element_id",update_value:"update_value",original_value:"original_value",original_html:"original_html",save_if_nothing_changed:!1,on_blur:"save",cancel:"",callback:null,callback_skip_dom_reset:!1,success:null,error:null,error_sink:function(e,t){alert(t)},preinit:null,postclose:null,delegate:null};var t={shouldOpenEditInPlace:function(e,t,n){},willOpenEditInPlace:function(e,t){},didOpenEditInPlace:function(e,t){},shouldCloseEditInPlace:function(e,t,n){},willCloseEditInPlace:function(e,t){},didCloseEditInPlace:function(e,t){},missingCommaErrorPreventer:""};e.extend(n.prototype,{isOpened:!1,init:function(){this.setDefaultTextIfNeccessary();this.connectOpeningEvents()},reinit:function(){if(this.shouldDelayReinit)return;this.triggerCallback(this.settings.postclose,this.dom);this.triggerDelegateCall("didCloseEditInPlace");this.markEditorAsInactive();this.connectOpeningEvents()},setDefaultTextIfNeccessary:function(){if(""!==e.trim(this.dom.html()))return;this.dom.html(this.settings.default_text);this.didInsertDefaultText=!0},connectOpeningEvents:function(){var e=this;this.dom.bind("mouseenter.editInPlace",function(){e.addHoverEffect()}).bind("mouseleave.editInPlace",function(){e.removeHoverEffect()});this.settings.openOnClick&&this.dom.bind("click.editInPlace",function(t){e.openEditor(t)})},disconnectOpeningEvents:function(){this.dom.unbind(".editInPlace")},addHoverEffect:function(){this.settings.hover_class?this.dom.addClass(this.settings.hover_class):this.dom.css("background-color",this.settings.bg_over)},removeHoverEffect:function(){this.settings.hover_class?this.dom.removeClass(this.settings.hover_class):this.dom.css("background-color",this.settings.bg_out)},openEditor:function(e){if(!this.shouldOpenEditor(e))return;typeof this.settings.pb_track=="function"&&this.settings.pb_track();this.disconnectOpeningEvents();this.removeHoverEffect();this.removeInsertedDefaultTextIfNeccessary();this.saveOriginalValue();this.markEditorAsActive();this.replaceContentWithEditor();this.setInitialValue();this.workAroundMissingBlurBug();this.connectClosingEventsToEditor();this.triggerDelegateCall("didOpenEditInPlace")},shouldOpenEditor:function(e){return this.isClickedObjectCancelled(e.target)?!1:!1===this.triggerCallback(this.settings.preinit,this.dom)?!1:!1===this.triggerDelegateCall("shouldOpenEditInPlace",!0,e)?!1:this.isOpened?!1:!0},removeInsertedDefaultTextIfNeccessary:function(){if(!this.didInsertDefaultText||this.dom.html()!==this.settings.default_text)return;this.dom.html("");this.didInsertDefaultText=!1},isClickedObjectCancelled:function(t){if(!this.settings.cancel)return!1;var n=e(t).parents().andSelf(),r=n.filter(this.settings.cancel);return 0!==r.length},saveOriginalValue:function(){if(this.settings.use_html)this.originalValue=this.dom.html();else{if(this.settings.checkFullValue){var e;this.dom.next().length?e=this.dom.next().val():e=this.dom.val();e.length>0&&(this.fullValue=e)}this.originalValue=s(this.dom.text())}},restoreOriginalValue:function(){var e;if(this.originalValue===""){e=this.settings.default_text;this.didInsertDefaultText=!0}else e=this.originalValue;this.setClosedEditorContent(e)},setClosedEditorContent:function(e){this.settings.use_html?this.dom.html(e):this.dom.text(e)},workAroundMissingBlurBug:function(){var e=this.dom.find(":input");this.dom.parents(":last").find(".editInPlace-active :input").not(e).blur()},replaceContentWithEditor:function(){var e=this.settings.show_buttons?'<span class="editctrls">'+this.settings.cancel_button+" "+this.settings.save_button+"</span>":"",t=this.createEditorElement();this.dom.html('<form class="inplace_form" style="display: inline; margin: 0; padding: 0;"></form>').find("form").append(t).append(e)},createEditorElement:function(){if(-1===e.inArray(this.settings.field_type,["text","textarea","select"]))throw"Unknown field_type <fnord>, supported are 'text', 'textarea' and 'select'";var t=null;"select"===this.settings.field_type?t=this.createSelectEditor():"text"===this.settings.field_type?t=e('<input type="text" '+this.inputNameAndClass()+' size="'+this.settings.text_size+'"'+(this.settings.maxlength?' maxlength="'+this.settings.maxlength+'"':"")+" />"):"textarea"===this.settings.field_type&&(t=e("<textarea "+this.inputNameAndClass()+(this.settings.maxlength?' maxlength="'+this.settings.maxlength+'" ':"")+' rows="'+this.settings.textarea_rows+'" '+' cols="'+this.settings.textarea_cols+'" />'));return t},setInitialValue:function(){var e=this.triggerDelegateCall("willOpenEditInPlace",this.originalValue);this.settings.checkFullValue&&this.fullValue&&(e=this.fullValue);var t=this.dom.find(":input");t.val(e);t.val()!==e&&t.val("")},inputNameAndClass:function(){return' name="inplace_value" class="inplace_field" '},createSelectEditor:function(){var t=e("<select"+this.inputNameAndClass()+">"+'<option disabled="true" value="">'+this.settings.select_text+"</option>"+"</select>"),n=this.settings.select_options;e.isArray(n)||(n=n.split(","));for(var r=0;r<n.length;r++){var i=n[r];e.isArray(i)||(i=i.split(":"));var o=s(i[1]||i[0]),u=s(i[0]),a=e("<option>").val(o).text(u);t.append(a)}return t},connectClosingEventsToEditor:function(){function t(t){e.handleCancelEditor(t);return!1}function n(t){e.handleSaveEditor(t);return!1}var e=this,r=this.dom.find("form");r.find(".inplace_field").focus().select();r.find(".inplace_cancel").click(t);r.find(".inplace_save").click(n);this.settings.show_buttons||("save"===this.settings.on_blur?r.find(".inplace_field").blur(n):r.find(".inplace_field").blur(t));r.keyup(function(e){var n=27;if(n===e.which)return t()});this.bindSubmitOnEnterInInput();r.submit(n)},bindSubmitOnEnterInInput:function(){if("textarea"===this.settings.field_type)return;var e=this;this.dom.find(":input").keydown(function(t){var n=13;if(n===t.which)return e.dom.find("form").submit()})},handleCancelEditor:function(t){if(!1===this.triggerDelegateCall("shouldCloseEditInPlace",!0,t))return;var n=this.dom.find(":input").val();n=this.triggerDelegateCall("willCloseEditInPlace",n);this.restoreOriginalValue();var r=this.dom.parent();r.removeClass("error");r.find(".help-inline").each(function(){e(this).remove()});this.reinit()},handleSaveEditor:function(t){if(!this.triggerDelegateCall("shouldCloseEditInPlace",!0,t))return;var n=this.dom.find(":input").val();n=this.triggerDelegateCall("willCloseEditInPlace",n);if(this.isDisabledDefaultSelectChoice()||this.isUnchangedInput(n)){this.handleCancelEditor(t);return}if(this.didForgetRequiredText(n)){this.handleCancelEditor(t);this.reportError("Error: You must enter a value to save this field");return}n=e.trim(n);if(n===this.originalValue){this.handleCancelEditor(t);return}if(typeof this.settings.pb_validation=="function"){var r=this.settings.pb_validation(n,this.originalValue);if(!r)return}this.showSaving(n);this.settings.callback?this.handleSubmitToCallback(n):this.handleSubmitToServer(n)},didForgetRequiredText:function(e){return this.settings.value_required&&(""===e||undefined===e||null===e)},isDisabledDefaultSelectChoice:function(){return this.dom.find("option").eq(0).is(":selected:disabled")},isUnchangedInput:function(e){return!this.settings.save_if_nothing_changed&&this.originalValue===e},showSaving:function(t){if(this.settings.callback&&this.settings.callback_skip_dom_reset)return;var n=t;o(this.settings.saving_text)&&(n=this.settings.saving_text);o(this.settings.saving_image)&&(n=e("<img />").attr("src",this.settings.saving_image).attr("alt",n));this.dom.html(n)},handleSubmitToCallback:function(t){this.enableOrDisableAnimationCallbacks(!0,!1);var n=this.triggerCallback(this.settings.callback,this.id(),t,this.originalValue,this.settings.params,this.savingAnimationCallbacks());if(this.settings.checkFullValue&&this.settings.pb_helpers){var r=this.settings.pb_helpers;if(r.toggleFullTitleLink(n,40)){this.dom.next().val(n);e("#mediaTitleFull").text(n);this.settings.short_text&&(n=r.shortText(n,40));e("#mediaTitleFullLink").show()}else if(n==="Click to add title"){e("#mediaTitleOverlayWrap").hide();e("#mediaTitleFullLink").hide();this.fullValue="";e("#mediaTitleFull").text("");e("#fullText").val("")}}if(this.settings.callback_skip_dom_reset)return;if(undefined===n){this.reportError("Error: Failed to save value: "+t);this.restoreOriginalValue()}else this.dom.html(n);if(this.didCallNoCallbacks()){this.enableOrDisableAnimationCallbacks(!1,!1);this.reinit()}},handleSubmitToServer:function(t){var n=this.settings.update_value+"="+encodeURIComponent(t)+"&"+this.settings.element_id+"="+this.dom.attr("id")+(this.settings.params?"&"+this.settings.params:"")+"&"+this.settings.original_html+"="+encodeURIComponent(this.originalValue)+"&"+this.settings.original_value+"="+encodeURIComponent(this.originalValue);this.enableOrDisableAnimationCallbacks(!0,!1);this.didStartSaving();var r=this;e.ajax({url:r.settings.url,type:"POST",data:n,dataType:"html",complete:function(e){r.didEndSaving()},success:function(e){var t=e||r.settings.default_text;r.dom.html(t);r.triggerCallback(r.settings.success,e)},error:function(e){r.dom.html(r.originalHTML);r.settings.error?r.triggerCallback(r.settings.error,e):r.reportError("Failed to save value: "+e.responseText||"Unspecified Error")}})},triggerCallback:function(e){if(!e)return;var t=Array.prototype.slice.call(arguments,1);return e.apply(this.dom[0],t)},triggerDelegateCall:function(t,n,r){if(!this.settings.delegate||!e.isFunction(this.settings.delegate[t]))return n;var i=this.settings.delegate[t](this.dom,this.settings,r);return undefined===i?n:i},reportError:function(e){this.triggerCallback(this.settings.error_sink,this.id(),e)},id:function(){return this.dom.attr("id")},markEditorAsActive:function(){this.dom.addClass("editInPlace-active");this.isOpened=!0},markEditorAsInactive:function(){this.dom.removeClass("editInPlace-active");this.isOpened=!1},savingAnimationCallbacks:function(){var e=this;return{didStartSaving:function(){e.didStartSaving()},didEndSaving:function(){e.didEndSaving()}}},enableOrDisableAnimationCallbacks:function(e,t){this.didStartSaving.enabled=e;this.didEndSaving.enabled=t},didCallNoCallbacks:function(){return this.didStartSaving.enabled&&!this.didEndSaving.enabled},assertCanCall:function(e){if(!this[e].enabled)throw new Error("Cannot call "+e+" now. See documentation for details.")},didStartSaving:function(){this.assertCanCall("didStartSaving");this.shouldDelayReinit=!0;this.enableOrDisableAnimationCallbacks(!1,!0);this.startSavingAnimation()},didEndSaving:function(){this.assertCanCall("didEndSaving");this.shouldDelayReinit=!1;this.enableOrDisableAnimationCallbacks(!1,!1);this.reinit();this.stopSavingAnimation()},startSavingAnimation:function(){var e=this;this.dom.animate({backgroundColor:this.settings.saving_animation_color},400).animate({backgroundColor:"transparent"},400,"swing",function(){setTimeout(function(){e.startSavingAnimation()},10)})},stopSavingAnimation:function(){this.dom.stop(!0).css({backgroundColor:""})},missingCommaErrorPreventer:""})})(jQuery);$.getObject("Pb.Component.Media",!0).ZoomModal=function(){function e(){e.superclass.constructor.call(this)}var t,n={templateLinked:!1,modalData:[],init:function(t){var n={modalId:"#zoomModal",modalName:"zoomModal",showProgress:!0,refreshAdsOnHide:!0,shownEvent:"Pb.Component.Media.ZoomModal::shown",hideEvent:"Pb.Component.Media.ZoomModal::hide"};t&&$.extend(n,t);$.views.helpers({getImageUrl:function(){var e=Pb.Data.get(Pb.Data.Shared.MEDIA);return e.fullsizeUrl}});e.superclass.init.call(this,n)},prepareDataForTemplate:function(e){return e},onShow:function(t){e.superclass.onShow.call(this,t);this.fitModal();$(window).resize(this.fitModal);$("#zoomModal").on("click",".zoomOriginal",function(){$(".contentWrapper").addClass("zoomed");var e=Pb.Data.get(Pb.Data.Shared.MEDIA);e.maxWidth=$(window).width();Pb.JSTemplates.link("#zoomOriginalTemplate",".contentWrapper",e);var t={path:e.path,url:e.originalUrl,title:e.name};window.history.pushState(t,e.name,e.linkUrl);window.onpopstate=function(e){document&&window.location.reload()};$("#zoomModal").modal("hide")});$(".zoomOriginal").tooltip({placement:"top",delay:{show:300,hide:100}})},fitModal:function(){var e=Pb.Data.get(Pb.Data.Shared.MEDIA),t=e.fsHeight,n=10,r=$(window).height(),i=$(window).width();$(".zoomModal").css("max-height",r-n+"px");$(".zoomModal").css("max-width",i-n+"px");$(".zoomModal").find("img").css("max-height",r-n*2+"px");$(".zoomModal").find("img").css("max-width",i-n*2+"px");parseInt($(".zoomModal").css("min-height"),10)>r&&$(".zoomModal").css("min-height",r+"px");var s=$(".zoomModal").height(),o=(s-t)/2;o>0&&$(".zoomModal").find("img").css("margin-top",o+"px")}};Pb.subclass(e,Pb.Component.Element.Modal,n);t=new e;Pb.InitEventQueue.add(function(){t.init()});return t}();$.getObject("Pb.Component.Detail",!0).MoreContentContainer=function(){function e(e){this.init(e)}var t={properties:{trendingContainer:".trending",templateId:"#thumbnailMediaTemplate",subalbumsContainer:".publicalbums",subalbumId:"#albumThumbnailTemplate",urlRoot:"/component/Detail-MoreContentContainer"},init:function(e){$.extend(this.properties,e);this.properties.trendingUrl=this.properties.urlRoot+"?"+this.properties.trendingQuery;this.properties.container=$(this.properties.containerId);Pb.JSTemplates.link(this.properties.templateId,this.properties.trendingContainer,[]);this.fetch(this.properties.trendingUrl,this.properties.trendingContainer)},initEvents:function(){},fetch:function(e,t){var n,r;Pb.Ajax.ajax({url:e,success:$.proxy(function(e){if(e){if(e.albums)if(e.albums.length){$(".moreContentContainer .albumsHead").show();for(n=0;n<e.albums.length;n++){r=$(Pb.JSTemplates.render(this.properties.subalbumId,e.albums[n]));$(this.properties.subalbumsContainer).append(r)}}else $(".moreContentContainer .albumsHead").hide();if(e.trending)if(e.trending.length){$(".moreContentContainer .trendingHead").show();Pb.JSTemplates.link(this.properties.templateId,t,e.trending)}else $(".moreContentContainer .trendingHead").hide()}},this),type:"get"})}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.Navigation",!0).DetailBreadcrumbs=function(){function e(e){this.init(e)}var t={offsetElement:null,init:function(e){this.offsetElement=$("#offset");this.bindEvents()},bindEvents:function(){var e=$(document);e.on("Pb.Component.Filmstrip.Filmstrip::filmstrip_offset_update",$.proxy(this.updateOffset,this));e.on("Pb.Component.Detail.MediaManager::media_offset_update",$.proxy(this.updateOffset,this))},updateOffset:function(e){var t=e.currentOffset+1;this.offsetElement.text(t)}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.Detail",!0).MediaManager=function(){function e(e){this.init(e)}var t={libData:null,libDataMax:null,libDataMin:null,currentOffset:0,total:null,mediaPrevArrow:null,mediaNextArrow:null,contentUpdateInfo:null,isFetching:!1,lastFetchOffset:null,fetchMoreEvent:"Pb.Component.Detail.MediaManager::media_manager_update",offsetUpdateEvent:"Pb.Component.Detail.MediaManager::media_offset_update",init:function(e){e.currentOffset&&(this.currentOffset=parseInt(e.currentOffset,10));e.total&&(this.total=e.total);this.libData=Pb.Data.Shared.get(Pb.Data.Shared.MEDIA_SET);this.libDataMin=Pb.Data.get("libDataMin");this.libDataMax=Pb.Data.get("libDataMax");this.getElements();this.bindEvents();this.toggleMediaArrow();this.preloadFullsizeImages(this.currentOffset-1,this.currentOffset+1)},getElements:function(){this.mediaPrevArrow=$("#mediaTemplate a#previous");this.mediaNextArrow=$("#mediaTemplate a#next")},bindEvents:function(){var e=$(document);e.bind("preloadFullsize",$.proxy(function(e){this.handlePreloadedFullsize(e)},this));e.on("Pb.Component.Media.Media::media_previous_click",$.proxy(function(e){Pb.Track.trf("detail_pagination_previous_click");this.move(-1)},this)).on("Pb.Component.Media.Media::media_next_click",$.proxy(function(e){Pb.Track.trf("detail_pagination_next_click");this.move(1)},this)).on("Pb.Component.Detail.DetailActions::media_next_click",$.proxy(function(e){this.move(1)},this)).on("Pb.Component.Detail.DetailActions::media_previous_click",$.proxy(function(e){this.move(-1)},this)).on("Pb.Component.Media.Media::media_next_swipe",$.proxy(function(e){Pb.Track.trf("detail_pagination_next_swipe");this.move(1)},this)).on("Pb.Component.Media.Media::media_previous_swipe",$.proxy(function(e){Pb.Track.trf("detail_pagination_previous_swipe");this.move(-1)},this));e.on("Pb.Component.Media.Media::template-update",$.proxy(this.toggleMediaArrow,this));e.on("keyup.mediadetail",$.proxy(this.onKeyUp,this));e.on("Pb.Component.Media.ZoomModal::shown",function(){$(document).off("keyup.mediadetail")});e.on("Pb.Component.Media.ZoomModal::hide",$.proxy(function(e){$(document).on("keyup.mediadetail",$.proxy(this.onKeyUp,this))},this));e.on("Pb.Component.Detail.Fetcher::libdata_update",$.proxy(this.updateLibData,this))},onKeyUp:function(e){var t=e.target.tagName;if(t==="INPUT"||t==="TEXTAREA")return;var n=e.keyCode;if(n===37||n===188){Pb.Track.trf("detail_pagination_left_keyboard_click");this.move(-1)}else if(n===39||n===190){Pb.Track.trf("detail_pagination_right_keyboard_click");this.move(1)}},updateLibData:function(e){this.libData=Pb.Data.Shared.get(Pb.Data.Shared.MEDIA_SET);this.libDataMin=Pb.Data.get("libDataMin");this.libDataMax=Pb.Data.get("libDataMax");this.libDataCount=Pb.Data.get("libDataCount");this.isFetching=!1;this.contentUpdateInfo={dir:e.dir,start:e.startOffset,end:e.endOffset};var t=e.startOffset-3;t<0&&(t=0);typeof e!="undefined"&&this.preloadFullsizeImages(t,e.startOffset)},testThresholds:function(e){var t=20,n=this.currentOffset+t,r={isFirstRender:!1,dir:e},i=!1;if(e===1&&this.libDataMax<=n){i=!0;r.startOffset=this.libDataMax+1}if(i){var s=$.Event(this.fetchMoreEvent,r);$(document).trigger(s)}},preloadFullsizeImages:function(e,t){var n=[];for(var r=e;r<=t;r++){var i=this.libData[r];typeof i!="undefined"&&i.mediaType==="image"&&(i.fsWidth||n.push(i.fullsizeUrl))}if(n.length>0){var s=new Pb.ClientImagePreloader;s.preLoad("preloadFullsize",n,{start:e,end:t})}},handlePreloadedFullsize:function(e){var t=e.dimensions,n=e.memo;for(var r=n.start;r<=n.end;r++){var i=this.libData[r];if(typeof i=="undefined")continue;var s=i.fullsizeUrl,o;if(i.mediaType==="image"){if(t[s]){i.fsWidth=t[s].width;i.fsHeight=t[s].height}if(i.rsWidth===""){o={width:i.fsWidth,height:i.fsHeight};var u=Pb.Data.get("mediaMaxDims");if(i.fsWidth>u.width||i.fsHeight>u.height){var a=new Pb.ClientImageRescaler(u);o=a.rescale(o)}if(o){i.rsWidth=o.width;i.rsHeight=o.height}}}i.placeHold===!0&&$(document).trigger($.Event("Pb.Component.Media.Media::replacePlaceHolder"))}},move:function(e){var t=this.currentOffset,n=0,r;this.currentOffset=this.currentOffset+e;this.currentOffset<0?this.currentOffset=0:n=this.currentOffset-2;r=this.currentOffset+2;n=n<0?0:n;r=r>this.total-1?this.total-1:r;this.preloadFullsizeImages(n,r);var i=$.Event(this.offsetUpdateEvent,{currentOffset:this.currentOffset,oldOffset:t});$(document).trigger(i);this.toggleMediaArrow();this.testThresholds(e)},toggleMediaArrow:function(){var e=this.currentOffset,t=e===0?"hidden":"visible";this.mediaPrevArrow.css("visibility",t);$("#mediaTemplate").data("prev",t);$("#btnprev").toggleClass("disabled",e===0);var n=e===this.total-1?"hidden":"visible";this.mediaNextArrow.css("visibility",n);$("#mediaTemplate").data("next",n);$("#btnnext").toggleClass("disabled",e===this.total-1)}};$.extend(e.prototype,t);return e}();(function(e){function t(t){var n=t||window.event,r=[].slice.call(arguments,1),i=0,s=!0,o=0,u=0;return t=e.event.fix(n),t.type="mousewheel",n.wheelDelta&&(i=n.wheelDelta/120),n.detail&&(i=-n.detail/3),u=i,n.axis!==undefined&&n.axis===n.HORIZONTAL_AXIS&&(u=0,o=-1*i),n.wheelDeltaY!==undefined&&(u=n.wheelDeltaY/120),n.wheelDeltaX!==undefined&&(o=-1*n.wheelDeltaX/120),r.unshift(t,i,o,u),(e.event.dispatch||e.event.handle).apply(this,r)}var n=["DOMMouseScroll","mousewheel"];if(e.event.fixHooks)for(var r=n.length;r;)e.event.fixHooks[n[--r]]=e.event.mouseHooks;e.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var e=n.length;e;)this.addEventListener(n[--e],t,!1);else this.onmousewheel=t},teardown:function(){if(this.removeEventListener)for(var e=n.length;e;)this.removeEventListener(n[--e],t,!1);else this.onmousewheel=null}},e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})})(jQuery);(function(e){function t(e,t){var n=parseInt(e.css(t),10);if(n)return n;var r=e[0].currentStyle;return r&&r.width&&parseInt(r.width,10)}function n(t,n){var r=e(n);return r.length<2?r:t.parent().find(n)}function i(t,i){var s=this,o=t.add(s),u=t.children(),f=0,l=i.vertical;r||(r=s),u.length>1&&(u=e(i.items,t)),i.size>1&&(i.circular=!1),e.extend(s,{getConf:function(){return i},getIndex:function(){return f},getSize:function(){return s.getItems().size()},getNaviButtons:function(){return m.add(g)},getRoot:function(){return t},getItemWrap:function(){return u},getItems:function(){return u.find(i.item).not("."+i.clonedClass)},move:function(e,t){return s.seekTo(f+e,t)},next:function(e){return s.move(i.size,e)},prev:function(e){return s.move(-i.size,e)},begin:function(e){return s.seekTo(0,e)},end:function(e){return s.seekTo(s.getSize()-1,e)},focus:function(){r=s;return s},addItem:function(t){t=e(t),i.circular?(u.children().last().before(t),u.children().first().replaceWith(t.clone().addClass(i.clonedClass))):(u.append(t),g.removeClass("disabled")),o.trigger("onAddItem",[t]);return s},seekTo:function(t,n,c){t.jquery||(t*=1);if(i.circular&&t===0&&f==-1&&n!==0)return s;if(!i.circular&&t<0||t>s.getSize()||t<-1)return s;var h=t;t.jquery?t=s.getItems().index(t):h=s.getItems().eq(t);var p=e.Event("onBeforeSeek");if(!c){o.trigger(p,[t,n]);if(p.isDefaultPrevented()||!h.length)return s}var v=l?{top:-h.position().top}:{left:-h.position().left};f=t,r=s,n===undefined&&(n=i.speed),u.animate(v,n,i.easing,c||function(){o.trigger("onSeek",[t])});return s}}),e.each(["onBeforeSeek","onSeek","onAddItem"],function(t,n){e.isFunction(i[n])&&e(s).bind(n,i[n]),s[n]=function(t){t&&e(s).bind(n,t);return s}});if(i.circular){var h=s.getItems().slice(-1).clone().prependTo(u),p=s.getItems().eq(1).clone().appendTo(u);h.add(p).addClass(i.clonedClass),s.onBeforeSeek(function(e,t,n){if(!e.isDefaultPrevented()){if(t==-1){s.seekTo(h,n,function(){s.end(0)});return e.preventDefault()}t==s.getSize()&&s.seekTo(p,n,function(){s.begin(0)})}});var v=t.parents().add(t).filter(function(){if(e(this).css("display")==="none")return!0});v.length?(v.show(),s.seekTo(0,0,function(){}),v.hide()):s.seekTo(0,0,function(){})}var m=n(t,i.prev).click(function(e){e.stopPropagation(),s.prev()}),g=n(t,i.next).click(function(e){e.stopPropagation(),s.next()});i.circular||(s.onBeforeSeek(function(e,t){setTimeout(function(){e.isDefaultPrevented()||(m.toggleClass(i.disabledClass,t<=0),g.toggleClass(i.disabledClass,t>=s.getSize()-1))},1)}),i.initialIndex||m.addClass(i.disabledClass)),s.getSize()<2&&m.add(g).addClass(i.disabledClass),i.mousewheel&&e.fn.mousewheel&&t.mousewheel(function(e,t){if(i.mousewheel){s.move(t<0?1:-1,i.wheelSpeed||50);return!1}});if(i.touch){var y={};u[0].ontouchstart=function(e){var t=e.touches[0];y.x=t.clientX,y.y=t.clientY},u[0].ontouchmove=function(e){if(e.touches.length==1&&!u.is(":animated")){var t=e.touches[0],n=y.x-t.clientX,r=y.y-t.clientY;s[l&&r>0||!l&&n>0?"next":"prev"](),e.preventDefault()}}}i.keyboard&&e(document).bind("keydown.scrollable",function(t){if(!(!i.keyboard||t.altKey||t.ctrlKey||t.metaKey||e(t.target).is(":input"))){if(i.keyboard!="static"&&r!=s)return;var n=t.keyCode;if(!(!l||n!=38&&n!=40)){s.move(n==38?-1:1);return t.preventDefault()}if(!l&&(n==37||n==39)){s.move(n==37?-1:1);return t.preventDefault()}}}),i.initialIndex&&s.seekTo(i.initialIndex,0,function(){})}e.tools=e.tools||{version:"v1.2.6"},e.tools.scrollable={conf:{activeClass:"active",circular:!1,clonedClass:"cloned",disabledClass:"disabled",easing:"swing",initialIndex:0,item:"> *",items:".items",keyboard:!0,mousewheel:!1,next:".next",prev:".prev",size:1,speed:400,vertical:!1,touch:!0,wheelSpeed:0}};var r;e.fn.scrollable=function(t){var n=this.data("scrollable");if(n)return n;t=e.extend({},e.tools.scrollable.conf,t),this.each(function(){n=new i(e(this),t),e(this).data("scrollable",n)});return t.api?n:this}})(jQuery);(function(e){function n(t,n){var r=e(n);return r.length<2?r:t.parent().find(n)}var t=e.tools.scrollable;t.navigator={conf:{navi:".navi",naviItem:null,activeClass:"active",indexed:!1,idPrefix:null,history:!1}};e.fn.navigator=function(r){typeof r=="string"&&(r={navi:r}),r=e.extend({},t.navigator.conf,r);var i;this.each(function(){function h(e,n,r){t.seekTo(n),r.preventDefault(),f&&history.pushState({i:n})}function p(){return s.find(r.naviItem||"> *")}function v(t){var n=e("<"+(r.naviItem||"a")+"/>").click(function(n){h(e(this),t,n)});t===0&&n.addClass(u),r.indexed&&n.text(t+1),r.idPrefix&&n.attr("id",r.idPrefix+t);return n.appendTo(s)}var t=e(this).data("scrollable"),s=r.navi.jquery?r.navi:n(t.getRoot(),r.navi),o=t.getNaviButtons(),u=r.activeClass,f=r.history&&history.pushState,l=t.getConf().size;t&&(i=t),t.getNaviButtons=function(){return o.add(s)},f&&(history.pushState({i:0}),e(window).bind("popstate",function(e){var n=e.originalEvent.state;n&&t.seekTo(n.i)}));p().length?p().each(function(t){e(this).click(function(n){h(e(this),t,n)})}):e.each(t.getItems(),function(e){e%l==0&&v(e)}),t.onBeforeSeek(function(e,t){setTimeout(function(){if(!e.isDefaultPrevented()){var n=t/l,r=p().eq(n);r.length&&p().removeClass(u).eq(n).addClass(u)}},1)}),t.onAddItem(function(e,n){var r=t.getItems().index(n);r%l==0&&v(r)})});return r.api?i:this}})(jQuery);$.getObject("Pb.Component.Filmstrip",!0).Filmstrip=function(){function e(e){this.init(e)}var t={libData:null,libDataMax:null,libDataMin:null,libDataCount:null,thumbData:null,currentOffset:0,total:null,currentThumb:null,startThumb:null,endThumb:null,mediaPrevArrow:null,mediaNextArrow:null,filmstripWrapper:null,filmstripLoading:null,filmstripPrevArrow:null,filmstripNextArrow:null,scrollableWrapper:".detailCompWrapper",scrollableId:null,itemContainer:null,scrollableWidth:0,scrollableHeight:0,thumbPaddingBorder:20,verticalHeight:450,verticalThumbHeight:90,maxThumbDims:{width:82,height:82},placeHoldThumb:null,hasResized:!1,contentUpdateInfo:null,win:null,isCompact:!1,windowWidth:null,isFetching:!1,lastLeftFetchOffset:null,lastRightFetchOffset:null,onPageLoad:!1,lastSlideIndex:null,slideExpired:!1,isSideFilmStrip:!1,filmstripCompactEvent:"Pb.Component.Filmstrip.Filmstrip::compact",filmstripNormalEvent:"Pb.Component.Filmstrip.Filmstrip::normal",preloadThumbsEvent:"Pb.Component.Filmstrip.Filmstrip::preloadFilmstripThumbs",filmstripSlideEvent:"Pb.Component.Filmstrip.Filmstrip::filmstrip_slide_update",filmstripArrowClickEvent:"Pb.Component.Filmstrip.Filmstrip::filmstrip_arrow_click",fullsizePreloadEvent:"Pb.Component.Filmstrip.Filmstrip::filmstrip_fullsize_preloaded",filmstripOffsetUpdateEvent:"Pb.Component.Filmstrip.Filmstrip::filmstrip_offset_update",init:function(e){this.placeHoldThumb=Pb.Data.get("picUrl")+"backgrounds/placeholder_thumb.jpg";e.currentOffset&&(this.currentOffset=parseInt(e.currentOffset,10));e.total&&(this.total=e.total);typeof e.scrollableWrapper!="undefined"&&(this.scrollableWrapper=e.scrollableWrapper);$(".detailfilmstripwrap").closest(".sidebar").length>0&&(this.isSideFilmStrip=!0);this.scrollableId="#"+e.scrollableId;this.libData=Pb.Data.Shared.get(Pb.Data.Shared.MEDIA_SET);this.libDataMin=Pb.Data.get("libDataMin");this.libDataMax=Pb.Data.get("libDataMax");this.libDataCount=Pb.Data.get("libDataCount");this.getElements();this.bindEvents();this.configureScrollable()},getElements:function(){this.win=$(window);this.filmstripWrapper=$("div.detailfilmstripwrap");this.mediaPrevArrow=$("#mediaTemplate div#previous");this.mediaNextArrow=$("#mediaTemplate div#next");this.filmstripPrevArrow=this.filmstripWrapper.find("a.prev");this.filmstripNextArrow=this.filmstripWrapper.find("a.next");this.filmstripLoading=$("#filmstripLoadingShroud")},bindEvents:function(){var e=$(document);this.win.resize($.proxy(function(){this.hasResized=!0;this.configureScrollable()},this));e.bind("preloadFullsize",$.proxy(function(e){this.handlePreloadedFullsize(e)},this));e.on("Pb.Component.Media.Media::media_previous_click",$.proxy(function(e){Pb.Track.trf("detail_pagination_previous_click");this.move(-1)},this)).on("Pb.Component.Media.Media::media_next_click",$.proxy(function(e){Pb.Track.trf("detail_pagination_next_click");this.move(1)},this)).on("Pb.Component.Detail.DetailActions::media_next_click",$.proxy(function(e){this.move(1)},this)).on("Pb.Component.Detail.DetailActions::media_previous_click",$.proxy(function(e){this.move(-1)},this)).on("Pb.Component.Media.Media::media_next_swipe",$.proxy(function(e){Pb.Track.trf("detail_pagination_next_swipe");this.move(1)},this)).on("Pb.Component.Media.Media::media_previous_swipe",$.proxy(function(e){Pb.Track.trf("detail_pagination_previous_swipe");this.move(-1)},this));e.on("keyup.mediadetail",$.proxy(this.onKeyUp,this));e.on("Pb.Component.Media.ZoomModal::shown",function(){$(document).off("keyup.mediadetail")});e.on("Pb.Component.Media.ZoomModal::hide",$.proxy(function(e){$(document).on("keyup.mediadetail",$.proxy(this.onKeyUp,this))},this));e.on(this.preloadThumbsEvent,$.proxy(this.handlePreloadThumbs,this));e.on("Pb.Component.Detail.Fetcher::libdata_update",$.proxy(this.updateLibData,this));this.filmstripPrevArrow.on("click",$.proxy(function(e){Pb.Track.trf("detail_filmstrip_previous_click");var t=$.Event(this.filmstripArrowClickEvent);$(document).trigger(t);this.moveSlide(-1)},this));this.filmstripNextArrow.on("click",$.proxy(function(e){Pb.Track.trf("detail_filmstrip_next_click");var t=$.Event(this.filmstripArrowClickEvent);$(document).trigger(t);this.moveSlide(1)},this));$("#detailfilmstrip").on("click","a",$.proxy(function(e,t){this.handleThumbClick(e,t)},this))},onKeyUp:function(e){var t=e.target.tagName;if(t==="INPUT"||t==="TEXTAREA")return;var n=e.keyCode;if(n!==37&&n!==188||!!this.onPageLoad){if((n===39||n===190)&&!this.onPageLoad){Pb.Track.trf("detail_pagination_right_keyboard_click");this.move(1)}}else{Pb.Track.trf("detail_pagination_left_keyboard_click");this.move(-1)}},updateLibData:function(e){this.libData=Pb.Data.Shared.get(Pb.Data.Shared.MEDIA_SET);this.libDataMin=Pb.Data.get("libDataMin");this.libDataMax=Pb.Data.get("libDataMax");this.libDataCount=Pb.Data.get("libDataCount");this.isFetching=!1;this.contentUpdateInfo={dir:e.dir,start:e.startOffset,end:e.endOffset};this.handleUpdateLibData();this.slideExpired&&this.doSlideExpired()},handleUpdateLibData:function(){var e,t,n,r;if(this.contentUpdateInfo.dir===-1)if(this.onPageLoad&&this.contentUpdateInfo.start!==0){this.onPageLoad=!1;e=this.contentUpdateInfo.start;t=this.contentUpdateInfo.end;n=this.createThumbs(e,t);r=this.thumbData.length;$.observable(this.thumbData).insert(r,n);this.lastLeftFetchOffset=e;this.toggleMediaArrow()}else{e=this.contentUpdateInfo.start;t=this.contentUpdateInfo.end;n=this.createThumbs(e,t);r=0;if(t===parseInt(this.total,10)-1||t===this.libDataMax)r=this.thumbData.length;else for(var i=0;i<this.thumbData.length;i++)parseInt(this.thumbData[i].dataIndex,10)===this.lastLeftFetchOffset&&(r=i);this.lastLeftFetchOffset=e;$.observable(this.thumbData).insert(r,n)}else if(this.onPageLoad){this.onPageLoad=!1;e=this.contentUpdateInfo.start;t=this.contentUpdateInfo.end;n=this.createThumbs(e,t);if(e===0||e===this.libDataMin)r=0;else for(var i=0;i<this.thumbData.length;i++)parseInt(this.thumbData[i].dataIndex,10)===this.lastRightFetchOffset-1&&(r=i+1);$.observable(this.thumbData).insert(r,n);this.lastRightFetchOffset=t+1;this.toggleMediaArrow()}else{e=this.contentUpdateInfo.start;t=this.contentUpdateInfo.end;n=this.createThumbs(e,t);if(e===0||e===this.libDataMin)r=0;else for(var i=0;i<this.thumbData.length;i++)parseInt(this.thumbData[i].dataIndex,10)===this.lastRightFetchOffset-1&&(r=i+1);this.lastRightFetchOffset=t+1;$.observable(this.thumbData).insert(r,n)}},doSlideExpired:function(){this.toggleLoading();this.slideExpiredData.dir===-1?this.startThumb=$("#thumb_"+this.slideExpiredData.start):this.endThumb=$("#thumb_"+this.slideExpiredData.start);this.slideExpired=!1;this.moveSlide(this.slideExpiredData.dir)},shouldResize:function(){var e=this.win.width();if(this.windowWidth===e)return!1;this.windowWidth=e;return!0},configureLayout:function(){var e=this.win.width();if(!this.shouldResize())return;e<=1024&&!this.isCompact?this.switchCompact():e>1024&&this.isCompact&&this.switchNormal()},switchCompact:function(){var e=$("#mediaTemplateTarget");this.isCompact=!0;var t=$.Event(this.filmstripCompactEvent);$(document).trigger(t);e.addClass("compact");this.filmstripWrapper.addClass("compact");$("#detailfilmstrip").width(120).height(450)},switchNormal:function(){var e=$("#mediaTemplateTarget");this.isCompact=!1;var t=$.Event(this.filmstripNormalEvent);$(document).trigger(t);e.removeClass("compact");this.filmstripWrapper.removeClass("compact")},configureScrollable:function(){if(!this.shouldResize())return;this.hasResized&&(this.itemContainer[0].innerHTML="");this.scrollableWidth=$(this.scrollableWrapper).outerWidth();this.scrollableHeight=this.verticalThumbHeight;if(!this.isCompact){$(this.scrollableId).width(this.scrollableWidth);$(this.scrollableId).height(this.scrollableHeight)}this.createStrip(this.libDataMin,this.libDataMax)},preloadThumbs:function(e,t){var n=[];if(n.length>0){var r=new Pb.ClientImagePreloader;r.preLoad(this.preloadThumbsEvent,n)}},handlePreloadThumbs:function(e){var t,n,r,i;if(e.dimensions){r=e.dimensions;for(var s in this.libData){if(this.libData.hasOwnProperty(s)){t=this.libData[s];if(r[t.thumbUrl]){t.thWidth=r[t.thumbUrl].width;t.thHeight=r[t.thumbUrl].height}}if(!t.thWidth||!t.thHeight)continue;if(t.thWidth>t.thHeight){i=(t.thWidth*70/t.thHeight-70)/2;n="margin-left: -"+i+"px; max-height: 70px"}else{i=(t.thHeight*70/t.thWidth-70)/2;n="margin-top: -"+i+"px; max-width: 70px"}if(t.thPlaceHold){var o=$("#thumb_"+t.offset+" img");o.attr("src",t.thumbUrl).attr("style",n);t.thPlaceHold=!1}}}},createStrip:function(e,t){this.itemContainer=$("#itemContainer");this.thumbData=this.createThumbs(e,t);Pb.JSTemplates.link("#thumbTemplate","#itemContainer",this.thumbData);this.itemContainer.css("visibility","visible");this.startThumb=$("#thumb_"+this.currentOffset);this.startThumb.addClass("selected");this.currentThumb=this.startThumb;var n=this.getSlideOffsetData(this.currentOffset,this.libDataMax,1);this.endThumb=$("#thumb_"+n.endOffset);this.moveSlideMargins(n);this.toggleThumbVisibility(this.currentOffset,n.endOffset);if(this.currentOffset<20&&parseInt(this.total,10)>20){this.lastLeftFetchOffset=this.libDataMin;this.lastRightFetchOffset=this.libDataMax+1;this.onPageLoad=!0;this.testThresholds(-1);parseInt(this.total,10)>40&&this.testThresholds(1)}else if(this.currentOffset>parseInt(this.total,10)-20&&parseInt(this.total,10)>20){this.lastRightFetchOffset=this.libDataMax+1;this.lastLeftFetchOffset=this.libDataMin;this.onPageLoad=!0;this.testThresholds(1);parseInt(this.total,10)>40&&this.testThresholds(-1)}else{this.lastRightFetchOffset=this.libDataMax+1;this.testThresholds(1)}this.toggleMediaArrow()},testThresholds:function(e){var t=this.endThumb.data("index")-this.startThumb.data("index")+20,n=this.endThumb.data("index")+1+t;if(n>this.total&&this.lastRightFetchOffset===parseInt(this.total,10)){n-=parseInt(this.total,10);this.lastRightFetchOffset=0}else if(n>this.total&&!this.lastRightFetchOffset){n=parseInt(this.total,10)-1;this.lastRightFetchOffset=this.libDataMax+1}var r=this.startThumb.data("index")-1-t;if(r<0&&this.libDataMin<2&&this.lastLeftFetchOffset===0){r=parseInt(this.total,10)+r;this.lastLeftFetchOffset=parseInt(this.total,10)}else if(r<0&&!this.lastLeftFetchOffset&&this.lastLeftFetchOffset!==0){r=0;this.lastLeftFetchOffset=this.libDataMin}var i={dir:e},s=!1;if(e===1&&this.libDataCount<this.total){s=!0;i.startOffset=this.lastRightFetchOffset}else if(e===-1&&this.libDataCount<this.total){s=!0;i.startOffset=this.lastLeftFetchOffset}if(s){this.isFetching=!0;var o=$.Event(this.filmstripSlideEvent,i);$(document).trigger(o)}else this.slideExpired&&this.doSlideExpired()},createThumbs:function(e,t){var n=[];for(var r=e;r<=t;r++){var i,s,o,u=this.libData[r];if(u){u.thPlaceHold=!1;i=u.thumbUrl;var a={thumbId:"thumb_"+r,dataIndex:""+r,altText:u.altText,thumbUrl:i,imgStyle:o,mediaType:u.mediaType,sizeClass:u.sizeClass};n.push(a)}}return n},moveSlideMargins:function(e){if(this.isCompact){this.startThumb.css("margin-top",e.diff+"px");this.endThumb.css("margin-bottom",e.diff+"px")}else{this.startThumb.css("margin-left",e.diff+"px");this.endThumb.css("margin-right",e.diff+"px")}},resetMargins:function(){this.startThumb.css({"margin-top":0,"margin-left":"16px","margin-right":0});this.endThumb.css({"margin-bottom":0,"margin-right":0,"margin-left":"16px"})},resetSideFilmstripMargins:function(){this.startThumb.css({"margin-top":0,"margin-left":"16px","margin-right":0});this.endThumb.css({"margin-bottom":0,"margin-right":0,"margin-left":0})},clearMargins:function(){this.startThumb.css({"margin-top":0,"margin-left":0,"margin-right":0,"margin-bottom":0});this.endThumb.css({"margin-bottom":0,"margin-right":0,"margin-left":0,"margin-top":0})},toggleThumbVisibility:function(e,t){this.hideThumbVisibility();for(var n=e;n<=t;n++)$("#thumb_"+n).show();this.preloadThumbs(e,t);this.filmstripWrapper.hasClass("off")&&this.filmstripWrapper.removeClass("off").fadeTo(300,1);e-=3;e<0&&(e=0);this.preloadFullsizeImages(e,t)},hideThumbVisibility:function(){for(var e in this.libData)this.libData.hasOwnProperty(e)&&$("#thumb_"+e).hide()},getSlideOffsetData:function(e,t,n){var r;this.isCompact?r=this.getVerticalOffset(e,n):r=this.getHorizontalOffset(e,n);return r},getHorizontalOffset:function(e,t){var n,r,i,s,o,u=70+this.thumbPaddingBorder;this.scrollableWidth>400?n=Math.floor(this.scrollableWidth/u-.6):n=Math.floor(this.scrollableWidth/u);n=Math.min(9,n);r=n*u;if(t===-1){s=e-(n-1);s<0&&(s=this.libDataMin);o=e-s+1}else{s=e+(n-1);s>this.total-1&&(s=this.libDataMax);o=s-e+1}var a=o*u;a<this.scrollableWidth?i=(this.scrollableWidth-a)/2:i=(this.scrollableWidth-r)/2;return{diff:i,endOffset:s}},getVerticalOffset:function(e,t){var n,r,i,s,o;n=Math.floor(this.verticalHeight/this.verticalThumbHeight);r=n*this.verticalThumbHeight;if(t===-1){s=e-(n-1);s<0&&(s=this.libDataMin);o=e-s+1}else{s=e+(n-1);s>this.total-1&&(s=this.libDataMax);o=s-e+1}var u=o*this.verticalThumbHeight;u<this.verticalHeight?i=(this.verticalHeight-u)/2:i=(this.verticalHeight-r)/2;return{diff:i,endOffset:s}},moveSlide:function(e){var t,n,r;if(this.slideExpired)return;if(e===-1){var i=this.startThumb.data("index");if(i===0||i===this.libDataMin)i=parseInt(this.thumbData[this.thumbData.length-1].dataIndex,10)+1;this.lastSlideIndex=i;t=parseInt(i,10)-1;n=this.libDataMin;r=this.getSlideOffsetData(t,n,e);if(r.endOffset<this.libDataMin){this.handleSlideExpired(e);return}this.isSideFilmStrip&&this.clearMargins();this.startThumb=$("#thumb_"+r.endOffset);this.endThumb=$("#thumb_"+t);this.isSideFilmStrip?this.resetSideFilmstripMargins():this.resetMargins();this.toggleThumbVisibility(r.endOffset,t)}else if(e===1){var s=this.endThumb.data("index");if(s===parseInt(this.total,10)-1||s===this.libDataMax)s=-1;this.lastSlideIndex=s;t=parseInt(s,10)+1;n=this.libDataMax;r=this.getSlideOffsetData(t,n,e);if(r.endOffset>this.libDataMax){this.handleSlideExpired(e);return}this.isSideFilmStrip&&this.clearMargins();this.startThumb=$("#thumb_"+t);this.endThumb=$("#thumb_"+r.endOffset);this.isSideFilmStrip?this.resetSideFilmstripMargins():this.resetMargins();this.toggleThumbVisibility(t,r.endOffset)}this.moveSlideMargins(r);this.testThresholds(e)},handleSlideExpired:function(e){this.hideThumbVisibility();this.toggleLoading();this.slideExpired=!0;this.slideExpiredData={start:this.lastSlideIndex,dir:e}},preloadFullsizeImages:function(e,t){var n=[];for(var r=e;r<=t;r++){var i=this.libData[r];typeof i!="undefined"&&i.mediaType==="image"&&(i.fsWidth||n.push(i.fullsizeUrl))}if(n.length>0){var s=new Pb.ClientImagePreloader;s.preLoad("preloadFullsize",n,{start:e,end:t})}},handlePreloadedFullsize:function(e){var t=e.dimensions,n=e.memo;for(var r=n.start;r<=n.end;r++){var i=this.libData[r];if(typeof i=="undefined")continue;var s=i.fullsizeUrl,o;if(i.mediaType==="image"){if(t[s]){i.fsWidth=t[s].width;i.fsHeight=t[s].height}if(i.rsWidth===""){o={width:i.fsWidth,height:i.fsHeight};var u=Pb.Data.get("mediaMaxDims");if(i.fsWidth>u.width||i.fsHeight>u.height){var a=new Pb.ClientImageRescaler(u);o=a.rescale(o)}if(o){i.rsWidth=o.width;i.rsHeight=o.height}}}i.placeHold===!0&&$(document).trigger($.Event("Pb.Component.Media.Media::replacePlaceHolder"))}$(document).trigger($.Event(this.fullsizePreloadEvent))},handleThumbClick:function(e,t){var n=this.currentOffset;this.currentThumb.removeClass("selected");this.currentThumb=$(e.currentTarget).parents(".wrap");this.currentThumb.addClass("selected");this.currentThumb.data("isprevnextclick")!=="true"&&t!=="prevnextclick"?Pb.Track.trf("detail_filmstrip_thumbnail_click"):this.currentThumb.removeData("isprevnextclick");this.currentOffset=this.currentThumb.data("index");var r=this.currentOffset-3;r<0&&(r=0);var i=this.currentOffset+3;i>this.total&&(i=this.total);this.preloadFullsizeImages(r,i);var s=$.Event(this.filmstripOffsetUpdateEvent,{currentOffset:this.currentOffset,oldOffset:n});$(document).trigger(s)},move:function(e){var t=this.currentOffset+e;if(t<0||t<this.libDataMin){t=parseInt(this.thumbData[this.thumbData.length-1].dataIndex,10);this.moveSlide(-1);Pb.Track.trf("detail_pagination_end_album_click")}else if(t===parseInt(this.total,10)||t>this.libDataMax){t=0;this.moveSlide(1);Pb.Track.trf("detail_pagination_beginning_album_click")}this.libData[t]||(t=this.findNextThumb(t,e));var n=this.startThumb.data("index")-1;n<0&&(n=0);var r=this.endThumb.data("index")+1;r>this.libDataMax&&(r=this.libDataMax);if(e===-1&&t===this.startThumb.data("index")+3){var i=n-10;i<0&&(i=0);this.preloadFullsizeImages(i,n)}else if(e===1&&t===this.endThumb.data("index")-3){var s=r+10;s>this.libDataMax&&(s=this.libDataMax);this.preloadFullsizeImages(r,s)}t<this.startThumb.data("index")&&e===-1?this.moveSlide(-1):t>this.endThumb.data("index")&&e===1&&this.moveSlide(1);var o=$("#thumb_"+t);o.data("isprevnextclick","true");o.find("a").trigger("click",["prevnextclick"])},findNextThumb:function(e,t){if(t===-1){for(var n=e;n>this.libDataMin;n--)if(this.libData[n])return n}else for(var n=e;n<this.libDataMax;n++)if(this.libData[n])return n},toggleMediaArrow:function(){var e=this.currentOffset,t=e===0&&this.onPageLoad?"hidden":"visible";$("#mediaTemplate div#previous").css("visibility",t);$("#mediaTemplate").data("prev",t);var n=e===this.total-1&&this.onPageLoad?"hidden":"visible";$("#mediaTemplate div#next").css("visibility",n);$("#mediaTemplate").data("next",n)},toggleLoading:function(){this.filmstripLoading.toggle()}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.RecentUploads",!0).RecentUploadsDetailManager=function(){function e(e){this.init(e)}var t={start:0,end:19,current:0,libData:null,libDataMax:null,libDataMin:null,mediaPrevArrow:null,mediaNextArrow:null,maxFullSizeDims:{width:600,height:450},init:function(){this.updateLibData();this.bindEvents();this.preloadFullsize(this.start,this.end);this.getElements()},getElements:function(){this.mediaPrevArrow=$("#mediaTemplate a#previous");this.mediaNextArrow=$("#mediaTemplate a#next")},bindEvents:function(){var e=$(document);e.on("Pb.Component.Media.Media::media_previous_click",$.proxy(function(){Pb.Track.trf("detail_pagination_previous_click");this.move(-1)},this)).on("Pb.Component.Media.Media::media_next_click",$.proxy(function(){Pb.Track.trf("detail_pagination_next_click");this.move(1)},this)).on("Pb.Component.Detail.DetailActions::media_next_click",$.proxy(function(e){this.move(1)},this)).on("Pb.Component.Detail.DetailActions::media_previous_click",$.proxy(function(e){this.move(-1)},this)).on("Pb.Component.Media.Media::media_next_swipe",$.proxy(function(e){Pb.Track.trf("detail_pagination_next_swipe");this.move(1)},this)).on("Pb.Component.Media.Media::media_previous_swipe",$.proxy(function(e){Pb.Track.trf("detail_pagination_previous_swipe");this.move(-1)},this));e.on("keyup.mediadetail",$.proxy(this.onKeyUp,this));e.on("Pb.Component.Media.ZoomModal::shown",function(){$(document).off("keyup.mediadetail")});e.on("Pb.Component.Media.ZoomModal::hide",$.proxy(function(e){$(document).on("keyup.mediadetail",$.proxy(this.onKeyUp,this))},this));e.on("Pb.Component.Detail.Fetcher::libdata_update",$.proxy(this.updateLibData,this));e.on("preloadFullsize",$.proxy(this.handlePreloadedFullsize,this))},onKeyUp:function(e){var t=e.target.tagName;if(t==="INPUT"||t==="TEXTAREA")return;var n=e.keyCode;if(n===37||n===188){Pb.Track.trf("detail_pagination_left_keyboard_click");this.move(-1)}else if(n===39||n===190){Pb.Track.trf("detail_pagination_right_keyboard_click");this.move(1)}},updateLibData:function(e){this.libData=Pb.Data.Shared.get(Pb.Data.Shared.MEDIA_SET);this.libDataMax=Pb.Data.get("libDataMax");this.libDataMin=Pb.Data.get("libDataMin");typeof e!="undefined"&&this.preloadFullsize(e.startOffset,this.libDataMax)},preloadFullsize:function(e,t){var n=[];for(var r=e;r<=t;r++){var i=this.libData[r];typeof i!="undefined"&&i.mediaType==="image"&&(i.fsWidth||n.push(i.fullsizeUrl))}if(n.length>0){var s=new Pb.ClientImagePreloader;s.preLoad("preloadFullsize",n,{start:e,end:t})}},handlePreloadedFullsize:function(e){var t=e.dimensions,n=e.memo;for(var r=n.start;r<=n.end;r++){var i=this.libData[r];if(typeof i=="undefined")continue;var s=i.fullsizeUrl,o;if(i.mediaType==="image"){if(t[s]){i.fsWidth=t[s].width;i.fsHeight=t[s].height}if(i.rsWidth===""){o={width:i.fsWidth,height:i.fsHeight};if(i.fsWidth>this.maxFullSizeDims.width||i.fsHeight>this.maxFullSizeDims.height){var u=new Pb.ClientImageRescaler(this.maxFullSizeDims);o=u.rescale(o)}if(o){i.rsWidth=o.width;i.rsHeight=o.height}}if(i.placeHold){var a=$("#"+i.placeHolderId);a.length>0&&a.attr("src",i.fullsizeUrl).css({width:i.rsWidth+"px",height:i.rsHeight+"px"});i.placeHold=!1}}}},move:function(e){var t=this.current;this.current=this.current+e;this.current<0&&(this.current=0);var n=$.Event("Pb.Component.RecentUploads.RecentUploadsDetailManager::recentuploads_offset_update",{currentOffset:this.current,oldOffset:t});$(document).trigger(n);this.testThresholds(e)},testThresholds:function(e){var t=20,n=this.current+t,r={isFirstRender:!1,dir:e},i=!1;if(e===1&&this.libDataMax<=n){i=!0;r.startOffset=this.libDataMax+1}if(i){var s=$.Event("Pb.Component.RecentUploads.RecentUploadsDetailManager::recentuploads_update",r);$(document).trigger(s)}},toggleMediaArrow:function(){var e=this.current,t=e===0?"hidden":"visible";this.mediaPrevArrow.css("visibility",t);$("#mediaTemplate").data("prev",t);$("#btnprev").toggleClass("disabled",e===0)}};$.extend(e.prototype,t);return e}();$.getObject("Pb",!0).StorageMessage=function(){function e(e){var t={name:e},n={url:"/action/notification/update",data:t};Pb.Ajax.ajax(n);Pb.Utilities.cookie("pbStorage",!0)}return{close:e}}();$.getObject("Pb.Component.Bandwidth",!0).BandwidthNotification=function(){function e(e){var t={name:"bandwidthNotificationShown"},n={url:"/action/notification/update",data:t,success:function(){e&&(location.href=e)}};Pb.Ajax.ajax(n)}function t(){$("#bandwidthWarning").on("close",function(){e()})}Pb.InitEventQueue.add(t);return{setViewed:e}}();